<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="活动(Activity)基本用法上一节中的MainActivity是Android Studio自己创建的，现在我们手动创建。首先需要关闭当前项目，点击导航栏File-&gt;Close Project。然后再新建一个Android项目，我们选No Activity,项目名字可以叫做ActivityTest，点击Finish，等待Gradle构建完成，项目就创建成功了。   手动创建活动将项目结构">
<meta property="og:type" content="article">
<meta property="og:title" content="[android]Activity">
<meta property="og:url" content="http://example.com/2024/04/04/android-Activity/index.html">
<meta property="og:site_name" content="白乐天">
<meta property="og:description" content="活动(Activity)基本用法上一节中的MainActivity是Android Studio自己创建的，现在我们手动创建。首先需要关闭当前项目，点击导航栏File-&gt;Close Project。然后再新建一个Android项目，我们选No Activity,项目名字可以叫做ActivityTest，点击Finish，等待Gradle构建完成，项目就创建成功了。   手动创建活动将项目结构">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/1.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/2.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/3.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/4.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/5.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/6.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/7.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/8.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/9.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/10.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/11.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/12.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/13.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/14.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/15.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/16.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/17.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/18.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/19.png">
<meta property="og:image" content="http://example.com/2024/04/04/android-Activity/20.png">
<meta property="article:published_time" content="2024-04-04T10:50:20.000Z">
<meta property="article:modified_time" content="2024-04-10T01:57:10.323Z">
<meta property="article:author" content="白乐天">
<meta property="article:tag" content="Activity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/04/04/android-Activity/1.png">


<link rel="canonical" href="http://example.com/2024/04/04/android-Activity/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2024/04/04/android-Activity/","path":"2024/04/04/android-Activity/","title":"[android]Activity"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[android]Activity | 白乐天</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">白乐天</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">27</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">13</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">43</span></a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B4%BB%E5%8A%A8-Activity-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="nav-number">1.</span> <span class="nav-text">活动(Activity)基本用法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA%E6%B4%BB%E5%8A%A8"><span class="nav-number">1.1.</span> <span class="nav-text">手动创建活动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%B8%83%E5%B1%80"><span class="nav-number">1.2.</span> <span class="nav-text">创建和加载布局</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8AndroidManifest%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B3%A8%E5%86%8C"><span class="nav-number">1.3.</span> <span class="nav-text">在AndroidManifest文件中注册</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E6%B4%BB%E5%8A%A8%E4%B8%AD%E4%BD%BF%E7%94%A8Toast"><span class="nav-number">1.4.</span> <span class="nav-text">在活动中使用Toast</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E6%B4%BB%E5%8A%A8%E4%B8%AD%E4%BD%BF%E7%94%A8Menu"><span class="nav-number">1.5.</span> <span class="nav-text">在活动中使用Menu</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%80%E6%AF%81%E4%B8%80%E4%B8%AA%E6%B4%BB%E5%8A%A8"><span class="nav-number">1.6.</span> <span class="nav-text">销毁一个活动</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Intent%E5%9C%A8%E6%B4%BB%E5%8A%A8%E4%B9%8B%E9%97%B4%E7%A9%BF%E6%A2%AD"><span class="nav-number">2.</span> <span class="nav-text">使用Intent在活动之间穿梭</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%98%BE%E5%BC%8FIntent"><span class="nav-number">2.1.</span> <span class="nav-text">使用显式Intent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%9A%90%E5%BC%8FIntent"><span class="nav-number">2.2.</span> <span class="nav-text">使用隐式Intent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E5%A4%9A%E9%9A%90%E5%BC%8FIntent%E7%9A%84%E7%94%A8%E6%B3%95"><span class="nav-number">2.3.</span> <span class="nav-text">更多隐式Intent的用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%91%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%B4%BB%E5%8A%A8%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE"><span class="nav-number">2.4.</span> <span class="nav-text">向下一个活动传递数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E7%BB%99%E4%B8%8A%E4%B8%80%E4%B8%AA%E6%B4%BB%E5%8A%A8"><span class="nav-number">2.5.</span> <span class="nav-text">返回数据给上一个活动</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B4%BB%E5%8A%A8%E7%9A%84%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F"><span class="nav-number">3.</span> <span class="nav-text">活动的声明周期</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E6%A0%88"><span class="nav-number">3.1.</span> <span class="nav-text">返回栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B4%BB%E5%8A%A8%E7%8A%B6%E6%80%81"><span class="nav-number">3.2.</span> <span class="nav-text">活动状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B4%BB%E5%8A%A8%E7%9A%84%E7%94%9F%E5%AD%98%E6%9C%9F"><span class="nav-number">3.3.</span> <span class="nav-text">活动的生存期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%93%E9%AA%8C%E6%B4%BB%E5%8A%A8%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">3.4.</span> <span class="nav-text">体验活动的生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AEbug"><span class="nav-number">3.4.1.</span> <span class="nav-text">修bug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B4%BB%E5%8A%A8%E8%A2%AB%E5%9B%9E%E6%94%B6%E4%BA%86%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="nav-number">3.5.</span> <span class="nav-text">活动被回收了怎么办</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B4%BB%E5%8A%A8%E7%9A%84%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.</span> <span class="nav-text">活动的启动模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#standard"><span class="nav-number">4.1.</span> <span class="nav-text">standard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#singleTop"><span class="nav-number">4.2.</span> <span class="nav-text">singleTop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#singleTask"><span class="nav-number">4.3.</span> <span class="nav-text">singleTask</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#singleInstance"><span class="nav-number">4.4.</span> <span class="nav-text">singleInstance</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B4%BB%E5%8A%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">5.</span> <span class="nav-text">活动的最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%A5%E6%99%93%E5%BD%93%E5%89%8D%E6%98%AF%E5%9C%A8%E5%93%AA%E4%B8%80%E4%B8%AA%E6%B4%BB%E5%8A%A8"><span class="nav-number">5.1.</span> <span class="nav-text">知晓当前是在哪一个活动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%8F%E6%97%B6%E9%9A%8F%E5%9C%B0%E9%80%80%E5%87%BA%E7%A8%8B%E5%BA%8F"><span class="nav-number">5.2.</span> <span class="nav-text">随时随地退出程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%B4%BB%E5%8A%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%86%99%E6%B3%95"><span class="nav-number">5.3.</span> <span class="nav-text">启动活动的最佳写法</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="白乐天"
      src="/images/android.svg">
  <p class="site-author-name" itemprop="name">白乐天</p>
  <div class="site-description" itemprop="description">在安卓逆向和爬虫的道路上渐行渐远!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/blttttt" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;blttttt" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/04/android-Activity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="[android]Activity | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [android]Activity
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-04 18:50:20" itemprop="dateCreated datePublished" datetime="2024-04-04T18:50:20+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-10 09:57:10" itemprop="dateModified" datetime="2024-04-10T09:57:10+08:00">2024-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android-Develop/" itemprop="url" rel="index"><span itemprop="name">Android Develop</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="活动-Activity-基本用法"><a href="#活动-Activity-基本用法" class="headerlink" title="活动(Activity)基本用法"></a>活动(Activity)基本用法</h1><p>上一节中的MainActivity是Android Studio自己创建的，现在我们手动创建。<br>首先需要关闭当前项目，点击导航栏File-&gt;Close Project。然后再新建一个Android项目，我们选No Activity,项目名字可以叫做ActivityTest，点击Finish，等待Gradle构建完成，项目就创建成功了。  </p>
<h2 id="手动创建活动"><a href="#手动创建活动" class="headerlink" title="手动创建活动"></a>手动创建活动</h2><p>将项目结构手动改为Project模式<br><img src="/2024/04/04/android-Activity/1.png"><br>这里面app&#x2F;src&#x2F;main&#x2F;java&#x2F;com.example.activitytest目录是空的。<br>现在右击com.example.activitytest包-&gt;New-&gt;Activity-&gt;Empty Activity,会弹出一个创建活动的对话框，我们将活动命名为FirstActivity，不要勾选Generate Layout File和Launch Activity这两个选项，点击Finish完成创建。<br>创建完成后我发现这里生成的是一个Kotlin文件，而我此时还对Kotlin语言比较陌生。而且上一节里的MainActivity文件是Class文件，此时我想到两种方式，一个是接着用HelloWorld项目继续往下走，另一个是创建一个Class文件，把代码搬过来。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class FirstActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>onCreate方法就是调用了父类的onCreate方法。</p>
<h2 id="创建和加载布局"><a href="#创建和加载布局" class="headerlink" title="创建和加载布局"></a>创建和加载布局</h2><p>Android程序的设计讲究逻辑和视图分离，最好每一个活动都能对应一个布局，布局是用来显示界面内容的，我们来手动创建一个布局文件。<br>右击app&#x2F;src&#x2F;main&#x2F;res目录-&gt;New-&gt;Directory，会弹出一个新建目录的窗口，这里创建一个名为layout的目录。然后对layout目录右键-&gt;new-&gt;Layout resource file，会弹出一个新建布局资源文件的窗口，将这个布局文件命名为first_layout，根元素默认即可点击ok完成布局创建。<br>然后就会出现布局编辑器，将其切换为Text,会有如下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>补充：根元素<br>在 Android Studio 中，XML 布局文件的根元素通常是一个视图容器或布局容器。常见的根元素之一是 <RelativeLayout> 或 <LinearLayout>，它们是 Android 中常用的布局容器之一。这些容器允许你组织和排列屏幕上的视图。例如，<LinearLayout> 可以让你在水平或垂直方向上排列其内部的子视图，而 <RelativeLayout> 则允许你使用相对位置来布置子视图。<br>androidx.constraintlayout.widget.ConstraintLayout 是 Android 开发中的一个布局容器，用于在屏幕上放置和控制视图之间的位置关系。它是 Android Jetpack 中的一部分，被设计用于简化复杂布局的创建，并且在性能上表现良好。<br>使用 ConstraintLayout，你可以通过设置视图之间的水平和垂直约束来定义它们的位置。这些约束可以设置视图的边距、对齐方式、宽度和高度等。ConstraintLayout 还提供了可视化编辑器，使得在 Android Studio 中进行布局设计更加方便。  </RelativeLayout></LinearLayout></LinearLayout></RelativeLayout></p>
</blockquote>
<p>现在我们对布局稍作编辑，添加一个按钮，将Text视图切换为Design视图。<br>鼠标点击<code>Button</code>拖进显示框中。<br><img src="/2024/04/04/android-Activity/2.png"><br>再切换为Text视图。<br>增加了如下的代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:id=&quot;@+id/button&quot;</span><br><span class="line">    android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:text=&quot;Button&quot;</span><br><span class="line">    tools:layout_editor_absoluteX=&quot;150dp&quot;</span><br><span class="line">    tools:layout_editor_absoluteY=&quot;79dp&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>这里添加了一个Button元素，并在Button元素内部增加了几个属性。<br>android:id是给当前的元素定义一个唯一标识符，之后可以在代码中对这个元素进行操作。<br>对于<code>@+id/button</code>,如果把<code>+</code>去掉，就变成了<code>@id/button</code>，就是再XML里引用资源的方法。<br>如果要在XML里引用一个id，就是用<code>@id/id_name</code>这种语法，而如果需要在XML中定义一个id则要使用<code>@+id/id_name</code>这种语法。<br>后面的<code>android:layout_width</code>指定了当前元素的宽度，这里使用<code>wrap_content</code>表示当前元素的高度只要能刚好包含里面的内容就行。<br><code>android:layout_height</code>指定了当前元素的高度。<br><code>android:text</code>指定了元素中显示的文字内容。<br>一个简单的布局我们编写完成，接下来在活动中加载这个布局。<br>回到FirstActivity，在onCreat()方法中加入代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class FirstActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.first_layout);  //加载布局</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用<code>setContentView()</code>方法来给当前活动加载一个布局，在方法中我们一般会传入布局文件的id。<br>项目中添加的任何资源都会在R文件中生成一个相应的资源ID，因此刚刚创建的first_layout.xml布局的id现在应该是已经添加到R文件中了。<br>在代码中引用布局文件，只需调用<code>R.layout.first_layout</code>就可以得到first_layout.xml布局的id，然后传入setContentView()方法即可。</p>
<h2 id="在AndroidManifest文件中注册"><a href="#在AndroidManifest文件中注册" class="headerlink" title="在AndroidManifest文件中注册"></a>在AndroidManifest文件中注册</h2><p>所有的活动都要在AndroidManifest.xml中进行注册才能生效，而实际上FirstActivity已经在AndroidManifest.xml中注册过了，打开app&#x2F;src&#x2F;main&#x2F;AndroidManifest.xml文件，有如下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">    android:allowBackup=&quot;true&quot;</span><br><span class="line">    android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;</span><br><span class="line">    android:fullBackupContent=&quot;@xml/backup_rules&quot;</span><br><span class="line">    android:icon=&quot;@mipmap/ic_launcher&quot;</span><br><span class="line">    android:label=&quot;@string/app_name&quot;</span><br><span class="line">    android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;</span><br><span class="line">    android:supportsRtl=&quot;true&quot;</span><br><span class="line">    android:theme=&quot;@style/Theme.ActivityTest&quot;</span><br><span class="line">    tools:targetApi=&quot;31&quot;&gt;</span><br><span class="line">    &lt;activity</span><br><span class="line">        android:name=&quot;.FirstActivity&quot;</span><br><span class="line">        android:exported=&quot;false&quot;</span><br><span class="line">        android:label=&quot;@string/title_activity_first&quot;</span><br><span class="line">        android:theme=&quot;@style/Theme.ActivityTest&quot; /&gt;</span><br><span class="line">&lt;/application&gt;</span><br></pre></td></tr></table></figure>
<p>活动的声明放在<application>标签里，这里是通过<activity>标签来对活动进行注册的。而现在Android Studio自动帮我们完成了对FirstActivity的注册。<br>在<activity>标签中我们使用了android:name来指定具体注册的活动，这里的<code>.FirstActivity</code>就是<code>com.example.activitytest.FirstActivity</code>的缩写。<br>但是只注册了活动，程序还是不能运行的，因为还没有为程序配置主活动，也就是，程序运行起来的时候，不知道首先要启动那个活动。<br>配置主活动，就是在<activity>标签内部加入<intent-filter>标签，并在这个标签里添加<action android:name="android.intent.action.MAIN">和<category android:name="android.intent.category.LAUNCHER">这两句声明即可。<br>还可以使用android:label指定活动中标题栏的内容，标题栏是显示在活动最顶部的，运行时可以看到。<br>给主活动指定的label不仅会成为标题栏中的内容，还会成为启动器(Launcher)中应用程序显示的名称。<br>修改后的AndroidManifest.xml文件，如下</category></action></intent-filter></activity></activity></activity></application></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">        android:allowBackup=&quot;true&quot;</span><br><span class="line">        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;</span><br><span class="line">        android:fullBackupContent=&quot;@xml/backup_rules&quot;</span><br><span class="line">        android:icon=&quot;@mipmap/ic_launcher&quot;</span><br><span class="line">        android:label=&quot;@string/app_name&quot;</span><br><span class="line">        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;</span><br><span class="line">        android:supportsRtl=&quot;true&quot;</span><br><span class="line">        android:theme=&quot;@style/Theme.ActivityTest&quot;</span><br><span class="line">        tools:targetApi=&quot;31&quot;&gt;</span><br><span class="line">        &lt;activity android:name=&quot;.FirstActivity&quot;</span><br><span class="line">            android:exported=&quot;true&quot;</span><br><span class="line">            android:label=&quot;@string/title_activity_first&quot;</span><br><span class="line">            android:theme=&quot;@style/Theme.ActivityTest&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;</span><br><span class="line">                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line"></span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里面有一行代码<code>android:exported=&quot;true&quot;</code>原本是<code>false</code>,修改为<code>true才能正常执行</code>。<br><code>android:exported</code> 是用来指定组件是否可以被其他应用程序或组件访问的属性。<br>在 Android 中，应用程序由多个组件组成，如活动（Activity）、服务（Service）、广播接收器（Broadcast Receiver）和内容提供器（Content Provider）。这些组件可以是私有的（不导出）或公开的（导出）。  </p>
</blockquote>
<p>运行程序即可看到效果。</p>
<h2 id="在活动中使用Toast"><a href="#在活动中使用Toast" class="headerlink" title="在活动中使用Toast"></a>在活动中使用Toast</h2><p>Toast是Android系统提供的一种非常好的提醒方式，在程序中可以使用它将一些短小的信息通知给用户，这些信息会在一段时间后自动消失并且不会占用任何屏幕空间。<br>首先定义一个弹出Toast的触发点，正好界面上有一个按钮，我们让点击这个按钮的时候弹出一个Toast。在onCreat()方法中添加代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.first_layout);</span><br><span class="line">        Button button1 = (Button) findViewById(R.id.button);</span><br><span class="line">        button1.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Toast.makeText(FirstActivity.this,&quot;You click Button&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在活动中通过findViewById()方法获取到在布局文件中定义的元素，得到实例。<br>findViewById()方法返回的是一个View对象，我们需要向下转型将它转成Button对象。<br>得到实例后通过调用setOnClickListener()方法为按钮注册一个监听器，点击按钮就会执行监听器中的onClick()方法。弹出Toast的方法就在onClick()方法中编写了。<br>Toast的用法很简单，通过静态方法makeText()创建出一个Toast对象，然后用show()将Toast显示出来就可以了。makeText方法需要传入3个参数。第一个参数是Context，也就是Toast要求的上下文，由于活动本身就是一个Context对象，这里直接传入FirstActivity.this即可。第二个参数是Toast显示的文本内容，第三个参数是Toast显示的时长，有两个内置常量<code>Toast.LENGTH_SHORT</code>和<code>Toast.LENGTH_LONG</code>。</p>
<h2 id="在活动中使用Menu"><a href="#在活动中使用Menu" class="headerlink" title="在活动中使用Menu"></a>在活动中使用Menu</h2><p>在res目录下新建一个menu文件夹，右击res目录-&gt;New-&gt;Directory,输入文件夹名字menu，点击OK。接着在文件夹下再新建一个名叫main的菜单文件，右击menu文件夹-&gt;New-&gt;Menu resource file，文件名输入main，点击OK完成创建。创建完成后打开main.xml文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/menu&gt;</span><br></pre></td></tr></table></figure>
<p>在里面添加代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line">    &lt;item</span><br><span class="line">        android:id=&quot;@+id/add_item&quot;</span><br><span class="line">        android:title=&quot;Add&quot;/&gt;</span><br><span class="line">    &lt;item</span><br><span class="line">        android:id=&quot;@+id/remove_item&quot;</span><br><span class="line">        android:title=&quot;Remove&quot;/&gt;</span><br><span class="line">&lt;/menu&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们创建了两个菜单项，其中<item>标签是用来创建按具体的某一个菜单项，然后通过android:id给这个菜单指定一个唯一的标识符，通过android:title给这个菜单项指定一个名称。<br>&emsp;&emsp;回到FirstActivity中来重写onCreatOptionMenu()方法，重写方法可以使用Ctrl+O快捷键。</item></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line">        getMenuInflater().inflate(R.menu.main,menu);  <span class="comment">//这一行是我们编写的</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onCreateOptionsMenu(menu);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;通过getMenuInflater()方法能够得到MenuInflater对象，再调用它的indalte()方法就可以给当前活动创建菜单了。infalte()方法接收两个参数，第一个参数用于指定我们通过哪一个资源文件，这里传入<code>R.menu.main</code>。第二个参数用于指定我们的菜单项将添加到哪一个Menu对象中，这里直接使用onCreateOptionsMenu()方法中传入的menu参数。给这个方法返回true，表示与允创建的菜单显示出来，如果返回flase，创建的菜单将无法显示。<br>&emsp;&emsp;定义菜单响应事件。再FirstActivity中重写onOptionsItemSelected()方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public boolean onOptionsItemSelected(MenuItem item) &#123;</span><br><span class="line">        int itemId = item.getItemId(); // 可能是一个非常量值</span><br><span class="line">        if (itemId == R.id.add_item) &#123;</span><br><span class="line">            Toast.makeText(this, &quot;You click Add&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125; else if (itemId == R.id.remove_item) &#123;</span><br><span class="line">            Toast.makeText(this, &quot;You click Remove&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 处理默认情况</span><br><span class="line">        &#125;</span><br><span class="line">        return super.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在onOptionsItemSelected()方法中，通过调用item.getItemId()来判断我们点击的是哪一个菜单项，然后给每个菜单项加入自己的逻辑。<br>重新运行程序，会发现标题栏的右侧多了一个三点的符号，这个就是菜单按钮了。</p>
<h2 id="销毁一个活动"><a href="#销毁一个活动" class="headerlink" title="销毁一个活动"></a>销毁一个活动</h2><p>现在已经学会了手动创建活动的方法，并且在活动中创建Toast和创建菜单。现在要学习销毁一个活动。<br>很简单，只要按一下Back键就可以销毁当前的活动了。当然还可以通过程序中的代码来销毁活动，Activity类提供了一个finish()方法，我们在活动中调用这个方法就可以销毁当前活动了。<br>修改按钮监听器中的代码，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.first_layout);</span><br><span class="line">    Button button1 = (Button) findViewById(R.id.button);</span><br><span class="line">    button1.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(View v) &#123;</span><br><span class="line">            Toast.makeText(FirstActivity.this,&quot;You click Button&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">            finish();  //这里加上之后，当点击按钮时，会退出程序。</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用Intent在活动之间穿梭"><a href="#使用Intent在活动之间穿梭" class="headerlink" title="使用Intent在活动之间穿梭"></a>使用Intent在活动之间穿梭</h1><h2 id="使用显式Intent"><a href="#使用显式Intent" class="headerlink" title="使用显式Intent"></a>使用显式Intent</h2><p>&emsp;&emsp;快速在ActivityTest项目中再创建一个活动。这里创建活动还是新建一个class文件，然后把代码搬过来就OK了。<br>&emsp;&emsp;给布局文件起名为second_layout。<br>&emsp;&emsp;编辑second_layout.xml，定义一个按钮显示Button2。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout_editor_absoluteX</span>=<span class="string">&quot;170dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout_editor_absoluteY</span>=<span class="string">&quot;104dp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们在SecondActivity中加载布局</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.second_layout);  <span class="comment">//加载布局</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>接下来是在AndroidManifest.xml中注册活动</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:dataExtractionRules</span>=<span class="string">&quot;@xml/data_extraction_rules&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fullBackupContent</span>=<span class="string">&quot;@xml/backup_rules&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.ActivityTest&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:targetApi</span>=<span class="string">&quot;31&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.FirstActivity&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:label</span>=<span class="string">&quot;@string/title_activity_first&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.ActivityTest&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.SecondActivity&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">activity</span>&gt;</span> //注册活动</span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;由于SecondActivity不是主活动，因此不需要配置<intent-filter>标签里的内容。<br>&emsp;&emsp;现在第二个活动创建完成，接下来就是如何启动这第二个活动，这里我们引入一个新概念：Intent。<br>&emsp;&emsp;Intent是Android程序中各组件之间进行交互的一种重要方式，不仅可以指明当前组件想要执行的动作，还可以在不同组件之间传递数据。Intent一般可被用于启动活动、启动服务以及发送广播等场景，由于服务、广播等概念暂未涉及，现在就把目光锁定在启动活动上。<br>&emsp;&emsp;Intent大致可以分为两种：显式Intent和隐式Intent，先来看显式Intent如何使用。<br>&emsp;&emsp;Intent有多个构造函数的重载，其中一个是Intent(Context packageContext, Class&lt;?&gt;cls)。这个构造函数接收两个参数，第一个参数Context要求提供一个启动活动的上下文，第二个参数class则是指定想要启动的目标活动，通过这个构造函数就可以构建出Intent的”意图”。<br>&emsp;&emsp;我们怎么使用Intent呢？Activity类中提供了一个startActivity()方法，这个方法是专门用于启动活动的，它接受一个Intent参数，我们将构建好的Intent传入startActivity()方法就可以启动目标活动了。<br>&emsp;&emsp;修改FirstActivity中按钮的点击事件，如下：</intent-filter></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        Toast.makeText(FirstActivity.this,&quot;You click Button&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">        Intent intent=new Intent(FirstActivity.this,SecondActivity.class);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们首先构建出了一个Intent，传入FirstActivity.this作为上下文，传入SecondActivity.class作为目标活动，这样我们的意图就是在FirstActivity这个活动的基础上打开SecondActivity这个活动。通过startActivity()这个方法来执行Intent。<br>&emsp;&emsp;运行程序，在FirstActivity的界面上点击按钮，就会启动SecondActivity这个活动，如果想回到上一个活动，按下Back键就会销毁当前活动，回到上一个活动。<br>&emsp;&emsp;这种方式Intent的“意图”非常明显，我们称之为显式Intent。</p>
<h2 id="使用隐式Intent"><a href="#使用隐式Intent" class="headerlink" title="使用隐式Intent"></a>使用隐式Intent</h2><p>隐式Intent很含蓄，它并不明确指出我们想要启动哪个活动，而是指定一系列更为抽象的action和categoty等信息，然后交给系统去分析则会个Intent，并找出合适的活动去启动，简单讲就是可以响应我们这个隐式Intent的活动。<br>&emsp;&emsp;通过在<action>标签下配置<intent-filter>的内容，可以指定当前活动能够响应的action和category，打开AndroidManifest.xml，添加代码：</intent-filter></action></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.SecondActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.activitytest.ACTION_START&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在<action>标签中指明当前活动可以响应com.example.activity.ACTION_START这个action，而<category>标签则包含了一些附加信息，更精确指明当前活动能够响应的Intent中还可能带有的category。只有<action>和<category>中的内容同时能够匹配上Intent中指定的action和category时，这个活动才能响应该Intent。<br>&emsp;&emsp;修改FirstActivity中按钮事件，代码如下：</category></action></category></action></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">    Toast.makeText(FirstActivity.<span class="built_in">this</span>,<span class="string">&quot;You click Button&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">    Intent intent=<span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;com.example.activitytest.ACTION_START&quot;</span>);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们使用了Intent的另一个构造函数，直接将action的字符串传了进去，表名我们想要启动能够响应com.example.activity.ACTIN_START这个action的活动。而android.intent.category.DEFAULT是一种默认的category，在调用startActivity()方法时会自动将则会个category添加到Intent中。<br>&emsp;&emsp;重新运行程序，在FirstActivity界面点击一下按钮，同样启动了SecondActivity了。不同的是，这次使用了隐式Intent的方式来启动的，说明我们在<activity>标签下配置的action和category生效了。<br>&emsp;&emsp;每个Intent中只能指定一个action，但却能指定多个category。我们目前的Intent中只有一个默认的category，那现在再来增加一个。<br>&emsp;&emsp;修改FirstActivity中按钮的点击事件，代码如下：</activity></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onClick(View v) &#123;</span><br><span class="line">    Toast.makeText(FirstActivity.this,&quot;You click Button&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">    Intent intent=new Intent(&quot;com.example.activitytest.ACTION_START&quot;);</span><br><span class="line">    intent.addCategory(&quot;com.example.activitytest.MY_CATEGORY&quot;);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;调用Intent中的addCategory()方法来添加一个category，这里我们指定了一个自定义的category，值为<code>com.example.activitytest.MY_CATEGORY</code>。<br>&emsp;&emsp;运行程序，在FirstActivity的界面点击一下按钮，会发现程序崩溃了。我们到logcat界面查看错误日志，会看到<br><img src="/2024/04/04/android-Activity/3.png"><br>&emsp;&emsp;提醒我们没有任何一个活动可以响应我们的Intent，因为我们刚刚在Intent中新增了一个category，而SecondActivity的<intent-filter>标签中并没有声明可以响应这个category，就出现了没有任何活动可以响应Intent的情况。我们现在在<intent-filter>中添加category的声明，如下：</intent-filter></intent-filter></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">    android:name=&quot;.SecondActivity&quot;</span><br><span class="line">    android:exported=&quot;true&quot;&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">         &lt;action android:name=&quot;com.example.activitytest.ACTION_START&quot;/&gt;</span><br><span class="line">         &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</span><br><span class="line">         &lt;category android:name=&quot;com.example.activitytest.MY_CATEGORY&quot;/&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>再次运行程序，就正常了。</p>
<h2 id="更多隐式Intent的用法"><a href="#更多隐式Intent的用法" class="headerlink" title="更多隐式Intent的用法"></a>更多隐式Intent的用法</h2><p>&emsp;&emsp;实际上隐式Intent还有很多的内容要了解。<br>&emsp;&emsp;使用隐式Intent，不仅可以启动自己程序内的活动，还可以启动其他程序的活动。比如说在自己的应用程序中展示一个网页，这时没必要自己去实现一个浏览器，而是只需要调用系统的浏览器来打开这个网页就行了。<br>&emsp;&emsp;修改FirstActivity中按钮点击事件的代码，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        intent.setData(Uri.parse(&quot;http://www.baidu.com&quot;));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们首先指定Intent的action是Intent.ACTION_VIEW，这是Android系统内置的动作，其常量值为android.intent.action.VIEW。然后通过Uri.parse()方法，将一个网址字符串解析成一个Uri对象，再调用Intent的setData()方法将这个Uri对象传递进去。<br>&emsp;&emsp;重新运行程序，在FirstActivity界面点击按钮就可以看到打开了系统浏览器。<br>&emsp;&emsp;上述代码中出现了一个方法setData()，它接收一个Uri对象，主要用于指定当前Intent正在操作的数据，而这些数据通常都是以字符串的形式传入到Uri.parse()方法中解析产生的。<br>&emsp;&emsp;与此对应，我们还可以在<intent-filter>标签中再配置一个<data>标签，用于更精确地指定当前活动能够响应什么类型的数据。<data>标签中主要可以配置以下内容。</data></data></intent-filter></p>
<ul>
<li>android:scheme。用于指定数据的协议部分，如上例中的http部分。</li>
<li>android:host。用于指定数据的主机名部分，如上例中的<a target="_blank" rel="noopener" href="http://www.baidu.com部分./">www.baidu.com部分。</a></li>
<li>android:port。用于指定数据的端口部分，一般紧随在主机名之后。</li>
<li>android:path。用于指定主机名和端口之后的部分，一般紧随在主机名之后。</li>
<li>android:mimeType。用于指定可以处理的数据类型，允许使用通配符的方式进行指定。</li>
</ul>
<p>&emsp;&emsp;只有<data>标签中指定的内容和Intent中携带的Data完全一致时，当前活动才能够响应该Intent。不过一般再<data>标签中不会指定过多内容，上述浏览器示例中，其实只需要指定android:scheme为http，就可以响应所有的http协议的Intent。<br>&emsp;&emsp;为了更直观理解，我们自己建立一个活动，让它也能响应网页的Intent。<br>右击com.example.activity包-&gt;New-&gt;Activity-&gt;Empty Activity，新建ThirdActivity，勾选Generate Layout File，给布局文件起名为third_layout，点击finish完成创建。然后编辑third_layout.xml将里面的代码替换为：</data></data></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">    android:name=&quot;.ThirdActivity&quot;</span><br><span class="line">    android:exported=&quot;true&quot;&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">        &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;</span><br><span class="line">        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span><br><span class="line">        &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot;/&gt;</span><br><span class="line">        &lt;data android:scheme=&quot;http&quot;/&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们在ThirdActivity的<intent-filter>中配置了当前活动能够响应的action时Intent.ACTION_VIEW的常量值，而category指定了默认的category值，在<data>标签中通过android:scheme指定了数据的协议必须是http协议，这样ThirdActivity应该就和浏览器一样，能够响应一个打开网页的Intent了。<br>&emsp;&emsp;运行程序，在FirstActivity的界面点击按钮。点击了之后，系统会自动弹出一个列表（我的手机上显示的是chome和ActivityTest），显示能响应则会个Intent的所有程序。选择chome就是和之前一样打开浏览器，显示百度主页，而选择Activity，则会启动ThirdActivity。虽然我们声明了ThirdActivity可以响应网页的Intent，但实际上这个活动并没有加载并显示网页的功能。<br>&emsp;&emsp;除了http协议外，我们还能指定许多其他协议，如geo表示地理位置，tel表示拨打电话。在程序中调用系统拨号界面：</data></intent-filter></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_DIAL);</span><br><span class="line">        intent.setData(Uri.parse(&quot;tel:10086&quot;));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;首先指定了Intent的action是Intent.ACTION_DIAL，这也是Android系统的内置动作。在data部分指定了协议是tel，号码是10086。重新运行程序，在FirstActivity界面点击按钮，就会跳转到拨号界面，而且拨号的内容是10086。</p>
<h2 id="向下一个活动传递数据"><a href="#向下一个活动传递数据" class="headerlink" title="向下一个活动传递数据"></a>向下一个活动传递数据</h2><p>&emsp;&emsp;Intent中提供了一系列putExtra()方法的重载，可以把我们想要传递的数据暂存在Intent中，启动了另一个活动之后，只需把这些数据再从Intent中取出就可以了。<br>&emsp;&emsp;FirstActivity中有一个字符串，现在想要把这个字符串传递到SecondActivity中，就可以编写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        String data = &quot;Hello SecondActivity&quot;;</span><br><span class="line">        Intent intent = new Intent(FirstActivity.this,SecondActivity.class);</span><br><span class="line">        intent.putExtra(&quot;extra_data&quot;,data);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里用显式Intent的方式来启动SecondActivity，并通过putExtra()方法传递了一个字符串。这里putExtra()方法接收两个参数，第一个参数是键，用于后面从Intent中取值，第二个参数才是真正要传递的数据。<br>&emsp;&emsp;然后我们在SecondActivity中将传递的数据取出，并打印出来，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class SecondActivity extends AppCompatActivity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.second_layout);</span><br><span class="line">        Intent intent = getIntent();</span><br><span class="line">        String data = intent.getStringExtra(&quot;extra_data&quot;);</span><br><span class="line">        Log.d(&quot;SecondActivity&quot;,data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;首先通过getIntent()方法获取到用于启动SecondActivity的Intent，然后调用getStringExtra()方法，传入相应的键值，就可以得到传递的数据了。这里我们传递的是字符串，所以用getStringExtra()方法来获取传递的数据。若是整型数据，则使用getIntExtra()方法；若是布尔型数据，则使用getBooleanExtra()方法。<br>&emsp;&emsp;重新运行程序，在FirstActivity界面点击按钮会跳转到SecondActivity，查看logcat打印信息。<br><img src="/2024/04/04/android-Activity/4.png"><br>能看到成功从SecondActivity中得到了FirstActivity传递过来的数据。</p>
<h2 id="返回数据给上一个活动"><a href="#返回数据给上一个活动" class="headerlink" title="返回数据给上一个活动"></a>返回数据给上一个活动</h2><p>&emsp;&emsp;返回上一个活动只需要按一下Back键就可以了，并没有用于启动活动Intent来传递数据。如果查阅文档的话，会发现，Activity中还有一个startActivityForResult()方法也是用于启动活动的，但这个方法期望在活动销毁的时候能够返回一个结果给上一个活动。<br>&emsp;&emsp;startActivityForResult()方法接收两个参数，第一个参数还是Intent，第二个参数是请求码，用于在之后的回调中判断数据的来源。<br>&emsp;&emsp;我们来实战，修改FirstActivity中按钮的点击事件，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        Intent intent = new Intent(FirstActivity.this,SecondActivity.class);</span><br><span class="line">        startActivityForResult(intent,1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这里我们使用startActivityForResult()来启动SecondActivity，请求码只要是一个唯一值就可以了，这里传入了1。接下来我们在SecondActivity中给按钮注册点击事件，并在点击事件中添加返回数据的逻辑，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class SecondActivity extends AppCompatActivity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.second_layout);</span><br><span class="line">        Button button2 = (Button) findViewById(R.id.button2);</span><br><span class="line">        button2.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Intent intent = new Intent();</span><br><span class="line">                intent.putExtra(&quot;data_return&quot;,&quot;Hello FirstActivity&quot;);</span><br><span class="line">                setResult(RESULT_OK,intent);</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们创建了一个Intent，这个Intent仅仅是用于传递数据而已，没有指定任何的“意图”。紧接着把要传递的数据存放在Intent中，然后调用setResult()方法。这个方法很重要，是专门用于向上一个活动返回数据的。setResult()方法接收两个参数，第一个参数用于向上一个活动返回处理结果，，一般只使用RESULT_OK或RESULT_CANCELED这两个值，第二个参数则是把带有数据的Intent传递回去，然后调用finish()方法来销毁当前活动。<br>&emsp;&emsp;由于我们是使用startActivityForResult()方法来启动SecondActivity，在SecondActivity被销毁之后会回调上一个活动的onActivityResult()方法，因此我们需要在FirstActivity中重写这个方法来得到 返回的数据，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) &#123;</span><br><span class="line">    super.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">    switch (requestCode)&#123;</span><br><span class="line">        case 1:</span><br><span class="line">            if (resultCode == RESULT_OK)&#123;</span><br><span class="line">                String returnedData = data.getStringExtra(&quot;data_return&quot;);</span><br><span class="line">                Log.d(&quot;FirstActivity&quot;,returnedData);</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;onActivityResult()方法带有三个参数，第一个参数requestCode，即在我们启动活动时传入的请求码。第二个参数resultCode，即我们在返回数据时的处理结果。第三个参数data，即携带返回数据的Intent。由于在一个活动中有可能调用startActivityForResult()方法去启动很多不同的活动，每一个活动返回的数据都会回调到onActivityResult()这个方法中，因此我们首先要做的就是通过检查requestCode的值来判断数据来源。确定数据是从SecondActivity返回的之后，我们通过resultCode的值来判断结果处理是否成功。最后从data中取值并打印出来，这样就完成了向上一个活动返回数据的工作。<br>&emsp;&emsp;重新运行程序，在FirstActivity的界面点击按钮会打开SecondActivity，然后在SecondActivity界面点击Button2按钮会回到FirstActivity，这时查看logcat的打印信息<br><img src="/2024/04/04/android-Activity/5.png"><br>&emsp;&emsp;这时SecondActivity已经成功返回数据给FirstActivity了。<br>&emsp;&emsp;如果用户在SecondActivity中并不是通过点击按钮，而是通过按下Back键回到FirstActivity,这样数据就没法返回了。但是我们可以通过在SecondActivity中重写onBackPressed()方法来解决这个问题，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onBackPressed() &#123;</span><br><span class="line">    super.onBackPressed();</span><br><span class="line">    Intent intent = new Intent();</span><br><span class="line">    intent.putExtra(&quot;data_return&quot;,&quot;Hello FirstActivity Back&quot;);</span><br><span class="line">    setResult(RESULT_OK,intent);</span><br><span class="line">    finish();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样子，按下Back键，就会执行onBackPressed()方法中的代码，我们在这里添加返回数据的逻辑就可以了。<br>这里我按下Back，并没有生效。暂未解决，后续解决了再来补充。</p>
<h1 id="活动的声明周期"><a href="#活动的声明周期" class="headerlink" title="活动的声明周期"></a>活动的声明周期</h1><h2 id="返回栈"><a href="#返回栈" class="headerlink" title="返回栈"></a>返回栈</h2><p>&emsp;&emsp;Android中的活动是可以层叠的。我们每启动一个新的活动，就会覆盖在原活动之上，然后点击Back键就会销毁最上面的活动，下面的一个活动就会重新显示出来。<br>&emsp;&emsp;Android是使用任务(Task)来管理活动的，一个任务就是一组存放在栈里的活动的集合，这个栈也被称作返回栈(Back Stack)。栈是一种后进先出的数据结构，默认情况下，当我们启动了一个新的活动，它会返回栈中入栈，并处于栈顶的位置，每当我们按下Back键或调用finish()方法去销毁一个活动时，处于栈顶的活动会出栈，这时前一个栈的活动就会重新处于栈顶的位置。系统总是会显示处于栈顶的活动给用户。  </p>
<h2 id="活动状态"><a href="#活动状态" class="headerlink" title="活动状态"></a>活动状态</h2><p>&emsp;&emsp;每一个活动在其生命周期中最多会有4中状态。<br><strong>1.运行状态</strong><br>当一个活动位于返回栈的栈顶时，这时活动就会处于运行状态。<br><strong>2.暂停状态</strong><br>当一个活动不再处于栈顶位置，但仍然可见时，活动就进入了暂停状态。处于暂停状态的活动仍然存活着，只有在内存极低的情况下，系统才会去考虑回收这种活动。<br><strong>3.停止状态</strong><br>当一个活动不再处于栈顶位置，并且完全不可见的时候，就进入了停止状态，系统仍然会为这种活动保存相应的状态和成员变量，当其他地方需要内存时，处于暂停状态的活动有可能会被系统回收。<br><strong>4.销毁状态</strong><br>当一个活动从返回栈中移除后就变成了销毁状态。 </p>
<h2 id="活动的生存期"><a href="#活动的生存期" class="headerlink" title="活动的生存期"></a>活动的生存期</h2><p>&emsp;&emsp;Activity类中定义了7个回调方法，覆盖了活动生命周期的每一个环节。</p>
<ul>
<li>onCreate()。在活动第一次被创建的时候被调用。在这个方法中完成活动的初始化操作，如加载布局、绑定事件等。</li>
<li>onStart()。这个方法在活动由不可见变为可见的时候调用。</li>
<li>onResume()。这个方法在活动准备好和用户进行交互的时候调用。此时活动一定位于返回栈的栈顶，并且处于运行状态。</li>
<li>onPause()。这个方法在系统中准备去启动或者恢复另一个活动的时候调用。我们通常会在这个方法中将一些消耗CPU的资源释放掉，以及保存一些关键数据，但这个方法的执行速度一定要快，不然影响到新的栈顶活动的使用。  </li>
<li>onStop()。这个方法咋活动完全不可见的时候调用。它和onPause()方法的主要区别在于，如果启动的新活动是一个对话框的活动，那么onPause()方法会得到执行，而onStop()方法并不会执行。</li>
<li>onDestory()。这个方法在活动被销毁之前调用，之后活动的状态将变为销毁状态。</li>
<li>onRestart()。这个方法在活动由停止状态变为运行状态之前调用，也就是活动被重新启动了。</li>
</ul>
<p>活动可以分为三种生存期  </p>
<ul>
<li><strong>完整生存期</strong>。活动在onCreat()方法和onDestory之间所经历的，就是完整生存期。一般情况下，一个活动会在onCreat()方法中完成各种初始化操作，而在onDestory()方法中完成释放内存的操作。  </li>
<li><strong>可见生存期</strong>。活动在onStart()方法和onStop()方法之间经历的，就是可见生存期。在可见生存期内，活动对于用户总是可见的，即便有可能无法和用户进行交互。我们可以通过这两个方法，合理地管理那些对用户可见的资源。</li>
<li><strong>前台生存期</strong>。活动在onResume()方法和onPause()方法之间经历的就是前台生存期。在前台生存期，活动总是处于运行状态的，此时的活动是可以和用户进行交互的。</li>
</ul>
<h2 id="体验活动的生命周期"><a href="#体验活动的生命周期" class="headerlink" title="体验活动的生命周期"></a>体验活动的生命周期</h2><p>&emsp;&emsp;通过一个实例，更加直观地体验活动的生命周期。<br>&emsp;&emsp;关闭ActivityTest项目，新建一个ActivityLifeCycleTest项目，这次允许Android Studio为我们自动创建活动和布局，并且勾选Launcher Activity来创建的活动设置为主活动。<br>&emsp;&emsp;主活动创建完成，我们再分别创建两个子活动NormalActivity和DialogActivity，并且为其创建布局文件normal_layout和dialog_layout。<br>&emsp;&emsp;编辑normal_layout.xml文件，将里面的代码替换为如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textView&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Tihs is a normal activity&quot;  //添加了一个TextView元素</span><br><span class="line">        tools:layout_editor_absoluteX=&quot;168dp&quot;</span><br><span class="line">        tools:layout_editor_absoluteY=&quot;85dp&quot; /&gt;</span><br><span class="line">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这个布局中我们就简单的使用了一个TextView，用于显示一行文字。<br>&emsp;&emsp;然后编辑dialog_layout.xml文件，将里面的代码替换为如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textView2&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;This is a dialog activity&quot;</span><br><span class="line">        tools:layout_editor_absoluteX=&quot;162dp&quot;</span><br><span class="line">        tools:layout_editor_absoluteY=&quot;112dp&quot; /&gt;</span><br><span class="line">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>
<p>两个布局文件的代码几乎没有区别，知识显示的文字不同而已。从名字可以看出一个是普通的活动，一个是对话框式的活动。如何体现活动设成对话框式的呢，修改AndroidManifest.xml的<activity>标签的配置: </activity></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity android:name=&quot;.NormalActivity&quot;</span><br><span class="line">    android:exported=&quot;true&quot;&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/activity&gt;</span><br><span class="line">&lt;activity android:name=&quot;.DialogActivity&quot;</span><br><span class="line">    android:exported=&quot;true&quot;</span><br><span class="line">    android:theme=&quot;@style/Theme.AppCompat.Dialog&quot;&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这是两个活动的注册码，在DialogActivity中，我们给它添加了一个<code>android:theme</code>属性，用于指定主题的，Android系统内置有很多主题可以选择，我们也可以制定自己的主题，而这里<code>@android:style/Theme.Dialog</code>是使用对话框式的主题。<br>&emsp;&emsp;修改activity_main.xml，重新定制主活动的布局，将里面的代码替换成如下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/start_normal_activity&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Start NormalActivity&quot;</span><br><span class="line">        tools:layout_editor_absoluteX=&quot;133dp&quot;</span><br><span class="line">        tools:layout_editor_absoluteY=&quot;81dp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/start_dialog_activity&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Start DialogActivity&quot;</span><br><span class="line">        tools:layout_editor_absoluteX=&quot;137dp&quot;</span><br><span class="line">        tools:layout_editor_absoluteY=&quot;211dp&quot; /&gt;</span><br><span class="line">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们加入了两个按钮，一个用于启动NormalActivity，一个用于启动DialogActivity。然后修改MainActivity中的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Button start_normal_activity = (Button) findViewById(R.id.start_normal_activity);</span><br><span class="line">        Button start_dialog_activity = (Button) findViewById(R.id.start_dialog_activity);</span><br><span class="line">        start_normal_activity.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Intent intent = new Intent(MainActivity.this,NormalActivity.class);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        start_dialog_activity.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Intent intent = new Intent(MainActivity.this,DialogActivity.class);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onStart() &#123;</span><br><span class="line">        super.onStart();</span><br><span class="line">        Log.d(TAG,&quot;onStart&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onResume() &#123;</span><br><span class="line">        super.onResume();</span><br><span class="line">        Log.d(TAG,&quot;onResume&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onPause() &#123;</span><br><span class="line">        super.onPause();</span><br><span class="line">        Log.d(TAG,&quot;onPause&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onStop() &#123;</span><br><span class="line">        super.onStop();</span><br><span class="line">        Log.d(TAG,&quot;onStop&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        Log.d(TAG,&quot;onDestory&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onRestart() &#123;</span><br><span class="line">        super.onRestart();</span><br><span class="line">        Log.d(TAG,&quot;onDestory&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在onCreate()方法中，我们分别为两个按钮注册了点击事件，点击第一个按钮会启动NormalActivity，点击第二个按钮会启动DialogActivity。</p>
<h3 id="修bug"><a href="#修bug" class="headerlink" title="修bug"></a>修bug</h3><p>&emsp;&emsp;程序运行出来之后，两个按钮的位置重叠在一起了。我起初使用的方法是将布局文件里的根元素<code>androidx.constraintlayout.widget.ConstraintLayout</code>改为了<code>LinearLayout</code>，两个按钮分开了，但是还有一个问题就是点击<code>Start NormalActivity</code>出现的是空白页面，然后我发现是在<code>NormalActivity</code>活动没有加载布局，修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.normal_layout);  //加载布局</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;同时，我搜集到有关ConstraintLayout的信息是</p>
<blockquote>
<p>如果将 ConstraintLayout 更改为 LinearLayout 后按钮不再重叠，这可能是因为 LinearLayout 使用了默认的排列方式，即垂直或水平排列，使得视图在布局中自动按顺序排列，而不会重叠。但是，这并不意味着问题已经完全解决，而只是绕过了布局问题。</p>
</blockquote>
<blockquote>
<p>使用 LinearLayout 可能会限制您在布局中实现复杂的 UI 结构和定位。 ConstraintLayout 提供了更灵活和强大的布局功能，允许您以更精确的方式定位和对齐视图。因此，我建议您尝试使用 ConstraintLayout 并逐步解决按钮重叠问题，以便更好地利用其功能。</p>
</blockquote>
<blockquote>
<p>关于按钮的位置应该会在学UI时得到解决。</p>
</blockquote>
<p>观察logcat的打印日志<br><img src="/2024/04/04/android-Activity/6.png"><br>&emsp;&emsp;MainActivity第一次被创建时会依次执行 onCreat()、onStart()和onResume()方法。<br>&emsp;&emsp;启动第一个按钮，启动NormalActivity。打印信息：<br><img src="/2024/04/04/android-Activity/7.png"><br>&emsp;&emsp;由于NormalActivity已经把mainActivity完全遮住，因此onPause()和onStop()都会得到执行。然后按下Back键返回MainActivity。打印信息：<br><img src="/2024/04/04/android-Activity/8.png"><br>&emsp;&emsp;由于之前MainActivity已经进入停止状态，所以onRestart()方法会得到执行，之后依次执行onStart()和onResume()方法。此时onCreate方法不会执行，因为MainActicity并没有重建。<br>&emsp;&emsp;点击第二个按钮，启动DialogActivity。打印信息：<br><img src="/2024/04/04/android-Activity/9.png"><br>&emsp;&emsp;只有onPause()方法得到了执行，onStop()方法并没有得到执行，因为DialogActivity并没有完全遮住MainActivity，此时MainActivity只是进入了暂停状态，并没有停止。相应的，按下Back键返回MainActivity也应该只有onResume方法会得到执行：<br><img src="/2024/04/04/android-Activity/10.png"><br>最后在MainActicity按下Back键退出程序<br><img src="/2024/04/04/android-Activity/11.png"><br>&emsp;&emsp;依次执行onPause()、onStop()、onDestory()方法，最终销毁MainActivity。</p>
<h2 id="活动被回收了怎么办"><a href="#活动被回收了怎么办" class="headerlink" title="活动被回收了怎么办"></a>活动被回收了怎么办</h2><p>&emsp;&emsp;当一个活动进入停止状态，是有可能被系统回收的。场景：应用中有一个活动A，用户在活动A的基础上启动了活动B，活动A就进入了停止状态，这时候由于内存不足，将活动A回收掉了，然后用户按下Back键返回活动A，其实还是会显示活动A，但这时不会执行onRestart()方法，而是会执行活动A的onCreat()方法，活动A被重新创建 了。<br>&emsp;&emsp;活动A中可能存在临时数据和状态。比如，MainActivity中有一个文本输入框，输入了一段文字，然后启动NormalActivity，这时MainActivity由于系统内存不足被回收掉了，过了一会点击Back键返回MainActivity,而刚刚输入的文字都没了，因为MainActivity被重新创建了。<br>&emsp;&emsp;Activity中还提供了一个onSaveInstanceState()回调方法，这个方法可以保证在活动回收之前一定会被调用，我们可以通过这个方法来解决活动被回收时临时数据得不到保存的问题。<br>&emsp;&emsp;onSaveInstanceState()方法会携带一个Bundle类型的参数，Bundle提供了一系列方法用于保存数据，比如putString()方法保存字符串，putInt()方法保存整型数据，类推。每个保存方法需要传入两个参数，第一个是键，用于从后面的Bundle中取值，第二个参数是真正要保存的内容。<br>在MainActivity中添加代码就可以将临时数据进行保存。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onSaveInstanceState(@NonNull Bundle outState) &#123;</span><br><span class="line">    super.onSaveInstanceState(outState);</span><br><span class="line">    String tempData = &quot;Something you just typed&quot;;</span><br><span class="line">    outState.putString(&quot;data_key&quot;,tempData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在onCreate()方法中也有一个Bundle类型的参数，这个参数在一般情况下都是null，但是如果活动被系统回收之前通过onSaveInstanceState()方法来保存数据的话，这个参数就会带有之前所有保存的全部数据，我们通过相应的取值方法将数据取出即可。<br>&emsp;&emsp;修改MainActicity的onCreat()方法，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Log.d(TAG,&quot;onCreat&quot;);</span><br><span class="line">        if(savedInstanceState != null)&#123;</span><br><span class="line">            String tempData = savedInstanceState.getString(&quot;data_key&quot;);</span><br><span class="line">            Log.d(TAG,tempData);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;取出值之后，再进行相应的操作即可，比如将文本内容重新赋值到文本输入框上，这里我们知识简单的打印以下。<br>&emsp;&emsp;使用Bundle来保存和取出数据和在使用Intent传递数据时也是用的类似的方法。Intent还可以结合Bundle一起用于传递数据，首先可以把需要传递的数据都保存在Bundle对象中，然后再将Bundle对象放在Intent里。到了目标活动之后再从Intent中取出Bundle，再从Bundle中一一取出数据。</p>
<h1 id="活动的启动模式"><a href="#活动的启动模式" class="headerlink" title="活动的启动模式"></a>活动的启动模式</h1><p>启动模式一共有4种，分别是standard、singleTop、singleTask和singleInstance，可以在AndroidManifest.xml中通过<activity>标签指定android:launchMode属性来选择启动模式。</activity></p>
<h2 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h2><p>&emsp;&emsp;standard是活动默认的启动模式，在不进行显示指定的情况下，所有活动都会自动使用这种启动模式。Android是使用返回栈来管理活动的，在standard模式下，每当启动一个新的活动，它就会在返回栈中入栈，并处于栈顶的位置。对于使用standard模式的活动，系统不会在乎这个活动是否已经在返回栈中存在，每次启动都会创建该活动的一个新的实例。<br>&emsp;&emsp;关闭ActivityLifeCycleTest项目，打开Activity项目。修改FirstActivity中onCreate()方法的代码，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    Log.d(&quot;FirstActivity&quot;,this.toString());</span><br><span class="line">    setContentView(R.layout.first_layout);</span><br><span class="line">    Button button1 = (Button) findViewById(R.id.button);</span><br><span class="line">    button1.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(View v) &#123;</span><br><span class="line">            Intent intent = new Intent(FirstActivity.this,FirstActivity.class);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这段代码是在FirstActivity的基础上启动FirstActivity，还在onCreate()方法中添加了一行打印信息，用于打印当前活动的实例。<br>&emsp;&emsp;现在重新运行程序，在FirstActivity界面连续点击两次按钮，可以在logcat看到:<br><img src="/2024/04/04/android-Activity/12.png"><br>可以看出，每点击一次按钮就会创建出一个新的FirstActivity实例。此时返回栈中会存在3个FirstActivity的实例，需要连按3次Back键才能退出程序。</p>
<h2 id="singleTop"><a href="#singleTop" class="headerlink" title="singleTop"></a>singleTop</h2><p>&emsp;&emsp;当活动的启动模式指定为singleTop，在启动活动时如果发现返回栈的栈顶已经是该活动，则认为可以直接使用它，不会再创建新的活动实例。<br><strong>实践</strong>：<br>修改AndroidManifest.xml中FirstActivity的启动模式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.FirstActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:launchMode</span>=<span class="string">&quot;singleTop&quot;</span>  //<span class="attr">here</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">&quot;@string/title_activity_first&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.ActivityTest&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>重新运行程序，查看logcat已经创建了一个FirstActivity：<br><img src="/2024/04/04/android-Activity/13.png"><br>&emsp;&emsp;之后不管点击多少次按钮都不会再有新的打印信息出现，因为目前FirstActivity已经处于返回栈的栈顶，每当想再启动一个FirstActivity时都会直接使用栈顶的活动，FirstActivity也只会有一个实例，仅按一次Back键就可以退出程序。<br>&emsp;&emsp;但当FirstActivity并未处于栈顶位置时，这时再启动FirstActivity还是会创建新的实例的。<br><strong>实践</strong><br>修改FirstActivity中onCreate()方法的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(<span class="string">&quot;FirstActivity&quot;</span>,<span class="built_in">this</span>.toString());</span><br><span class="line">        setContentView(R.layout.first_layout);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button1</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line">        button1.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(FirstActivity.<span class="built_in">this</span>,SecondActivity.class);  <span class="comment">//here</span></span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>点击按钮后启动的是SecondActivity。然后修改SecondActivity中onCreate()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.second_layout);</span><br><span class="line">    <span class="type">Button</span> <span class="variable">button2</span> <span class="operator">=</span> (Button) findViewById(R.id.button2);</span><br><span class="line">    button2.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(SecondActivity.<span class="built_in">this</span>,FirstActivity.class);  <span class="comment">//here</span></span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在SecondActivity中的按钮点击事件里加入了启动FirstActivity的启动代码。重新运行程序，在FirstActivity界面点击按钮进入SecondActivity，然后再SecondActivity界面点击按钮，又会进入到FirstActivity。<br>&emsp;&emsp;查看打印信息：<br><img src="/2024/04/04/android-Activity/14.png"><br>可以看到创建了两个不同的FirstActivity实例。按下Back键会回到SecondActivity，再次按下Back键又会回到FirstActivity,再按一次Back键才会退出程序。  </p>
<h2 id="singleTask"><a href="#singleTask" class="headerlink" title="singleTask"></a>singleTask</h2><p>当活动的启动模式指定为singleTask，每次启动该活动时系统首先会在返回栈中检查是否存在该活动的实例，如果发现已经存在则直接使用该实例，并把这个活动之上的所有活动统统出栈，如果没有发现就会创建一个新的活动实例。<br><strong>实践</strong><br>修改AndroidManifest.xml中的启动模式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.FirstActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:launchMode</span>=<span class="string">&quot;singleTask&quot;</span>  //<span class="attr">here</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">&quot;@string/title_activity_first&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.ActivityTest&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在FirstActivity中添加onRestart()方法，并打印日志：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onRestart() &#123;</span><br><span class="line">    super.onRestart();</span><br><span class="line">    Log.d(&quot;FirstActivity&quot;,&quot;onRestart&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在SecondActivity中添加onDestory()方法，并打印日志：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onDestroy() &#123;</span><br><span class="line">    super.onDestroy();</span><br><span class="line">    Log.d(&quot;SecondActivity&quot;,&quot;onDestory&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重新运行程序，在FirstActivity界面点击按钮进入到SecondActivity，然后在SecondActivity界面点击按钮，又会重新进入FirstActivity。<br><img src="/2024/04/04/android-Activity/15.png"><br><img src="/2024/04/04/android-Activity/16.png"><br>从打印信息中看出，在SecondActivity中启动FirstActivity时，会发现栈中已经存在一个FirstActivity的实例，并且是在SecondActivity的下面，于是SecondActivity会从返回栈中出栈，而FirstActivity重新成为了栈顶活动，FirstActivity的onRestart()方法和SecondActivity的onDestory()方法会得到执行。现在返回栈中只剩下一个FirstActivity的实例，按一下Back键就可以退出程序了。</p>
<h2 id="singleInstance"><a href="#singleInstance" class="headerlink" title="singleInstance"></a>singleInstance</h2><p>&emsp;&emsp;singleInstance模式应该算是四种启动模式中最特殊也是最复杂的一个了。指定为singleInstance模式的活动会启用一个新的返回栈来管理这个活动（如果singleTask模式指定了不同的taskAffinity，也会启动一个新的返回栈。）这样做的意义就是，假设我们的程序中有一个活动是允许其他程序调用的，我们想实现其他程序和我们的程序可以共享这个活动的实例，如何实现，前3种是做不到的，因为每个程序都会有自己的返回栈，同一个活动在不同的返回栈中入栈时必然是创建了新的实例。而是用singleInstance模式就可以解决这个问题，这种模式下会有一个单独的返回栈来管理这个活动，不管是哪个应用程序来访问这个活动，都公用的同一个返回栈，也就解决了共享活动实例的问题。<br><strong>实践</strong><br>修改AndroidManifest.xml中SecondActivity的启动模式。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.SecondActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:launchMode</span>=<span class="string">&quot;singleInstance&quot;</span>&gt;</span>  //here</span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.activitytest.ACTION_START&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.activitytest.MY_CATEGORY&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>先将SecondActivity的启动模式指定为singleInstance，然后修改FirstActivity中onCreate()方法的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    Log.d(<span class="string">&quot;FirstActivity&quot;</span>,<span class="string">&quot;Task id is&quot;</span>+getTaskId());  <span class="comment">//here</span></span><br><span class="line">    setContentView(R.layout.first_layout);</span><br><span class="line">    <span class="type">Button</span> <span class="variable">button1</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line">    button1.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(FirstActivity.<span class="built_in">this</span>,SecondActivity.class);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在onCreate()方法中打印当前返回栈的id。然后修改SecondActivity中onCreate()方法的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.second_layout);</span><br><span class="line">    Log.d(<span class="string">&quot;SecondActivity&quot;</span>,<span class="string">&quot;Task id is&quot;</span>+getTaskId());  <span class="comment">//here</span></span><br><span class="line">    <span class="type">Button</span> <span class="variable">button2</span> <span class="operator">=</span> (Button) findViewById(R.id.button2);</span><br><span class="line">    button2.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(SecondActivity.<span class="built_in">this</span>,ThirdActivity.class);  <span class="comment">//here</span></span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样是在onCreate()方法中打印当前返回栈的id,然后修改了按钮点击事件的代码，用于启动ThirdActivity。最后来修改ThirdActivity中onCreate()方法的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    Log.d(&quot;ThirdActivity&quot;,&quot;This id is&quot;+getTaskId());</span><br><span class="line">    setContentView(R.layout.third_layout);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>仍然是在onCreate()方法中打印了当前返回栈的id。<br>现在重新运行程序，在FirstActivity界面点击按钮进入到SecondActivity，然后在SecondActivity界面点击按钮进入ThirdActivity。查看logcat:<br><img src="/2024/04/04/android-Activity/17.png"><br><img src="/2024/04/04/android-Activity/18.png"><br><img src="/2024/04/04/android-Activity/19.png"><br>&emsp;&emsp;可以看到，SecondActivity的Task id不同于FirstActivity和ThirdActivity，这说明SecondActivity确实是存放在一个单独的返回栈里的，这且这个栈中只有SecondActivity这一个活动。<br>&emsp;&emsp;接着我们按下Back键进行返回，会发现ThirdActivity直接返回到了FirstActivity，再按下返回键又会返回到SecondActivity，再按下Back键才会退出程序。原理很简单，由于FirstActivity和SecondActivity会从返回栈中出栈，当在ThirdActivity的界面下按下Back键，ThirdActivity会从返回栈中出栈，那么FirstActivity就成为了栈顶活动显示在界面上，因此会出现从ThirdActivity直接返回到FirstActivity的情况。然后在FirstActivity界面再次按下Back键，这时当前的返回栈已经空了，于是就显示另一个返回栈的栈顶活动，即SecondActivity。最后按下Back键，这时所有的返回栈都已经空了，也就退出了程序。</p>
<h1 id="活动的最佳实践"><a href="#活动的最佳实践" class="headerlink" title="活动的最佳实践"></a>活动的最佳实践</h1><h2 id="知晓当前是在哪一个活动"><a href="#知晓当前是在哪一个活动" class="headerlink" title="知晓当前是在哪一个活动"></a>知晓当前是在哪一个活动</h2><p>在ActivityTest项目的基础上修改，首先需要新建一个BaseActivity类。右击com.example.activity包-&gt;New-&gt;Java Class，在弹出的窗口输入BaseActivity，不同的是，我们不需要让BaseActivity在AndroidManifest中注册，然后让BaseActivity继承自AppCompatActivity，并重写onCreate()方法，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class BaseActivity extends AppCompatActivity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(&quot;BaseActivity&quot;,getClass().getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在onCreate()方法中获取了当前实例的类名，并通过Log打印了出来。<br>&emsp;&emsp;让BaseActivity成为ActivityTest项目中所有活动的父类。修改FirstActivity、SecondActivity、ThirdActivity的继承结构，让他们不在继承自AppCompatActivity，而是继承自BaseActivity。而由于BaseActivity又是继承自AppCompatActivity的，所以项目中的活动的功能并不受影响，他们仍然完全继承了Activity中的所有特性。<br>&emsp;&emsp;重新运行程序，通过点击按钮分别进入到了FirstActivity、SecondActivity、ThirdActivity的界面，这时查看打印信息：<br><img src="/2024/04/04/android-Activity/20.png"></p>
<p>&emsp;&emsp;每当我们进入到一个活动的界面，该活动的类名就会被打印出来，就可以时时刻刻知晓当前界面对应的是哪一个活动了。  </p>
<h2 id="随时随地退出程序"><a href="#随时随地退出程序" class="headerlink" title="随时随地退出程序"></a>随时随地退出程序</h2><p>如果当前手机界面还停留在ThirdActivity，那么退出程序很不方便，需要连按3次Back键才行。按home键只是把程序挂起，并没有退出程序。解决思路就是用一个专门的集合类对所有的活动进行管理就可以了。新建一个ActivityCollector类作为活动管理器，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class ActivityCollector &#123;</span><br><span class="line">    public static List&lt;Activity&gt; activities = new ArrayList&lt;&gt;();</span><br><span class="line">    public static void addActivity(Activity activity)&#123;</span><br><span class="line">        activities.add(activity);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void removeActivity(Activity activity)&#123;</span><br><span class="line">        activities.remove(activity);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void finishAll()&#123;</span><br><span class="line">        for (Activity activity: activities)&#123;</span><br><span class="line">            if(!activity.isFinishing())&#123;</span><br><span class="line">                activity.finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在活动管理器中，我们通过一个List来暂存活动，然后提供一个addActivity()方法用于向List中添加一个活动，提供removeActivity()方法用于从List中移除活动，最后提供一个finish()方法用于将List中存储的活动全部销毁掉。<br>&emsp;&emsp;修改BaseActivity()中的代码，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class BaseActivity extends AppCompatActivity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(&quot;BaseActivity&quot;,getClass().getSimpleName());</span><br><span class="line">        ActivityCollector.addActivity(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        ActivityCollector.removeActivity(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在BaseActivity的onCreate()方法中调用ActivityCollector的addActivity()方法，表名将当前正在创建的活动添加到活动管理器中。然后重写了onDestory()方法，并调用ActivityCollector的removeActivity()方法，表名将一个马上要销毁的活动从活动管理器中移除。<br>&emsp;&emsp;接下来，不管想在什么地方退出程序，只需要调用ActivityCollector.finishAll()方法就可以了。<br>&emsp;&emsp;如在ThirdActivity界面想通过点击按钮直接退出程序，只需为修改代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class ThirdActivity extends BaseActivity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(&quot;ThirdActivity&quot;,&quot;This id is &quot;+getTaskId());</span><br><span class="line">        setContentView(R.layout.third_layout);</span><br><span class="line">        Button button3 = (Button) findViewById(R.id.button3);</span><br><span class="line">        button3.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                ActivityCollector.finishAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然还可以在销毁所有活动的代码后面加上杀掉当前进程的代码，以保证程序完全退出，杀掉进程的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.os.Process.killProcess(android.os.Process.myPid());</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;其中killProcess()方法用于杀掉一个进程，它接收一个进程id参数，我们通过myPid()方法来获得当前进程的id。注意：killProcess()方法只能用于杀掉当前程序的进程，不能使用这个方法杀掉其他程序。  </p>
<h2 id="启动活动的最佳写法"><a href="#启动活动的最佳写法" class="headerlink" title="启动活动的最佳写法"></a>启动活动的最佳写法</h2><p>&emsp;&emsp;启动活动的方法是是通过Intent构建出当前的“意图”，然后通过调用startActivity()或startActivityForResult()方法将活动启动起来，如果有数据需要从一个活动传递到另一个活动，也可以借助Intent完成。<br>&emsp;&emsp;假设SecondActivity中需要用到两个很重要的字符串参数，在启动SecondActivity的时候必须要传递过来，那么我们可以写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(FirstActivity.this,SecondActivity.class);</span><br><span class="line">intent.putExtra(&quot;param1&quot;,&quot;data1&quot;);</span><br><span class="line">intent.putExtra(&quot;param2&quot;,&quot;data2&quot;);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这样写没毛病，但是在真正的项目开发中经常会有对接的问题出现。比如SecondActivity并不是自己开发的，但现在自己负责的部分需要启动SecondActivity这个功能，却不清楚要传递哪些数据，这时就两种办法，一个是自己阅读SecondActivity中的代码，二是询问负责编写SecondActivity的同事。其实换一种写法就可以了，修改SecondActivity中的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static void actionStart(Context context,String data1,String data2)&#123;</span><br><span class="line">    Intent intent = new Intent(context,SecondActivity.class);</span><br><span class="line">    intent.putExtra(&quot;param1&quot;,data1);</span><br><span class="line">    intent.putExtra(&quot;param1&quot;,data2);</span><br><span class="line">    context.startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们在SecondActivity中添加了一个actionStart()方法，在这个方法中完成了Intent的构建，另外所有SecondActivity中需要的数据都是通过actionStart()方法的参数传递过来的，然后把他们存储到Intent中，最后调用startActivity方法启动SecondActivity。<br>&emsp;&emsp;这样写的好处就是，SecondActivity所需要的数据在方法参数中全部体现出来了，还可以简化代码，现在只需要一行代码就可以启动SecondActivity，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">button1.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">        SecondActivity.actionStart(FirstActivity.<span class="built_in">this</span>,<span class="string">&quot;data1&quot;</span>,<span class="string">&quot;data2&quot;</span>);    <span class="comment">//here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样写可以让启动活动变得非常简单。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Activity/" rel="tag">Activity</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/04/04/java-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" rel="prev" title="[java]流程控制">
                  <i class="fa fa-angle-left"></i> [java]流程控制
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/04/05/java-%E6%95%B0%E7%BB%84/" rel="next" title="[java]数组">
                  [java]数组 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">白乐天</span>
  </div>

<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/01/2024 00:00:00"); //修改为你的网站开始运行的时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>
    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
