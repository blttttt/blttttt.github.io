<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
<meta property="og:type" content="website">
<meta property="og:title" content="白乐天">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="白乐天">
<meta property="og:description" content="在安卓逆向和爬虫的道路上渐行渐远!">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="白乐天">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>白乐天</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">白乐天</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">35</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">17</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">52</span></a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="白乐天"
      src="/images/android.svg">
  <p class="site-author-name" itemprop="name">白乐天</p>
  <div class="site-description" itemprop="description">在安卓逆向和爬虫的道路上渐行渐远!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/blttttt" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;blttttt" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/05/07/vim/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/07/vim/" class="post-title-link" itemprop="url">vim</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-05-07 00:11:04 / 修改时间：00:19:35" itemprop="dateCreated datePublished" datetime="2024-05-07T00:11:04+08:00">2024-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/vim/" itemprop="url" rel="index"><span itemprop="name">vim</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>Linux通常都已经默认安装好了 vi 或 Vim 文本编辑器，我们只需要通过<code>vim</code>命令就可以直接打开vim编辑器了。  </p>
<h1 id="四种模式"><a href="#四种模式" class="headerlink" title="四种模式"></a>四种模式</h1><ul>
<li>命令模式<br>在该模式下可以移动光标位置，可以通过快捷键对文件内容进行复制、粘贴、删除等操作。</li>
<li>编辑模式或输入模式<br>在命令模式下输入小写字母a或小写字母i即可进入编辑模式，在该模式下可以对文件的内容进行编辑。</li>
<li>末行模式<br>在命令模式下输入冒号:即可进入末行模式，可以在末行输入命令来对文件进行查找、替换、保存、退出等操作。</li>
<li>可视化模式<br>可以做一些列选操作（通过方向键选择某些列的内容,类似于Windows鼠标刷黑）。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/05/06/kali-linux%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/06/kali-linux%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">kali-linux快捷键</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-05-06 23:20:51 / 修改时间：23:25:57" itemprop="dateCreated datePublished" datetime="2024-05-06T23:20:51+08:00">2024-05-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/kali/" itemprop="url" rel="index"><span itemprop="name">kali</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="鼠标从虚拟机退出到物理机"><a href="#鼠标从虚拟机退出到物理机" class="headerlink" title="鼠标从虚拟机退出到物理机"></a>鼠标从虚拟机退出到物理机</h3><p><code>Ctrl+Alt</code></p>
<h3 id="打开终端的快捷键"><a href="#打开终端的快捷键" class="headerlink" title="打开终端的快捷键"></a>打开终端的快捷键</h3><p><code>Ctrl+Alt+T</code></p>
<h3 id="从终端进入root"><a href="#从终端进入root" class="headerlink" title="从终端进入root"></a>从终端进入root</h3><p><code>sudo -i</code></p>
<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><p><code>reboot</code><br><code>shutdown -r now</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/05/06/%E5%9C%A8kali%E5%88%9B%E5%BB%BA%E5%A5%BD%E4%B9%8B%E5%90%8E%E8%BF%9B%E8%A1%8C%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E4%BF%AE%E6%94%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/06/%E5%9C%A8kali%E5%88%9B%E5%BB%BA%E5%A5%BD%E4%B9%8B%E5%90%8E%E8%BF%9B%E8%A1%8C%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E4%BF%AE%E6%94%B9/" class="post-title-link" itemprop="url">在kali虚拟机创建好之后进行的一系列修改</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-05-06 20:51:36 / 修改时间：23:15:54" itemprop="dateCreated datePublished" datetime="2024-05-06T20:51:36+08:00">2024-05-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/kali/" itemprop="url" rel="index"><span itemprop="name">kali</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="查看网络配置"><a href="#查看网络配置" class="headerlink" title="查看网络配置"></a>查看网络配置</h1><p>打开终端，可以使用快捷键<code>Ctrl+Alt+T</code><br>输入<code>ifconfig</code><br><img src="/2024/05/06/%E5%9C%A8kali%E5%88%9B%E5%BB%BA%E5%A5%BD%E4%B9%8B%E5%90%8E%E8%BF%9B%E8%A1%8C%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E4%BF%AE%E6%94%B9/1.png"></p>
<h1 id="apt更新和升级"><a href="#apt更新和升级" class="headerlink" title="apt更新和升级"></a>apt更新和升级</h1><p>更新软件包列表<br><code>sudo apt-get update</code><br>对软件包进行升级<br><code>sudo apt-get upgrade</code><br>这个过程很慢需要等很长时间。</p>
<h1 id="设置root密码"><a href="#设置root密码" class="headerlink" title="设置root密码"></a>设置root密码</h1><p>在终端输入<code>sudo -i</code><br>然后输入登录用户密码，回车，输入<code>passwd root</code>，用来修改root用户密码<br>然后输入新的root密码，接着回车，注意的是输入的密码不会显示。然后再重新输入新的root密码，然后回车就可以将root用户的密码给修改了。<br><img src="/2024/05/06/%E5%9C%A8kali%E5%88%9B%E5%BB%BA%E5%A5%BD%E4%B9%8B%E5%90%8E%E8%BF%9B%E8%A1%8C%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E4%BF%AE%E6%94%B9/2.png">   </p>
<h1 id="更改shell"><a href="#更改shell" class="headerlink" title="更改shell"></a>更改shell</h1><p>kali Linux在2020.3版本后默认的Shell不再是Bash而是Zsh，虽然Zsh的的自动提示等扩展功能很强大，但是后续Android系统的编译只支持Bash终端，因此需要更改Shell。<br><code>chsh -s /bin/bash</code><br><img src="/2024/05/06/%E5%9C%A8kali%E5%88%9B%E5%BB%BA%E5%A5%BD%E4%B9%8B%E5%90%8E%E8%BF%9B%E8%A1%8C%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E4%BF%AE%E6%94%B9/4.png"><br>重启系统前<br><img src="/2024/05/06/%E5%9C%A8kali%E5%88%9B%E5%BB%BA%E5%A5%BD%E4%B9%8B%E5%90%8E%E8%BF%9B%E8%A1%8C%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E4%BF%AE%E6%94%B9/3.png"><br>重启系统后<br><img src="/2024/05/06/%E5%9C%A8kali%E5%88%9B%E5%BB%BA%E5%A5%BD%E4%B9%8B%E5%90%8E%E8%BF%9B%E8%A1%8C%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E4%BF%AE%E6%94%B9/5.png"> </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">基本库的使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-28 20:40:18" itemprop="dateCreated datePublished" datetime="2024-04-28T20:40:18+08:00">2024-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-05-07 19:58:25" itemprop="dateModified" datetime="2024-05-07T19:58:25+08:00">2024-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">爬虫</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h1><p>urllib是一个Python库，利用它可以实现HTTP请求的发送，我们要做的是指定请求的URL、请求头、请求体等信息。此外urllib还可以把服务器返回的对象转化为Python对象，通过该对象可以方便地获取响应的相关信息，如响应状态码、响应头、响应体。<br>urllib库包含如下4个模块。</p>
<ul>
<li>request: 最基本的http请求模块，可以模拟请求的发送。</li>
<li>error: 异常处理模块。</li>
<li>parse: 一个工具模块。</li>
<li>robotparser: 主要用来识别网站的robots.txt文件，然后判断哪些网站可以爬，哪些网站不可以爬。</li>
</ul>
<h2 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h2><h3 id="urlopen"><a href="#urlopen" class="headerlink" title="urlopen"></a>urlopen</h3><p>urllib.request模块提供了最基本的构造HTTP请求的方法，利用这个模块可以模拟浏览器的请求发起过程。用百度测试</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/1.png"></p>
<blockquote>
<p>response.read()方法<br>属于urllib.response对象，用来从HTTP响应中读取数据。read()方法会读取HTTP响应的主体（body），这通常是你请求的页面的HTML内容或API返回的JSON数据等。read()方法返回的是字节串（bytes），因为HTTP协议传输的是字节数据。由于返回的是字节串，通常需要将其解码为字符串才能阅读。常见的解码方式是使用.decode(‘utf-8’)，这假设响应内容是使用UTF-8编码的。除了read()，urllib.response对象还提供了其他方法来读取数据，如readline()（读取一行数据）和readlines()（读取所有行并返回一个列表）。</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;http.client.HTTPResponse&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>
<p>这里响应的是<code>HTTPResponse</code>类型的对象，包含read、readinto、getheader、getheaders、fileno等方法。得到响应把它赋值给了response，可以通过response对象来调用哪些方法和属性。  </p>
<p>打印响应的属性</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.status)  //响应状态码</span><br><span class="line"><span class="built_in">print</span>(response.getheaders())  //响应头的信息</span><br><span class="line"><span class="built_in">print</span>(response.getheader(<span class="string">&quot;Server&quot;</span>))  //提供参数，获取响应头对应参数的信息</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>


<h3 id="data参数"><a href="#data参数" class="headerlink" title="data参数"></a>data参数</h3><p>&emsp;&emsp;data参数可选。在添加该参数的时候，需要使用bytes方法将参数转化为字节流编码格式的内容，即bytes类型。如果传递了这个参数，那么它的请求方式就不再是GET而是POST了。<br>我们请求的站点是<code>https://www.httpbin.org</code> ，它可以提供HTTP请求测试。本次请求的URL是 <code>https://www.httpbin.org/post</code>，这个连接可以测试POST请求，能够输出请求的一些信息，其中包含我们传递的data参数。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">data = <span class="built_in">bytes</span>(urllib.parse.urlencode(&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;germy&#x27;</span>&#125;),encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">response = urllib.request.urlopen(<span class="string">&#x27;https://www.httpbin.org/post&#x27;</span>,data)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>我们传递的参数出现在了form字段中，表明是模拟表单提交，以POST方式传输数据。<br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/2.png"></p>
<h3 id="timeout参数"><a href="#timeout参数" class="headerlink" title="timeout参数"></a>timeout参数</h3><p>&emsp;&emsp;设置超时时间，单位是秒，如果请求超出了设置的这个时间，还没有得到响应，就会抛出异常，如果不指定这个参数，会使用全局默认时间。<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">&#x27;https://www.httpbin.org/get&#x27;</span>,timeout=<span class="number">0.1</span>)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;可能会出现<code>urllib.error.URLError: &lt;urlopen error timed out&gt;</code>这种报错</p>
<p>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"><span class="keyword">try</span> :</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">&#x27;https://www.httpbin.org/get&#x27;</span>,timeout=<span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(e.reason,socket.timeout):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Time Out&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Time Out</span><br></pre></td></tr></table></figure>
<h3 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h3><p>&emsp;&emsp;<strong>context</strong>参数，该参数必须是ssl.SSLContext类型，用来指定SSL的设置。<br>&emsp;&emsp;<strong>cafile</strong>和<strong>capate</strong>这两个参数分别用来指定CA证书和其路径，在请求HTTPS连接时会用。  </p>
<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>&emsp;&emsp;利用urlopen发起的最基本的请求，那几个参数并不足以构建一个完整的请求。如果想往请求中加入Headers信息，就要利用更强大的Request类来构建请求了。  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">request = urllib.request.Request(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/3.png"><br>这里我们依然用urlopen发送请求，但是这次该方法的参数不是URL了，而是一个Request类型的对象。<br>构造Request类：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class urllib.request.Request(url,data=None,headers=&#123;&#125;,origin_req_host,unverifiable=False,method=None)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第一个参数url用于请求URL，是必传参数，其他都是可选参数。<br>&emsp;&emsp;第二个参数data如果要传数据，必须传bytes类型的。如果数据是字典，可以先用urllib.parse模块里的urlencode方法进行编码。<br>&emsp;&emsp;第三个参数headers是一个字典，就是请求头，在构造请求时，既可以通过headers参数直接构造此项，也可以通过调用请求实例的add_header方法添加。<br>&emsp;&emsp;添加请求头的常见方法是，通过修改User-Agent来伪装浏览器。默认的User-Agent是Python-urllib。<br>&emsp;&emsp;第四个参数origin_req_host指的是请求方的host名称或者IP地址。<br>&emsp;&emsp;第五个参数unverifiable表示请求方是否是无法验证的，默认取值是false，指用户没有足够的权限来接收这个请求的结果。<br>&emsp;&emsp;第六个参数是method是一个字符串，用来指示请求使用的方法。<br>&emsp;&emsp;传入多个参数构建Request类：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,parse</span><br><span class="line">url = <span class="string">&#x27;http://www.httpbin.org/post&#x27;</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 Edg/124.0.0.0&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;Host&#x27;</span>:<span class="string">&#x27;www.httpbin.org&#x27;</span>&#125;</span><br><span class="line"><span class="built_in">dict</span> = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;germy&#x27;</span>&#125;</span><br><span class="line">data = <span class="built_in">bytes</span>(parse.urlencode(<span class="built_in">dict</span>),encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">req = request.Request(url,data,headers,method=<span class="string">&#x27;POST&#x27;</span>)</span><br><span class="line">response = request.urlopen(req)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>传入4个参数构造了一个Request类，data用urlencode方法和bytes方法把字典数据转换成字节流格式。<br>运行结果  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;args&quot;: &#123;&#125;, </span><br><span class="line">  &quot;data&quot;: &quot;&quot;, </span><br><span class="line">  &quot;files&quot;: &#123;&#125;, </span><br><span class="line">  &quot;form&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;germy&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;headers&quot;: &#123;</span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;identity&quot;, </span><br><span class="line">    &quot;Content-Length&quot;: &quot;10&quot;, </span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, </span><br><span class="line">    &quot;Host&quot;: &quot;www.httpbin.org&quot;, </span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 Edg/124.0.0.0&quot;, </span><br><span class="line">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-662f5c7d-78dad94c612f72536858fcd6&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;json&quot;: null, </span><br><span class="line">  &quot;origin&quot;: &quot;219.156.133.195&quot;, </span><br><span class="line">  &quot;url&quot;: &quot;http://www.httpbin.org/post&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>成功设置了data,headers,method<br>通过add_header方法添加headers的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">req=request.Request(url=url,data=data,method=method)</span><br><span class="line">req.add_header(&#x27;User-Agent&#x27;,&#x27;xxxxx&#x27;)</span><br></pre></td></tr></table></figure>
<h3 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h3><p>&emsp;&emsp;学会构建请求之后，还有一些高级操作如Cookie处理、代理设置等，我们需要用Handler。Handler可以理解为各种处理器，有专门处理登录验证的、处理Cookie的、处理代理设置的。利用Handler,几乎可以实现HTTP请求中所有的功能。<br>&emsp;&emsp;urllib.request模块的BaseHandler类是其他所有Handler类的父类。提供了最基本的方法，例如default_open，protocol_request等。<br>有各种Handler子类继承BaseHandler类</p>
<ul>
<li>HTTPDefaultErrorHandler用于处理HTTP响应错误，所有错误都会抛出HTTPError类型的异常。</li>
<li>HTTPRedirectHandler用于处理重定向。</li>
<li>HTTPCookieProcessor用于处理Cookie。</li>
<li>ProxyHandler用于设置代理，代理默认为空。</li>
<li>HTTPPasswordMgr用于管理密码，它维护着用户名密码的对照表。</li>
<li>HTTPBasicAuthHandle用于管理认证，如果一个链接在打开时需要认证，那么可以用这个类来解决认证问题。<br>还有一个重要的类OpenerDirector，我们可以称之为Opener。之前用过的urlopen方法，就是urllib库为我们提供的一个Opener。为了实现更高级的功能，前面使用的Request类和urlopen类相当于类库已经封装好的极其常用的方法，利用这两个类可以完成基本的请求，但现在要实现更高级的功能，就要深入一层进行配置，使用更底层的实例来完成操作，所以要用Opener。<br>Opener类提供open方法，该方法返回的响应类型和urlopen方法如出一辙。使用Handler类来构建Opener类。</li>
</ul>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>&emsp;&emsp;在访问某些网站时，例如 <a target="_blank" rel="noopener" href="https://ssr3.scrape.center/">https://ssr3.scrape.center</a> ,可能会弹出认证窗口<br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/4.png"><br>&emsp;&emsp;这种情况是这个网站启用了基本身份认证，英文是HTTP Basic Access Authentication，一种登陆验证方式，允许网页浏览器或其他客户端程序在请求网站时提供用户名和口令形式的身份认证。<br>爬虫可以借助HTTPBasicAuthHandler模块完成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from urllib.request import HTTPBasicAuthHandler,HTTPPasswordMgrWithDefaultRealm,build_opener</span><br><span class="line">from urllib.error import  URLError</span><br><span class="line"></span><br><span class="line">username = &#x27;admin&#x27;</span><br><span class="line">password = &#x27;admin&#x27;</span><br><span class="line">url=&quot;https://ssr3.scrape.center/&quot;</span><br><span class="line"></span><br><span class="line">p=HTTPPasswordMgrWithDefaultRealm()</span><br><span class="line">p.add_password(None,url,username,password)</span><br><span class="line">auth_handler = HTTPBasicAuthHandler(p)</span><br><span class="line">opener = build_opener(auth_handler)</span><br><span class="line"></span><br><span class="line">try :</span><br><span class="line">    result = opener.open(url)</span><br><span class="line">    html = result.read().decode(&#x27;utf-8&#x27;)</span><br><span class="line">    print(html)</span><br><span class="line">except URLError as e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里首先实例化了一个HTTPBasicAuthHandler对象auth_handler，参数是HTTPPasswordMgrWithDefaultRealm对象，它利用add_passward方法添加用户名和密码，建立了一个用来处理验证的Handler类。<br>&emsp;&emsp;将对象auth_handler作为参数传递给build_opener方法，构建一个Opener，它在发送请求时就相当于验证成功了。<br>&emsp;&emsp;最后利用Opener类中的open方法打开连接，即可完成验证。这里获取的结果就是验证成功后的页面源码内容。  </p>
<h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><p>添加代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from urllib.error import URLError</span><br><span class="line">from urllib.request import ProxyHandler , build_opener</span><br><span class="line"></span><br><span class="line">proxy_handler = ProxyHandler(</span><br><span class="line">    &#123;&#x27;http&#x27; : &#x27;http://127.0.0.1:8080&#x27;,</span><br><span class="line">     &#x27;https&#x27; : &#x27;https://127.0.0.1:8080&#x27;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    response = opener.open(&#x27;https://www.baidu.com&#x27;)</span><br><span class="line">    print(response.read().decode(&#x27;utf-8&#x27;))</span><br><span class="line">except URLError as e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在本地搭建HTTP代理，让其运行在8080端口上。使用了ProxyHandler，其参数是一个字典，键名是协议类型，键值是代理链接，可以添加多个代理。利用这个Handler和build_opener方法构建了一个Opener，之后发送请求即可。  </p>
<h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>处理Cookie需要用到相关的Handler。<br>先用实例看看如何获取Cookie</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import http.cookiejar,urllib.request</span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.CookieJar()</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(&#x27;https://www.baidu.com&#x27;)</span><br><span class="line">for item in cookie:</span><br><span class="line">    print(item.name+&quot;=&quot;+item.value)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;先声明CookieJar对象。然后利用HTTPCookieProcessor构建一个Handler,再利用build_opener方法构建Opener，执行open函数即可。<br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/5.png"><br>&emsp;&emsp;分别输出了每个Cookie条目的名称和值。<br>&emsp;&emsp;输出文件格式的内容，Cookie实际上也是以文本形式保存的。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request,http.cookiejar</span><br><span class="line"></span><br><span class="line">filename = &#x27;cookies.txt&#x27;</span><br><span class="line">cookie = http.cookiejar.MozillaCookieJar(filename)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(&#x27;https://www.baidu.com&#x27;)</span><br><span class="line">cookie.save(ignore_discard=True,ignore_expires=True)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这时将CookieJar换成MozillaCookieJar，它会在生成文件时用到，是CookieJar的子类，用来处理跟Cookie和文件相关的事件，如读取和保存Cookie可以将Cookie保存成Mozilla型浏览器的Cookie格式。<br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/6.png"><br>&emsp;&emsp;LWPCookieJar同样可以读取和保存Cookie，只是Cookie文件的保存格式和MozillaCookieJar不一样，它会保存成LWP(libwww-perl)格式。<br>&emsp;&emsp;要保存LWP格式的Cookie文件，只需在声明时修改：<br><code>cookie = http.cookiejar.LWPCookieJar(filename)</code><br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/7.png"><br>不同格式的Cookie有一定的差异。<br>生成Cookie之后，对其进行读取和利用<br>以LWPCookieJar格式为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request,http.cookiejar</span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.LWPCookieJar()</span><br><span class="line">cookie.load(&#x27;cookies.txt&#x27;,ignore_discard=True,ignore_expires=True)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(&#x27;https://www.baidu.com&#x27;)</span><br><span class="line">print(response.read().decode(&#x27;utf-8&#x27;))</span><br></pre></td></tr></table></figure>
<p>这里调用load方法来读取本地的Cookie文件，获取Cookie的内容。这样做的前提是我们已经生成了LWPCookieJar格式的Cookie，并保存成了文件，读取了Cookie之后，用同样的方法构建Handler类和Opener类即可完成操作。  </p>
<h2 id="处理异常"><a href="#处理异常" class="headerlink" title="处理异常"></a>处理异常</h2><h3 id="URLError"><a href="#URLError" class="headerlink" title="URLError"></a>URLError</h3><p>&emsp;&emsp;URLError类来自urllib库的error模块，继承自OSError类，是error异常模块的基类，由request模块产生的异常可以通过捕获这个类来处理。<br>它的一个属性reaseon，返回错误的原因。<br>用一个实例来看看</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,error</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">&#x27;https://blttttt.com/404&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e.reason)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[Errno <span class="number">11001</span>] getaddrinfo failed</span><br></pre></td></tr></table></figure>
<p>我们访问了一个不存在的页面，是会报错的，但是通过捕获URLError这个异常，没有直接报错，而是输出了报错的原因，可以避免程序异常终止。  </p>
<h3 id="HTTPError"><a href="#HTTPError" class="headerlink" title="HTTPError"></a>HTTPError</h3><p>HTTPError是URLError的子类，专门用来处理HTTP请求的错误，例如认证请求失败。<br>有三个属性：</p>
<ul>
<li>code<br>返回HTTP状态码  </li>
<li>reason<br>同父类，返回错误原因</li>
<li>headers<br>返回请求头</li>
</ul>
<p>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,error</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">&#x27;https://cuiqingcai.com/404&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e.reason,e.code,e.headers,sep=<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>运行结果<br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/8.png"><br>URLError是HTTPError的父类，所以可以先选择捕获子类的错误，再捕获父类的错误，代码写法可以改为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,error</span><br><span class="line"><span class="keyword">try</span> :</span><br><span class="line">    response = request.urlopen(<span class="string">&#x27;https://cuiqingcai.com/404&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e.reason,e.code,e.headers,sep=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e.reason)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Request succeeded&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>这样可以先捕获HTTPError，捕获它的错误原因、状态码、请求头信息。如果不是HTTPError异常，就会捕获URLError异常，输出错误原因。最后用else语句来处理正常的逻辑。<br>有时reason属性返回的不一定是字符串，也可能是一个对象。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"><span class="keyword">try</span> :</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">&#x27;https://cuiqingcai.com/404&#x27;</span>,timeout=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(e.reason))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(e.reason,socket.timeout):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;TIME OUT&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;socket.timeout&#x27;</span>&gt;</span><br><span class="line">TIME OUT</span><br></pre></td></tr></table></figure>
<p>reason的类型是socket.timeout类，这里使用了isinstance方法来判断它的类型。  </p>
<h2 id="解析链接"><a href="#解析链接" class="headerlink" title="解析链接"></a>解析链接</h2><p>urllib库里还提供了parse模块，这个模块定义了处理URL的标准接口，如实现URL各部分的抽取、合并以及转换。它支持如下协议处理：file、ftp、gopher、hdl、http、https、imap、mailto、mms、news、nntp、prospero、rsync、rtsp、rtspu、sftp、sip、sips、snews、svn、svn+ssh、telnet和wais。  </p>
<h3 id="urlparse"><a href="#urlparse" class="headerlink" title="urlparse"></a>urlparse</h3><p>这个方法可以实现url的识别和分段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from urllib.parse import urlparse</span><br><span class="line"></span><br><span class="line">result = urlparse(&#x27;https://www.baidu.com/index.html;user?id=5#comment&#x27;)</span><br><span class="line">print(type(result))</span><br><span class="line">print(result)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;class &#x27;urllib.parse.ParseResult&#x27;&gt;</span><br><span class="line">ParseResult(scheme=&#x27;https&#x27;, netloc=&#x27;www.baidu.com&#x27;, path=&#x27;/index.html&#x27;, params=&#x27;user&#x27;, query=&#x27;id=5&#x27;, fragment=&#x27;comment&#x27;)</span><br></pre></td></tr></table></figure>
<p>解析的结果是ParseResult类型的对象，包含6部分，分别是scheme、netloc、path、params、query、fragment。<br>观察URL：<code>https://www.baidu.com/index.html;user?id=5#comment</code><br>urlparse方法在解析URL时有特定的分隔符。如<code>://</code>前面的内容就是scheme，代表协议。第一个<code>/</code>符号前面便是netloc，即域名；后面是path，访问路径。分号<code>;</code>后面是params，参数。问号<code>?</code>后面是查询条件query，一般用作GET类型的URL。井号<code>#</code>后面是锚点fragment，用于直接定位页面内部的下拉位置。<br>标准链接格式：<code>scheme://netloc/path;params?quert#fragment</code>，一个标准的URL都会符合这个规则，利用urlparse方法就可以将它拆分开来。<br>urlparse的API用法：<br><code>urllib.parse.urlparse(urlstring,scheme=&#39;&#39;,allow_fragment=True)</code></p>
<ul>
<li>urlstring:<br>这是必填项，即待解析的URL。</li>
<li>scheme:<br>这是默认的协议。如果待解析的URL没有带协议信息，就会将这个作为默认协议。</li>
<li>allow_fragment:<br>是否忽略fragment。如果此项被设置为False，那么fragment部分就会被忽略，它会被解析为path、params或者query的一部分，而fragment部分为空。</li>
</ul>
<h3 id="urlunparse"><a href="#urlunparse" class="headerlink" title="urlunparse"></a>urlunparse</h3><p>此方法用于构造URL。接收的参数是一个可迭代对象，其长度必须是6，否则会抛出参数数量不足或者过多的问题。<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlunparse</span><br><span class="line">data = [<span class="string">&#x27;https&#x27;</span>,<span class="string">&#x27;www.baidu.com&#x27;</span>,<span class="string">&#x27;index.html&#x27;</span>,<span class="string">&#x27;uesr&#x27;</span>,<span class="string">&#x27;a=6&#x27;</span>,<span class="string">&#x27;comment&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(urlunparse((data)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">https://www.baidu.com/index.html;uesr?a=<span class="number">6</span><span class="comment">#comment</span></span><br></pre></td></tr></table></figure>
<p>这里的参数使用的data列表类型。也可以使用其他类型，如元组或特定的数据结构。  </p>
<h3 id="urlsplit"><a href="#urlsplit" class="headerlink" title="urlsplit"></a>urlsplit</h3><p>此方法和urlparse类似，不过它不再单独解析params这部分（params会合并到path中），只返回5个结果。<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlsplit</span><br><span class="line">result = urlsplit(<span class="string">&#x27;https://www.baidu.com/index.html;user?id=5#comment&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(result))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">SplitResult(scheme=<span class="string">&#x27;https&#x27;</span>, netloc=<span class="string">&#x27;www.baidu.com&#x27;</span>, path=<span class="string">&#x27;/index.html;user&#x27;</span>, query=<span class="string">&#x27;id=5&#x27;</span>, fragment=<span class="string">&#x27;comment&#x27;</span>)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;urllib.parse.SplitResult&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>
<p>返回的结果是SplitResult，其实也是元组，可以通过属性取其值，也可以通过索引取值。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlsplit</span><br><span class="line">result = urlsplit(<span class="string">&#x27;https://www.baidu.com/index.html;user?id=5#comment&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result.scheme,result[<span class="number">0</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">https https</span><br></pre></td></tr></table></figure>
<h3 id="urlunsplit"><a href="#urlunsplit" class="headerlink" title="urlunsplit"></a>urlunsplit</h3><p>与urlunparse类似，也是将链接各部分组合成完整链接的方法，传入的参数是可迭代对象，如列表，元组，参数长度必须是5。<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlunsplit</span><br><span class="line">data=[<span class="string">&#x27;https&#x27;</span>,<span class="string">&#x27;www.baidu.com&#x27;</span>,<span class="string">&#x27;index.html&#x27;</span>,<span class="string">&#x27;a=6&#x27;</span>,<span class="string">&#x27;comment&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(urlunsplit(data))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">https://www.baidu.com/index.html?a=<span class="number">6</span><span class="comment">#comment</span></span><br></pre></td></tr></table></figure>
<h3 id="urljoin"><a href="#urljoin" class="headerlink" title="urljoin"></a>urljoin</h3><p>&emsp;&emsp;urlunparse和urlunsplit方法都可以完成链接的合并，但前提是有特定的对象，链接的每一部分要清晰分开。<br>&emsp;&emsp;urljoin也可以生成链接。要提供base_url(基础链接)作为该方法的第一个参数，将新链接作为第二个参数。urljoin方法会分析base_url的scheme、netloc和path三个内容，并对新链接缺失的部分进行补充，最后返回结果。<br>实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from urllib.parse import urljoin</span><br><span class="line"></span><br><span class="line">print(urljoin(&#x27;https://www.baidu.com&#x27;, &#x27;FAQ.html&#x27;))</span><br><span class="line">print(urljoin(&#x27;https://www.baidu.com&#x27;, &#x27;https://cuiqingcai.com/FAQ.html&#x27;))</span><br><span class="line">print(urljoin(&#x27;https://www.baidu.com/about.html&#x27;, &#x27;https://cuiqingcai.com/FAQ.html&#x27;))</span><br><span class="line">print(urljoin(&#x27;https://www.baidu.com/about.html&#x27;, &#x27;https://cuiqingcai.com/FAQ.html?question=2&#x27;))</span><br><span class="line">print(urljoin(&#x27;https://www.baidu.com?wd=abc&#x27;, &#x27;https://cuiqingcai.com/index,php&#x27;))</span><br><span class="line">print(urljoin(&#x27;https://www.baidu.com&#x27;, &#x27;?category=2#comment&#x27;))</span><br><span class="line">print(urljoin(&#x27;www.baidu.com&#x27;, &#x27;?category=2#comment&#x27;))</span><br><span class="line">print(urljoin(&#x27;www.baidu.com#comment&#x27;, &#x27;?caetgory=2&#x27;))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">https://www.baidu.com/FAQ.html</span><br><span class="line">https://cuiqingcai.com/FAQ.html</span><br><span class="line">https://cuiqingcai.com/FAQ.html</span><br><span class="line">https://cuiqingcai.com/FAQ.html?question=2</span><br><span class="line">https://cuiqingcai.com/index,php</span><br><span class="line">https://www.baidu.com?category=2#comment</span><br><span class="line">www.baidu.com?category=2#comment</span><br><span class="line">www.baidu.com?caetgory=2</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;可以发现，base_url提供了scheme、netloc和path。如果新链接不存在这三项，就进行补充，如果存在，base_url是不起作用的。<br>&emsp;&emsp;通过urljoin方法，实现链接的解析、拼合与生成。  </p>
<h3 id="urlencode"><a href="#urlencode" class="headerlink" title="urlencode"></a>urlencode</h3><p>&emsp;&emsp;它在构造GET请求参数的时候非常有用。<br>实例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlencode</span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;germy&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>:<span class="number">25</span></span><br><span class="line">&#125;</span><br><span class="line">base_url = <span class="string">&#x27;http://www.baidu.com?&#x27;</span></span><br><span class="line">url=base_url+urlencode(params)</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">http://www.baidu.com?name=germy&amp;age=<span class="number">25</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;先声明了一个字典params，用于将参数显示出来，然后调用urlencode方法将params序列化为GET请求的参数。<br>&emsp;&emsp;urlencode方法很常用，有时为了更方便地构造参数。我们会先用字典将参数表示出来，然后将字典转化为URL的参数时，调用该方法即可。  </p>
<h3 id="parse-qs"><a href="#parse-qs" class="headerlink" title="parse_qs"></a>parse_qs</h3><p>&emsp;&emsp;有了序列化就会有反序列化。利用parse_qs方法，可以将一串GET请求参数转回字典。<br>实例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> parse_qs</span><br><span class="line">query = <span class="string">&#x27;name=germy&amp;age=25&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(parse_qs(query))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;germy&#x27;</span>], <span class="string">&#x27;age&#x27;</span>: [<span class="string">&#x27;25&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到URL的参数车公共转换为了字典类型。</p>
<blockquote>
<p>查询字符串是 URL 中 ? 符号后的部分，通常用于在 HTTP 请求中传递参数。<br>输出结果会是一个字典，其中每个键对应一个参数名，每个值是一个列表，包含该参数名对应的所有值。  </p>
</blockquote>
<h3 id="parse-qsl"><a href="#parse-qsl" class="headerlink" title="parse_qsl"></a>parse_qsl</h3><p>&emsp;&emsp;此方法用于将参数转化为由元组组成的列表：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> parse_qsl</span><br><span class="line">query = <span class="string">&#x27;name=germy&amp;age=25&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(parse_qsl(query))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;germy&#x27;</span>), (<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;25&#x27;</span>)]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;运行结果是一个列表，该列表中的每一个元素是一个元组，元组第一个内容是参数名，第二个内容是参数值。  </p>
<h3 id="quote"><a href="#quote" class="headerlink" title="quote"></a>quote</h3><p>&emsp;&emsp;此方法可以将内容转化为URL编码的格式。当URL中带有中文参数的时候，有可能导致乱码，使用quote可以将中文字符转化为URL编码。  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line">keyword = <span class="string">&#x27;壁纸&#x27;</span></span><br><span class="line">url=<span class="string">&#x27;http://www.baidu.com/s?wd=&#x27;</span>+quote(keyword)</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">http://www.baidu.com/s?wd=%E5%A3%<span class="number">81</span>%E7%BA%B8</span><br></pre></td></tr></table></figure>
<h3 id="unquote"><a href="#unquote" class="headerlink" title="unquote"></a>unquote</h3><p>它可以进行URL解码。<br>实例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line">url = <span class="string">&#x27;http://www.baidu.com/s?wd=%E5%A3%81%E7%BA%B8&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(unquote(url))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">http://www.baidu.com/s?wd=壁纸</span><br></pre></td></tr></table></figure>
<h2 id="分析Robots协议"><a href="#分析Robots协议" class="headerlink" title="分析Robots协议"></a>分析Robots协议</h2><p>利用urllib库的robotparser模块，可以分析网站的Robots协议。</p>
<h3 id="Robots协议"><a href="#Robots协议" class="headerlink" title="Robots协议"></a>Robots协议</h3><p>&emsp;&emsp;该协议也称爬虫协议或机器人协议，全名是网络爬虫排除标准。来告诉爬虫和搜索引擎哪些页面可以抓取，哪些不可以。通常有一个叫robots.txt的文本文件，一般在网站的根目录下。<br>&emsp;&emsp;爬虫在访问一个站点时，首先检查这个站点的根目录下是否存在robots.txt文件，如果存在，会根据其中定义的爬取范围来爬取。若没有这个文件，搜索爬虫会访问所有可直接访问的页面。  </p>
<h3 id="robotparser"><a href="#robotparser" class="headerlink" title="robotparser"></a>robotparser</h3><p>&emsp;&emsp;使用robotparser模块来解析robots.txt文件。该模块提供了一个RobotFileParser，它可以根据某网站的robots.txt文件判断一个爬取爬虫是否有权限爬取这个网页。<br>&emsp;&emsp;这个类的使用只需在构造方法里传入robots.txt文件的链接即可。<br>&emsp;&emsp;看它的声明<code>urllib.robotparser.RobotFileParser(url=&#39;&#39;)</code><br>&emsp;&emsp;也可以不在声明时传入robots.txt文件的链接，让其默认为空，最后使用set_url()方法去设置也可以。</p>
<ul>
<li>set_url:<br>用来设置robots.txt文件的链接。如果在创建RobotFileParser对象时传入了链接，就不需要使用这个方法设置了。</li>
<li>read:<br>读取robots.txt文件并进行分析。这个方法执行读取和分析操作，如果不调用这个方法，接下来接下来的判断都会为False，所以一定要调用这个方法。这个方法虽然不返回内容，但是执行了读取操作。</li>
<li>parse:<br>用来解析robots.txt文件，传入其中的参数是robots.txt文件中某些行的内容，会按照robots.txt的语法规则来分析这些内容。  </li>
<li>can_fetch:<br>该方法有两个参数，第一个是User-Agent，第二个是要抓取的URL。返回结果是True或False，表示搜索引擎是否可以抓取这个URL。</li>
<li>mtime:<br>返回上次抓取和分析robots.txt文件的时间，这对于长时间分析和抓取robots.txt文件的搜索爬虫很有必要，可能需要定期检查以抓取最新的robots.txt文件。</li>
<li>modified:<br>同样对长时间分析和抓取的搜索爬虫很有帮助，可以将时间设置为上次抓取和分析robots.txt文件的时间。<br>实例  <blockquote>
<p>首先创建一个RobotFileParser对象rp，然后通过set_url方法设置robots.txt文件的链接。利用can_fetch方法判断网页是否可以被抓取。  </p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.robotparser <span class="keyword">import</span> RobotFileParser</span><br><span class="line">rp = RobotFileParser()</span><br><span class="line">rp.set_url(<span class="string">&quot;https://www.baidu.com/robots.txt&quot;</span>)</span><br><span class="line">rp.read()</span><br><span class="line"><span class="built_in">print</span>(rp.can_fetch(<span class="string">&#x27;Baiduspider&#x27;</span>,<span class="string">&#x27;https://www.baidu.com&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(rp.can_fetch(<span class="string">&#x27;Baiduspider&#x27;</span>,<span class="string">&#x27;https://www.baidu.com/homepage/&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(rp.can_fetch(<span class="string">&#x27;Googlebot&#x27;</span>,<span class="string">&#x27;https://www.baidu.com/homepage/&#x27;</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
&emsp;&emsp;利用Baiduspider就可以抓取百度的首页以及homepage页面，但是Googlebot就不能抓取homepage页面。<br>&emsp;&emsp;还可以用parse方法执行对robots.txt文件的读取和分析。<br>实例<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">from</span> urllib.robotparser <span class="keyword">import</span> RobotFileParser</span><br><span class="line"></span><br><span class="line">rp = RobotFileParser()</span><br><span class="line">rp.parse(urlopen(<span class="string">&#x27;https://www.baidu.com/robots.txt&#x27;</span>).read().decode(<span class="string">&#x27;utf-8&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(rp.can_fetch(<span class="string">&#x27;Baiduspider&#x27;</span>,<span class="string">&#x27;https://www.baidu.com&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(rp.can_fetch(<span class="string">&#x27;Baiduspider&#x27;</span>,<span class="string">&#x27;https://www.baidu.com/homepage/&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(rp.can_fetch(<span class="string">&#x27;Googlebot&#x27;</span>,<span class="string">&#x27;https://www.baidu.com/homepage/&#x27;</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
运行结果一样</li>
</ul>
<h1 id="requests的使用"><a href="#requests的使用" class="headerlink" title="requests的使用"></a>requests的使用</h1><p>requests相比于urllib更加方便。  </p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>首先确保安装了requests库，若未安装，使用pip3安装：<br><code>pip3 install requests</code></p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>&emsp;&emsp;在urllib库中的urlopen方法实际上是以GET请求方式请求网页的，requests库中相应的方法就是get方法</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response))</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response.text))</span><br><span class="line"><span class="built_in">print</span>(response.text[:<span class="number">100</span>])</span><br><span class="line"><span class="built_in">print</span>(response.cookies)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;requests.models.Response&#x27;</span>&gt;</span><br><span class="line"><span class="number">200</span></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;str&#x27;</span>&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charse</span></span><br><span class="line"><span class="string">&lt;RequestsCookieJar[&lt;Cookie BAIDUID=1C74878EE150BFF62131B72042A1460F:FG=1 for .baidu.com/&gt;, &lt;Cookie BAIDUID_BFESS=1C74878EE150BFF62131B72042A1460F:FG=1 for .baidu.com/&gt;, &lt;Cookie BIDUPSID=1C74878EE150BFF62131B72042A1460F for .baidu.com/&gt;, &lt;Cookie H_PS_PSSID=40304_40499_40446_40080 for .baidu.com/&gt;, &lt;Cookie PSTM=1714996509 for .baidu.com/&gt;]&gt;  </span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里调用get方法实现了与urlopen方法相同的操作，返回一个Response对象，将其存放在变量response中，然后输出响应的类型，状态码，响应体的类型，内容，以及Cookie。  </p>
<h2 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a>GET请求</h2><p>利用requests库构建GET请求的方法。  </p>
<h3 id="基本实例"><a href="#基本实例" class="headerlink" title="基本实例"></a>基本实例</h3><p>&emsp;&emsp;构建简单GET请求，请求链接为<code>https://www.httpbin.org/get</code>，该网站会判断客户端发起的请求是否为get请求，如果是，那么它将返回相应的请求信息：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://www.httpbin.org/get&#x27;</span></span><br><span class="line">r=requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;www.httpbin.org&quot;</span>, </span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;python-requests/2.31.0&quot;</span>, </span><br><span class="line">    <span class="string">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="string">&quot;Root=1-6638c88c-656171973be54b8465b565d1&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;219.156.133.195&quot;</span>, </span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://www.httpbin.org/get&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;成功发起了GET请求，返回结果中包含请求头、URL、IP等信息。<br>&emsp;&emsp;对于GET请求，可以添加附加信息，如加两个参数name和age，其中name是germy、age是25，那么URL就可以写为<code>https://www.httpbin.org/get?name=germy&amp;age=25</code>，但是这样写稍有麻烦，其实可以利用params参数直接传递这种信息：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;germy&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>:<span class="number">25</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&#x27;https://www.httpbin.org/get&#x27;</span></span><br><span class="line">response = requests.get(url, params=data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="string">&quot;25&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;germy&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;www.httpbin.org&quot;</span>, </span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;python-requests/2.31.0&quot;</span>, </span><br><span class="line">    <span class="string">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="string">&quot;Root=1-6638ca91-53eeec34391520830e2e1c8a&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;219.156.133.195&quot;</span>, </span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://www.httpbin.org/get?name=germy&amp;age=25&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这样就把URL参数以字典的形式传给get方法的params参数，通过返回信息可以判断，请求链接自动被构造成了<code>https://www.httpbin.org/get?name=germy&amp;age=25</code>,就不用自己构造URL了。<br>&emsp;&emsp;网页返回的类型虽然是str类型，但是它很特殊，是JSON格式的。如果想直接解析返回结果，得到一个JSON格式的数据，可以直接调用json方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;germy&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>:<span class="number">25</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&#x27;https://www.httpbin.org/get&#x27;</span></span><br><span class="line">response = requests.get(url, params=data)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response.json()))</span><br><span class="line"><span class="built_in">print</span>(response.json())</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;dict&#x27;</span>&gt;</span><br><span class="line">&#123;<span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;25&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;germy&#x27;</span>&#125;, <span class="string">&#x27;headers&#x27;</span>: &#123;<span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>, <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>, <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;www.httpbin.org&#x27;</span>, <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;python-requests/2.31.0&#x27;</span>, <span class="string">&#x27;X-Amzn-Trace-Id&#x27;</span>: <span class="string">&#x27;Root=1-6638cd0c-14525f1e05304540064c24db&#x27;</span>&#125;, <span class="string">&#x27;origin&#x27;</span>: <span class="string">&#x27;219.156.133.195&#x27;</span>, <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://www.httpbin.org/get?name=germy&amp;age=25&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;调用json方法可以将结果（JSON格式字符串）转化为字典。<br>&emsp;&emsp;但是如果返回结果不是JSON格式，就会出现解析错误，出现异常。</p>
<blockquote>
<p>对于上面的请求得到的响应，如果直接用print将响应的对象打印输出，得到的会是什么，我试了下，请求成功<code>&lt;Response [200]&gt;</code>，请求失败<code>&lt;Response [404]&gt;</code></p>
</blockquote>
<h3 id="抓取网页"><a href="#抓取网页" class="headerlink" title="抓取网页"></a>抓取网页</h3><p>以<code>https://ssr1.scrape.center</code>为例，往代码里加一点提取信息的逻辑：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://ssr1.scrape.center&#x27;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url)</span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">&#x27;&lt;h2.*?&gt;(.*?)&lt;/h2&gt;&#x27;</span>,re.S)</span><br><span class="line">titles = re.findall(pattern,response.text)</span><br><span class="line"><span class="built_in">print</span>(titles)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[<span class="string">&#x27;霸王别姬 - Farewell My Concubine&#x27;</span>, <span class="string">&#x27;这个杀手不太冷 - Léon&#x27;</span>, <span class="string">&#x27;肖申克的救赎 - The Shawshank Redemption&#x27;</span>, <span class="string">&#x27;泰坦尼克号 - Titanic&#x27;</span>, <span class="string">&#x27;罗马假日 - Roman Holiday&#x27;</span>, <span class="string">&#x27;唐伯虎点秋香 - Flirting Scholar&#x27;</span>, <span class="string">&#x27;乱世佳人 - Gone with the Wind&#x27;</span>, <span class="string">&#x27;喜剧之王 - The King of Comedy&#x27;</span>, <span class="string">&#x27;楚门的世界 - The Truman Show&#x27;</span>, <span class="string">&#x27;狮子王 - The Lion King&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里提取出了所有的电影标题，只需一个最基本的抓取和提取流程即可完成。  </p>
<h3 id="抓取二进制数据"><a href="#抓取二进制数据" class="headerlink" title="抓取二进制数据"></a>抓取二进制数据</h3><p>&emsp;&emsp;上面例子抓取的是网站页面，返回的是HTML文档。<br>而图片、音频、视频这些文件本质上都是由二进制编码组成的，有特定的保存格式和对应的解析方式，我们能看到各种形色的多媒体，抓取他们要拿到他们的二进制数。  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://scrape.center/favicon.ico&#x27;</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里<code>response.text</code>的运行结果是一串乱码，而<code>response.content</code>的运行结果是bytes类型的数据。<br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/9.png">    </p>
<blockquote>
<p>bytes类型的数据前面会带有一个b，也称为“字节串”的格式，字节串是由一系列字节组成的，每个字节可以表示一个字符或者数据的一部分。在Python中，字节串通常用单引号或双引号括起来，并且字节串中的每个字节用两个十六进制数表示。  </p>
</blockquote>
<p>&emsp;&emsp;可以将图片的二进制数据保存下来。  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://scrape.center/favicon.ico&#x27;</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;favicon.ico&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;使用open方法，以二进制写的形式打开文件，向文件里写入二进制数据。</p>
<h3 id="添加请求头"><a href="#添加请求头" class="headerlink" title="添加请求头"></a>添加请求头</h3><p>&emsp;&emsp;在发起HTTP请求的时候，会有一个请求头Request Headers，我们可以通过设置headers参数完成。<br>&emsp;&emsp;上面的实例中，是没有设置请求头信息的，某些网站会发现这不是一个正常浏览器发起的请求，可能返回异常结果，导致网页抓取失败。<br>&emsp;&emsp;添加请求信息，如添加一个User-Agent字段：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&#x27;https://ssr1.scrape.center/&#x27;</span></span><br><span class="line">response = requests.get(url, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;也可以在headers参数中添加其他字段信息。  </p>
<h2 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h2><p>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>:<span class="number">25</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&#x27;https://httpbin.org/post&#x27;</span></span><br><span class="line">response = requests.post(url,data=data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">  <span class="string">&quot;files&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;form&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="string">&quot;25&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;admin&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Length&quot;</span>: <span class="string">&quot;17&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;httpbin.org&quot;</span>, </span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;python-requests/2.31.0&quot;</span>, </span><br><span class="line">    <span class="string">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="string">&quot;Root=1-6639927b-00d275d24c6775e71e150ebb&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;json&quot;</span>: null, </span><br><span class="line">  <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;219.156.133.195&quot;</span>, </span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://httpbin.org/post&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>form部分就是提交的数据，证明POST请求成功发送。  </p>
<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>&emsp;&emsp;请求发送后会得到响应。上面实例中，用的是text和content获取了响应的内容，还有很多属性<br>和方法用来获取其他信息，如状态码、响应头、Cookie等。<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = (<span class="string">&#x27;http://ssr1.scrape.center/&#x27;</span>)</span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response.status_code),response.status_code)  //状态码</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response.headers),response.headers)  //响应头</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response.cookies),response.cookies)  //cookies</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response.url),response.url)  //URL</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response.history),response.history)  //请求历史</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;int&#x27;</span>&gt; <span class="number">200</span></span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;requests.structures.CaseInsensitiveDict&#x27;</span>&gt; &#123;<span class="string">&#x27;Date&#x27;</span>: <span class="string">&#x27;Tue, 07 May 2024 02:40:47 GMT&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>, <span class="string">&#x27;X-Frame-Options&#x27;</span>: <span class="string">&#x27;DENY&#x27;</span>, <span class="string">&#x27;X-Content-Type-Options&#x27;</span>: <span class="string">&#x27;nosniff&#x27;</span>, <span class="string">&#x27;Expires&#x27;</span>: <span class="string">&#x27;Tue, 07 May 2024 02:45:59 GMT&#x27;</span>, <span class="string">&#x27;Strict-Transport-Security&#x27;</span>: <span class="string">&#x27;max-age=15724800; includeSubDomains&#x27;</span>, <span class="string">&#x27;Server&#x27;</span>: <span class="string">&#x27;Lego Server&#x27;</span>, <span class="string">&#x27;X-Cache-Lookup&#x27;</span>: <span class="string">&#x27;Cache Miss, Cache Miss&#x27;</span>, <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;max-age=600&#x27;</span>, <span class="string">&#x27;Age&#x27;</span>: <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;Content-Length&#x27;</span>: <span class="string">&#x27;41667&#x27;</span>, <span class="string">&#x27;X-NWS-LOG-UUID&#x27;</span>: <span class="string">&#x27;10330054940065279203&#x27;</span>, <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>&#125;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;requests.cookies.RequestsCookieJar&#x27;</span>&gt; &lt;RequestsCookieJar[]&gt;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;str&#x27;</span>&gt; https://ssr1.scrape.center/</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;list&#x27;</span>&gt; [&lt;Response [<span class="number">302</span>]&gt;]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里面headers和cookies这两个属性的结果分别是<code>CaseInsensitiveDict</code>和<code>RequestsCookieJar</code>类型的对象。<br>&emsp;&emsp;状态码<code>200</code>表示响应没有问题，而我们可以通过判断这个数字来确认爬虫是否爬取成功。<br>&emsp;&emsp;requests库还提供了一个内置的状态码查询对象requests.codes<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://ssr1.scrape.center/&#x27;</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line">exit() <span class="keyword">if</span> <span class="keyword">not</span> response.status_code == requests.codes.ok <span class="keyword">else</span> <span class="built_in">print</span>(<span class="string">&#x27;Request Successfully&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Request Successfully</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;通过比较返回码和内置的表示成功的状态码，保证得到了正常响应，如果是就输出请求成功的消息，否则程序终止运行，用requests.codes.ok得到的成功状态码是200。  </p>
<h2 id="高级用法-1"><a href="#高级用法-1" class="headerlink" title="高级用法"></a>高级用法</h2><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>&emsp;&emsp;requests库可以模拟提交一些数据。也可以上传文件。<br>实例  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://httpbin.org/post&#x27;</span></span><br><span class="line">file = &#123;<span class="string">&#x27;favicon.ico&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;favicon.ico&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">reponse = requests.post(url, files=file)</span><br><span class="line"><span class="built_in">print</span>(reponse.text)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">  <span class="string">&quot;files&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;favicon.ico&quot;</span>: <span class="string">&quot;data:application/octet-stream;base64,AAAB...&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;form&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Length&quot;</span>: <span class="string">&quot;4440&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;multipart/form-data; boundary=5dc8b6473c0c05dc184c55876cebce25&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;httpbin.org&quot;</span>, </span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;python-requests/2.31.0&quot;</span>, </span><br><span class="line">    <span class="string">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="string">&quot;Root=1-66399eb4-6599df655be9cf0a6a9ac001&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;json&quot;</span>: null, </span><br><span class="line">  <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;219.156.133.195&quot;</span>, </span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://httpbin.org/post&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上传文件后，网站返回响应，响应中包含files字段和form字段，而form字段是空的，说明文件上传部分会单独用一个files字段来标识。  </p>
<h3 id="Cookie设置"><a href="#Cookie设置" class="headerlink" title="Cookie设置"></a>Cookie设置</h3><p>&emsp;&emsp;前面使用过urllib库处理Cookie，写法较为复杂，而用requests库，获取和设置Cookie只需一部即可完成。<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com/&#x27;</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(response.cookies)</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> response.cookies.items():</span><br><span class="line">    <span class="built_in">print</span>(key+<span class="string">&#x27;=&#x27;</span>+value)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;RequestsCookieJar[&lt;Cookie BAIDUID=0F50E1FD0E238874BD72A86D327F65CF:FG=<span class="number">1</span> <span class="keyword">for</span> .baidu.com/&gt;, &lt;Cookie BAIDUID_BFESS=0F50E1FD0E238874BD72A86D327F65CF:FG=<span class="number">1</span> <span class="keyword">for</span> .baidu.com/&gt;, &lt;Cookie H_PS_PSSID=<span class="number">40300_40079_40463_60174</span> <span class="keyword">for</span> .baidu.com/&gt;, &lt;Cookie PSTM=<span class="number">1715055521</span> <span class="keyword">for</span> .baidu.com/&gt;, &lt;Cookie BD_NOT_HTTPS=<span class="number">1</span> <span class="keyword">for</span> www.baidu.com/&gt;]&gt;</span><br><span class="line">BAIDUID=070B4458EAF888B767A06FC7F52B6DE1:FG=<span class="number">1</span></span><br><span class="line">BAIDUID_BFESS=070B4458EAF888B767A06FC7F52B6DE1:FG=<span class="number">1</span></span><br><span class="line">H_PS_PSSID=<span class="number">40303_40080_60174</span></span><br><span class="line">PSTM=<span class="number">1715054787</span></span><br><span class="line">BD_NOT_HTTPS=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里先调用cookies属性，成功得到Cookie，发现它属于RequestsCookieJar类型。然后调用items方法将Cookie转化为由元组组成的列表，遍历输出每一个Cookie条目的名称和值，实现对Cookie的遍历和解析。<br>&emsp;&emsp;我们也可以直接用Cookie来维持登录状态。以Github为例，我们先登录Github,然后将请求头中的Cookie内容复制下来<br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/10.png"><br>&emsp;&emsp;将Cookie添加到请求头里，然后发送请求。<br>实例  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;_octo=GH1.1.1020779121.1709874774; _device_id=e5c616e3c9807057e79266383da8cd61; saved_user_sessions=155144413%3AetQxEGfBoTvbxcQPOuPZ0WyHSskj5GsMfXA2k8JqGVOz4pv0; user_session=etQxEGfBoTvbxcQPOuPZ0WyHSskj5GsMfXA2k8JqGVOz4pv0; __Host-user_session_same_site=etQxEGfBoTvbxcQPOuPZ0WyHSskj5GsMfXA2k8JqGVOz4pv0; logged_in=yes; dotcom_user=blttttt; has_recent_activity=1; color_mode=%7B%22color_mode%22%3A%22auto%22%2C%22light_theme%22%3A%7B%22name%22%3A%22light%22%2C%22color_mode%22%3A%22light%22%7D%2C%22dark_theme%22%3A%7B%22name%22%3A%22dark%22%2C%22color_mode%22%3A%22dark%22%7D%7D; preferred_color_mode=light; tz=Asia%2FShanghai; _gh_sess=cscvLFSGJcf6AUPq6fzQjoyyl0O89JlmxwVkS1%2BaEXzwsS5bDp%2FKxbAGbdkfKGN2PeDMiLcD2%2BnXCaJiYkjRjAncjALoQ0yR0XMFkNlI08mU2uBAY%2BO0eHJ78vnRiiRutYVCkBPJAQF0oKQ8P46vwW1esYkG3X7Hfs2scPXyDm5sUkW0AC%2B%2B4Xg4yyjQ2VMD96gSpB0SUk8CMugT4GaYSQ4jWzSys%2BffoehUzl0fC76EAhvzT7X7fw5Oa4c7NKoGSz4xn6DXMl8ZaoK%2F7a32i%2FPwYplpfpcd8k%2By36Q%2F533m23P8dVyB3SMO2UZRdIFTUbTi7wFomjcSvbIFJ8lW%2BNMtuYrrz9TZ8X90K1gdDzi4KcmCSXzXcbY25E%2BDMlco%2BmfPtPPax1%2BIaoGu5HYTpM2IAkRDheNvdzHE4pbBPQbdJlx4p6V1R9MWYVm3iKM1Jx6gkPfm92%2BcbznQ4AItn4%2BV40z7Aj4QnV7gG6c8lkyeOhRjVls9s%2F%2BrhDwkHMPjxDpRzruGN6YEPo%2F7X8gt4uIspHA0d4z%2BnNbR1mloiPXw%2B1EJ6gqCog%3D%3D--8YfmSu%2BHtVUuakSu--kppLpsZaDcPEkIPLocCpMA%3D%3D&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = (<span class="string">&#x27;https://github.com/&#x27;</span>)</span><br><span class="line">response = requests.get(url,headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;结果中包含了登录才能有的信息，其中包含用户名信息。<br>&emsp;&emsp;得到此结果说明Cookie成功模拟了登录状态，这样就能爬取登录之后才能看到的页面了。<br>&emsp;&emsp;也可以通过cookies参数来设置Cookie的信息，这里构造一个RequestsCookieJar对象，然后对刚才复制的Cookie进行处理以及赋值。<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">cookies = <span class="string">&#x27;_octo=GH1.1.1020779121.1709874774; _device_id=e5c616e3c9807057e79266383da8cd61; saved_user_sessions=155144413%3AetQxEGfBoTvbxcQPOuPZ0WyHSskj5GsMfXA2k8JqGVOz4pv0; user_session=etQxEGfBoTvbxcQPOuPZ0WyHSskj5GsMfXA2k8JqGVOz4pv0; __Host-user_session_same_site=etQxEGfBoTvbxcQPOuPZ0WyHSskj5GsMfXA2k8JqGVOz4pv0; logged_in=yes; dotcom_user=blttttt; has_recent_activity=1; color_mode=%7B%22color_mode%22%3A%22auto%22%2C%22light_theme%22%3A%7B%22name%22%3A%22light%22%2C%22color_mode%22%3A%22light%22%7D%2C%22dark_theme%22%3A%7B%22name%22%3A%22dark%22%2C%22color_mode%22%3A%22dark%22%7D%7D; preferred_color_mode=light; tz=Asia%2FShanghai; _gh_sess=blrf5T4EJEg6JJ50EPrvPOFUhj0hBcd1MbdCCIQc8MS8Fe03V4WSkKIGvUY08G9m%2B4kh1Ir1%2F5fjayGfZFgwiz34xSZrtbWxNO6%2BVWD8yVdBxZYwmE%2ByX1ckwBVTlhVzWjuIg4cRuFc7Cf2a%2BEjNyWZ1SGWiEFqkBI4%2BNBFFWjySrCv8%2Bprb%2FGE6PYp5yMj5ErqhtrIprbxYYLeZujlF2xZKEtO5HEE%2FML%2BkhPd3zelGQ1xfsQCDZCtGMKzBl096OovkfZGd2neqwvadIN5BFbtXr%2F0Qrg0l5%2FgKZivdxH0FcFWjbbh6vBYC1Wdq6ddLAmtoK5tkzf65szPCym4wJWK8BHH5ui1g6gR2jCrKggtk7XDYJ%2FgfRdRFFhOFodqyUTAwliztTaEUqsZx10xvLGSzOa76fWfqN5DOktKMUqEVPi6RwRejzb2hf6CxNQ4fr1kR348GyuyNrQGpAi0%2BFod2%2B7r4VtIRXPmLX%2FhMLZqC4%2BMRiM1S9i3IeQdhj%2BF%2Bu1VBLuvVlg0hKX3xxm449GFW0tBXk345dTu89MLffCFI29X%2BUXV8jA%3D%3D--L4G%2B56Y9nCQAoeYL--nvFWkVjJSzdHJtWrW%2FW%2F4Q%3D%3D&#x27;</span></span><br><span class="line">jar = requests.cookies.RequestsCookieJar()</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = (<span class="string">&#x27;https://github.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> cookie <span class="keyword">in</span> cookies.split(<span class="string">&#x27;;&#x27;</span>):</span><br><span class="line">    key, value = cookie.split(<span class="string">&#x27;=&#x27;</span>,<span class="number">1</span>)   //这里 split 方法的第二个参数 <span class="number">1</span> 表示最多分割一次，确保即使 value 中包含等号 = 也不会继续分割。</span><br><span class="line">    jar.<span class="built_in">set</span>(key, value)</span><br><span class="line">response = requests.get(url,cookies=jar,headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里首先创建了一个RequestCookieJar对象，然后利用split方法对复制下来的Cookie内容做分割，接着利用set方法设置好每个Cookie条目的键名和键值，最后把RequestCookieJar对象通过cookies参数传递，调用requests库的get方法，即可获取登录后的页面。<br>&emsp;&emsp;也可以正常登录。  </p>
<h3 id="Session维持"><a href="#Session维持" class="headerlink" title="Session维持"></a>Session维持</h3><p>&emsp;&emsp;直接利用request库中的get或post方法的确可以做到模拟网页的请求，但这两种方法实际上相当于不同的Session，或者说是两个浏览器打开了不同的页面。<br>&emsp;&emsp;有一个场景，第一个请求利用requests库的post方法登录了某个网站，第二次想获取成功登录后的自己的个人信息，于是又用了一次requests库的get方法去请求个人信息页面。实际上这相当于打开了两个浏览器，是两个完全独立的操作，对应两个完全不相关Session，并不能获取个人信息。<br>&emsp;&emsp;如果在两次请求时设置一样的Cookie，这样做可以，但是过于繁琐。<br>&emsp;&emsp;解决这个问题的方法是维持同一个Session,也就是第二次请求时打开一个新的浏览器选项卡而不是打开一个新的浏览器。利用Session对象，可以方便地维护一个Session，而且不用担心Cookie的问题，它会自动帮我们处理好。<br>实例：沿用之前写法</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">requests.get(<span class="string">&#x27;https://httpbin.org/cookies/set/number/123456789&#x27;</span>)</span><br><span class="line">r = requests.get(<span class="string">&#x27;https://httpbin.org/cookies&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;cookies&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里请求测试网址<code>https://httpbin.org/cookies/set/number/123456789</code>。在请求时设置了一个Cookie条目，名称是number，内容是123456789。然后请求<code>https://httpbin.org/cookies</code>，获取当前Cookie信息。并不能成功获取设置的Cookie。<br>&emsp;&emsp;然后用Session试试看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">S=requests.Session()</span><br><span class="line">S.get(&#x27;https://httpbin.org/cookies/set/number/123456789&#x27;)</span><br><span class="line">r = S.get(&#x27;https://httpbin.org/cookies&#x27;)</span><br><span class="line">print(r.text)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;cookies&quot;: &#123;</span><br><span class="line">    &quot;number&quot;: &quot;123456789&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这样就能获取到设置的Cookie了。  </p>
<h3 id="SSL证书验证"><a href="#SSL证书验证" class="headerlink" title="SSL证书验证"></a>SSL证书验证</h3><p>&emsp;&emsp;现在很多网站要求使用HTTPS协议，但有些网站可能并没有设置好HTTPS证书，或者网站的HTTPS证书可能不被CA机构认可，这些网站就可能出现SSL证书错误的提示。<br>&emsp;&emsp;例如我们访问网站<code>https://ssr2.scrape.center/</code>，如果用Chrome浏览器打开它，会有如下提示：<br><img src="/2024/04/28/%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/11.png"><br>&emsp;&emsp;其实可以在浏览器中通过一些设置来忽略证书的验证。<br>但如果是使用requests库来请求这类网站</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &#x27;https://ssr2.scrape.center&#x27;</span><br><span class="line">response = requests.get(url)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;会出现SSLError错误，因为我们请求的URL的证书是无效的。<br>&emsp;&emsp;但如果还是想爬这个网站的话，可以使用verify参数控制是否验证证书，将此参数设置为False，那么在请求时就不会再验证证书是否有效。不设置verify参数，其默认值是True，会自动验证。  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://ssr2.scrape.center/&#x27;</span></span><br><span class="line">response = requests.get(url,verify=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">E:\JetBrains\python386\lib\site-packages\urllib3\connectionpool.py:<span class="number">1103</span>: InsecureRequestWarning: Unverified HTTPS request <span class="keyword">is</span> being made to host <span class="string">&#x27;ssr2.scrape.center&#x27;</span>. Adding certificate verification <span class="keyword">is</span> strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html<span class="comment">#tls-warnings</span></span><br><span class="line">  warnings.warn(</span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;不过有警告，建议我们给它指定证书，我们可以通过设置忽略警告的方式来屏蔽这个警告。  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line">url = <span class="string">&#x27;https://ssr2.scrape.center/&#x27;</span></span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line">response = requests.get(url,verify=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;或捕获警告到日志的方式忽略警告：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">url = <span class="string">&#x27;https://ssr2.scrape.center/&#x27;</span></span><br><span class="line">logging.captureWarnings(<span class="literal">True</span>)</span><br><span class="line">response = requests.get(url,verify=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;也可以指定一个本地证书作为客户端证书，可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组： </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line">response = requests.get(<span class="string">&#x27;https://ssr2.scrape.center/&#x27;</span>,cert=(<span class="string">&#x27;/path/server.crt&#x27;</span>,<span class="string">&#x27;/path/server.key&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里需要有crt和key文件，并指定他们的路径，而且本地私有证书的key必须是解密状态加密状态的key是不支持的。  </p>
<h3 id="超时设置"><a href="#超时设置" class="headerlink" title="超时设置"></a>超时设置</h3><p>&emsp;&emsp;在本机网络状况不好或服务器网络响应太慢甚至无响应时，我们可能会等待特别久的时间才能收到响应，甚至到最后因为接收不到响应而报错。为了防止服务器不能及时响应，可以设置一个超时时间，如果超过了这个时间还没有得到响应，就报错。<br>&emsp;&emsp;这里要用到timeout参数，其值是从发出请求到服务器返回响应的时间。<br>实例  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://httpbin.org/get&#x27;</span></span><br><span class="line">response = requests.get(url,timeout=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果在相应时间内没有响应就会抛出异常。<br>&emsp;&emsp;请求分为两个阶段：连接(connect)和读取(read)。如果想要分别指定连接和读取的timeout，则可以传入一个元组<code>response = requests.get(url,timeout=(5,30))</code>  </p>
<h3 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h3><p>&emsp;&emsp;在访问启用了基本身份认证的网站时，首先会弹出一个认证窗口，如前面遇到的<code>https://ssr3.scrape.center</code>。<br>&emsp;&emsp;可以使用requests库自带的身份认证功能，通过auth参数即可设置。<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line">url = <span class="string">&#x27;https://ssr3.scrape.center&#x27;</span></span><br><span class="line">response = requests.get(url,auth=HTTPBasicAuth(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这个实例网站的用户名和密码都是admin，这里可以直接设置。<br>&emsp;&emsp;如果用户名和密码正确，那么请求时就会自动认证成功，返回200状态码；如果认证失败，则返回401状态码。<br>&emsp;&emsp;参数都传一个HTTPBasicAuth类，显得有些繁琐，有更简单的写法，直接传一个元组，它会默认使用HTTPBasicAuth这个类来认证。  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://ssr3.scrape.center&#x27;</span></span><br><span class="line">response = requests.get(url,auth=(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;还有其他认证方式，如OAuth认证，这个需要安装oauth包<code>pip3 install requests_oauthlib</code><br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests_oauthlib <span class="keyword">import</span> OAuth1</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://ssr3.scrape.center&#x27;</span></span><br><span class="line">auth = OAuth1(<span class="string">&#x27;YOUR_API_KEY&#x27;</span>, <span class="string">&#x27;YOUR_API_SECRET&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;USER_OAUTH_TOKEN&#x27;</span>,<span class="string">&#x27;USER_OAUTH_TOKEN_SECRET&#x27;</span>)</span><br><span class="line">response=requests.get(url,auth=auth)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br></pre></td></tr></table></figure>
<h3 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h3><p>&emsp;&emsp;某些网站在测试的时候请求几次，都能正常获取内容。但是一旦大规模且频繁的请求时，这些网站就可能弹出验证码，或者跳转到登录认证界面，甚至会直接封禁客户端的IP，导致在一定时间内无法访问。<br>&emsp;&emsp;为了防止这种情况发生，我们需要设置代理来解决这个问题，要用到proxies参数。可以用如下方式设置：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://10.10.10.10:1080&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://10.10.10.10:1080&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com&#x27;</span></span><br><span class="line">requests.get(url, proxies=proxies)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里直接运行是不可以的，因为这个代理无效，可以找有效的代理替换试验。<br>&emsp;&emsp;如果代理需要使用身份认证，可以使用类似<code>https://user:password@host:port</code>这样的语法来设置代理：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://user:password@10.10.10.10:1080&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.get(<span class="string">&#x27;https://www.httpbin.org/get&#x27;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;除了基本的HTTP代理外，requsts库还支持SOCKS协议的代理。<br>&emsp;&emsp;首先要安装socks这个库:<code>pip3 install &quot;requests[socks]&quot;</code><br>&emsp;&emsp;然后就可以使用SOCKS协议代理了<br>实例</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">proxies =&#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;socks5://user:password@host:port&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;socks5://user:password@host:&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">requests.get(<span class="string">&#x27;http://www.httpbin.org/get&#x27;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>

<h3 id="Prepared-Request"><a href="#Prepared-Request" class="headerlink" title="Prepared Request"></a>Prepared Request</h3><p>&emsp;&emsp;我们可以直接使用requests库的get和post方法的请求，但是这个请求在requests内部是怎么实现的。<br>&emsp;&emsp;实际上，requests在发送请求的时候，是在内部构造了一个Request对象，并给这个对象赋予了各种参数，包括url、headers、data等，然后直接把这个Request对象发出去，请求成功后会再得到一个Response对象，解析这个对象即可。而对于Request对象，其实它就是Prepared Request。<br>&emsp;&emsp;不使用get，而是直接构造一个Prepared Request对象来试试：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Request,Session</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://www.httpbin.org/post&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;germy&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 Edg/124.0.0.0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">s = Session()</span><br><span class="line">req = Request(<span class="string">&#x27;POST&#x27;</span>,url,data=data,headers=headers)</span><br><span class="line">prepped = s.prepare_request(req)</span><br><span class="line">response = s.send(prepped)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;args&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">  <span class="string">&quot;files&quot;</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">&quot;form&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;germy&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;headers&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Length&quot;</span>: <span class="string">&quot;10&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;www.httpbin.org&quot;</span>, </span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 Edg/124.0.0.0&quot;</span>, </span><br><span class="line">    <span class="string">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="string">&quot;Root=1-663a1529-42d19be2162994625bf75e11&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;json&quot;</span>: null, </span><br><span class="line">  <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;219.156.133.195&quot;</span>, </span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://www.httpbin.org/post&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们引入了Request类，然后用url、data和headers参数构造了一个Request对象，这时调用Session类的prepare_request方法将其转换为Prepared Request对象，再调用send方法发送，即可达到和POST请求同样的效果。<br>&emsp;&emsp;有了Request这个对象，就可以将请求当作独立的对象来看待，这里可以直接操作这个Request对象，更灵活地实现请求的调度和各种操作。  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/25/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/25/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">爬虫基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-25 21:25:09" itemprop="dateCreated datePublished" datetime="2024-04-25T21:25:09+08:00">2024-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-05-06 17:04:19" itemprop="dateModified" datetime="2024-05-06T17:04:19+08:00">2024-05-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">爬虫</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Http基本原理"><a href="#Http基本原理" class="headerlink" title="Http基本原理"></a>Http基本原理</h1><h2 id="URI和URL"><a href="#URI和URL" class="headerlink" title="URI和URL"></a>URI和URL</h2><p>&emsp;&emsp;<strong>URI</strong>全称：Uniform Resource Identifier，即统一资源标志符；<strong>URL</strong>的全称为Uniform Resource Locator，即统一资源定位符。举例：<code>https://github.com/favicon.ico</code> 既是一个URI，也是一个URL。即有favicon.ico这样一个图标资源，我们用URI&#x2F;URL指定了访问它的唯一方式，其中包括https、访问路径（根目录）和资源名称。通过这样一个链接，就可以从互联网中找到某个资源，这个链接就是URI&#x2F;URL。<br>&emsp;&emsp;URL是URI的子集。除了URL，URI还包括一个子类，是URN（Uniform Resource Name），即统一资源名称。URN只为资源命名，而不指定如何定位资源。<br>&emsp;&emsp;<strong>URL</strong>基本格式：<br><code>scheme://[username:password@]hostname[:port][/path][;parameters][?query][#fragment]</code> 其中，中括号包括的内容代表非必要部分，如 <code>https://www.baidu.com</code> 这个URL，这里只包含了scheme、hostname两部分，没有part、parameters、query、fragment。  </p>
<ul>
<li><p>scheme：协议。常见协议有http、https、ftp等，另外scheme也被称作protocol，都代表协议的意思。  </p>
</li>
<li><p>username、passward: 用户名和密码。某些情况下URL需要提供用户名和密码才能访问，这时候把用户名和密码放在host前面。如<code>https://ssr3.scrape.center</code> 这个URL需要用户名和密码才能访问，直接写为<code>https://admin:admin@ssr3.scrape.center</code> 就能直接访问。</p>
</li>
<li><p>hostname：主机地址。可以是域名或IP地址，比如<code>https://www.baidu.com</code>这个URL中的hostname就是<code>www.baidu.com</code>，这就是百度的二级域名。比如<code>https://8.8.8.8</code>，这个URL中的hostname，它是一个IP地址。  </p>
</li>
<li><p>port：端口。这是服务器设定的服务端口，比如<code>https://8.8.8.8:12345</code>，这个URL中的端口就是12345。但是有些URL中没有端口信息，使用了默认端口。http协议的默认端口是80，https协议的默认端口是443。所以 <code>https://www.baidu.com</code> 其实相当于<code>https://www.baidu.com:443</code>, <code>http://www.baidu.com</code> 相当于<code>http://www.baidu.com:80</code>。  </p>
</li>
<li><p>path：路径。指的是网络资源在服务器中的指定地址，比如 <code>https://github.com/favicon.ico</code>中的path就是 favicon.ico ，指的是访问Github根目录下的favicon.ico。</p>
</li>
<li><p>paremeters：参数。用来指定访问某个资源时的附加信息，比如<code>https://8.8.8.8:12345/hello;user</code>中的user就是parameters。但是parameters现在用的少，很多人把参数后面的query部分称为参数，甚至把parameters和query混用。严格来说，parameters是<code>;</code>后面的部分。  </p>
</li>
<li><p>query: 查询。用于查询某类资源，如果有多个查询用&amp;隔开。query很常见，比如<code>https://www.baidu.com/s?wd=nba&amp;ie=utf-8</code> ，其中query部分就是wd&#x3D;nba&amp;ie&#x3D;utf-8，这里指定了wd是nba，ie是utf-8。我们平时见到的参数、GET请求参数、parameters、params等称呼多情况指代的也是query。  </p>
</li>
<li><p>fragment: 片段。它是对资源描述的部分补充，可以理解为资源内部的书签。有两个主要应用，一个是单页面路由，如前端框架Vue、Reat都可以借助它来做到路由管理；另一个是坐HTML锚点，用它控制一个页面打开时自动下滑滚动到某个特定位置。</p>
</li>
</ul>
<h2 id="HTTP和HTTPS"><a href="#HTTP和HTTPS" class="headerlink" title="HTTP和HTTPS"></a>HTTP和HTTPS</h2><p>&emsp;&emsp;<strong>HTTP</strong>：超文本传输协议，其作用是把超文本数据从网络传输到本地浏览器，能够保证高效而准确地传输超文本文档。</p>
<p>&emsp;&emsp;<strong>HTTPS</strong>：是以安全为目标的HTTP通道，简单讲就是HTTP安全版，即在HTTP下加入SSL层，简称HTTPS。<br>&emsp;&emsp;HTTPS的安全基础是SSL，因此通过该协议传输的内容都是经过SSL加密的，SSL的主要作用有：</p>
<ul>
<li>建立安全通道，保证数据传输的安全性。</li>
<li>确认网站的真实性。凡是使用了HTTPS协议的网站，都可以通过单击浏览器地址栏的锁头标志来查看网站认证之后的真实信息，此外还可以通过VA机构颁发的安全签章来查询。</li>
</ul>
<p>&emsp;&emsp;HTTP和HTTPS协议都属于计算机网络中的应用层协议，其下层是基于TCP协议实现的，TCP协议属于计算机网络中的传输层协议，包括建立连接时的三次握手和断开时四次挥手等过程。<br><img src="/2024/04/25/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/3.png">  </p>
<h2 id="HTTP请求过程"><a href="#HTTP请求过程" class="headerlink" title="HTTP请求过程"></a>HTTP请求过程</h2><p>&emsp;&emsp;在浏览器地址栏中输入一个URL，按下回车即可看到对应网页内容。这个过程是浏览器先向网站所在的服务器发送一个请求，网站服务器接收到请求后对其进行处理和解析，然后返回对应的相应，接着传回浏览器。由于响应里包含页面源代码内容，浏览器再对其进行解析，将网页呈现出来。<br>&emsp;&emsp;使用Chrome浏览器开发者模式下的Network监听组件来演示。Network监听组件可以在访问当前请求的网页时，显示产生的所有网络请求和响应。<br>&emsp;&emsp;打开浏览器，访问百度，单击鼠标右键选择“检查”菜单或者直接快捷键F12，打开浏览器的开发者工具。<br>&emsp;&emsp;切换到Network面板，重新刷新页面，就可以看到在Network面板下出现很多条目，每一个条目代表依次发送请求和接收响应的过程。<br><img src="/2024/04/25/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/1.png"><br>&emsp;&emsp;观察第一个网络请求<code>www.baidu.com</code>，各列含义：</p>
<ul>
<li>Name：请求的名称。一般用URL的最后一部分内容作为名称。</li>
<li>Status: 响应状态码。这里显示200，代表响应是正常的。通过状态码判断发送请求之后是否得到正常响应。</li>
<li>Type: 请求的文档类型。document代表这次请求的是一个HTML文档，内容是一些HTML代码。</li>
<li>Initiator: 请求源。标记请求是由哪个对象或进程发起的。</li>
<li>Size: 从服务器下载的文件或请求的资源的大小。如果资源是从缓存中取得到的，则会显示memory cache（内存缓存）&#x2F;disk cache（磁盘缓存）。  </li>
<li>Time: 从发起请求到获取响应所花的总时间。  </li>
<li>Waterfall: 网络请求的可视化瀑布流。<br>&emsp;&emsp;单击<code>www.baidu.com</code>看详细信息<br><img src="/2024/04/25/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/2.png"><br>&emsp;&emsp;首先是General部分，其中RequestURL为请求的URL，Request Method为请求的方法，Status Code是响应状态码，Remote Address是远程服务器的地址和端口，Referrer Policy为Referrer判别策略。<br>&emsp;&emsp;往下有Response Headers和Request Headers，分别代表响应头和请求头。请求头包含许多请求信息，如浏览器标识、Cookie、Host等信息，服务器根据请求头的信息判断请求是否合法，做出响应。响应头是响应的一部分，其中包含服务器的类型、文档类型、日期等信息，浏览器在接收到响应后，对其进行解析，呈现网页内容。</li>
</ul>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p>&emsp;&emsp;请求，英文为Request，由客户端发往服务器，分为四部分：请求方法、请求网址、请求头、请求体。</p>
<ul>
<li>请求方法<br>  标识请求客户端请求服务端的方式，常见的有两种：GET和POST。<br>  在浏览器中直接输入URL并回车，便发起了GET请求，请求的参数会直接包含到URL里，例如我们搜索Python，就是一个GET请求，链接为<code>https://www.baidu.com/s?wd=Python</code> URL里包含了请求的query信息，这里的wd标识要搜寻的关键字。<br>  POST请求大多在提交表单时发起，如登录表单，输入用户名和密码后，单击“登录”，通常发起的就是POST请求，其数据通常以表单形式传输，而不会体现在URL中。<br>  Get请求和POST请求的区别：<br>  Get请求中的参数包含在URL里面，数据可以在URL中看到；而POST请求的URL不会包含这些数据，数据都是用过表单形式传输的，会包含在请求体中。<br>  登录时一般要提交用户名和密码，其中密码是敏感信息，使用GET方式请求，密码会暴露在URL里面，造成密码泄露，这时最好使用POST方式发送。上传文件时，由于文件内容比较大，也会选用POST方式。</li>
</ul>
<p><strong>请求方法</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>请求页面，并返回页面内容</td>
</tr>
<tr>
<td>HEAD</td>
<td>类似GET，不过返回的响应中没有具体内容。用于获取报头</td>
</tr>
<tr>
<td>POST</td>
<td>大多用于提交表单或上传文件，数据包含在请求体中</td>
</tr>
<tr>
<td>PUT</td>
<td>用客户端传向服务器的数据取代指定文档中的内容</td>
</tr>
<tr>
<td>DELETE</td>
<td>请求服务器删除指定的页面</td>
</tr>
<tr>
<td>CONNECT</td>
<td>把服务器当跳板，让服务器代替客户端访问其他网页</td>
</tr>
<tr>
<td>OPTIONS</td>
<td>允许客户端查看服务器的性能</td>
</tr>
<tr>
<td>TRACE</td>
<td>回显服务器收到的请求。主要用于测试或诊断</td>
</tr>
</tbody></table>
<ul>
<li>请求的网址<br>URL，它可以唯一确定客户端想要请求的资源。</li>
<li>请求头<br>用来说明服务器要使用的附加信息，重要的有：Cookie、Referer、User-Agent等。<br>Accept: 请求报头域，用于指定客户端可接受哪些类型的信息。<br>Accept-Language: 用于指定客户都拿可接受的语言类型。<br>Accept-Encoding: 用于指定客户端可接受的内容编码。<br>Host: 指定请求资源的主机IP和端口号，其内容为请求URL的原始服务器或网关位置。<br>Cookie: 网站为了辨别用户，进行会话跟踪而存储在用户本地的数据。主要功能是维持当前访问会话。<br>Referer: 标识请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如源统计、防盗链处理。<br>User-Agent: 简称UA，特殊字符串头，可以使服务器识别客户端使用的操作系统及版本、浏览器及版本信息。<br>Content-Type: 用它来表示具体请求中的媒体类型信息。</li>
<li>请求体<br>一般承载的内容是POST请求中的表单数据，对于GET请求，请求体为空。<br>如登录Github时捕获的响应<br><img src="/2024/04/25/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/4.png"><br>登录前，要填写用户名和密码信息，登陆时将这些内容以表单数据的形式提交给服务器，要注意Content-Type为<code>application/x-www-form-urlencoded</code>，只有这样设置Content-Type，内容才会以表单数据形式提交。也可以将Content-Type设置为application&#x2F;json来提交json数据，或者设置为multipart&#x2F;form-data来上传文件。<br><img src="/2024/04/25/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/5.png"><br><strong>Content-Type和POST提交数据方式的关系</strong></li>
</ul>
<table>
<thead>
<tr>
<th>COntent-Type</th>
<th>POST提交数据的方式</th>
</tr>
</thead>
<tbody><tr>
<td>application&#x2F;x-www-form-urlencoded</td>
<td>表单数据</td>
</tr>
<tr>
<td>multipart&#x2F;form-data</td>
<td>表单文件上传</td>
</tr>
<tr>
<td>application&#x2F;json</td>
<td>序列化json数据</td>
</tr>
<tr>
<td>text&#x2F;xml</td>
<td>XML数据</td>
</tr>
</tbody></table>
<p>构造POST请求需要使用正确的Content-Type，并了解设置各种请求库的各个参数时使用的是哪种Content-Type。</p>
<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><ul>
<li>响应状态码<br>由服务器返回给客户端，可以分为三部分：响应状态码、响应头、和响应体。<br>响应状态码，表示服务器的响应状态，如200代表服务器正常相应、404代表页面未找到、500嗲表服务器内部发生错误。  </li>
<li>响应头<br>包含服务器对请求的应答信息。<br>Date: 用于标识响应产生的时间。<br>Last-Modified: 用于指定响应资源的最后修改时间。<br>Content-Encoding: 用于指定响应内容的编码。<br>Server: 包含服务器的信息，例如名称、版本号。<br>Content-Type: 文档类型，指定返回的数据是什么类型<br>Set-Cookie: 设置Cookie。响应头中的Set-Cookie用于告诉浏览器需要将此内容放在Cookie中，下次请求时将Cookie携带上。<br>Expires：用于指定响应的过期时间，可以让代理服务器或浏览器将加载的 内容更新到缓存中。再次访问相同内容时就可以直接从缓存中加载，降低服务器负担，缩短加载时间。  </li>
<li>响应体<br>响应的正文数据都存在于响应体中。爬虫请求网页时，要解析的就是响应体数据。</li>
</ul>
<h1 id="爬虫基本原理"><a href="#爬虫基本原理" class="headerlink" title="爬虫基本原理"></a>爬虫基本原理</h1><p>爬虫就是获取网页并提取和保存信息的自动化程序。</p>
<ul>
<li>获取网页<br>获取网页源代码，源代码里包含网页的部分有用信息，获取源代码就能从中提取有用信息。<br>我们要做的就是构造一个请求并发送给服务器，然后接收到响应并对其进行解析。<br>Python提供了许多库，如urllib、requests等，我们可以用这些库来完成HTTP请求操作。除此之外，请求和响应都可以用类库提供的数据结构来表示，得到相应后只需要解析数据结构中的body部分，即可看到网页的源代码。   </li>
<li>提取信息<br>获取网页源代码后，接下来就是分析源代码，从中提取想要的数据。最常用的是正则表达式，构造正则表达式的过程比较负责且易出错。<br>由于网页结构具有一定的规则，还有一些库是根据网页节点属性、CSS选择器或者XPath来提取网页信息的，如：Beautiful Soup、pyquery、lxml等，使用这些库，可以高效地从源代码中提取网页信息。  </li>
<li>保存数据<br>保存数据的形式多种多样，可以简单保存为TXT文本或JSON文本，也可以保存到数据库，如MySQL或MongoDB，还有远程服务器。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/24/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/24/git/" class="post-title-link" itemprop="url">git</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-24 23:20:04" itemprop="dateCreated datePublished" datetime="2024-04-24T23:20:04+08:00">2024-04-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-25 00:33:09" itemprop="dateModified" datetime="2024-04-25T00:33:09+08:00">2024-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h1><p>官网下载安装即可</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>使用命令<code>git -v</code>查看git版本<br>初次使用git需要设置用户名以及邮箱  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;用户名&quot;</span><br><span class="line">git config --global user.email &quot;邮箱&quot;</span><br></pre></td></tr></table></figure>
<p>然后使用<code>git config -l</code>查看配置信息  </p>
<h1 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h1><h2 id="git-init"><a href="#git-init" class="headerlink" title="git init"></a>git init</h2><p>找一个合适的地方创建一个空目空，然后在该目录下打开终端，输入<code>git init</code>命令，会创建出一个<code>.git</code>目录，这个目录存放了git仓库的所有数据。  </p>
<h2 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h2><p>这个命令可以从github或者gitee这种远程服务器上克隆一个已经存在的仓库。<br>使用格式就是<code>git clone 仓库地址</code></p>
<h1 id="工作区域和工作状态"><a href="#工作区域和工作状态" class="headerlink" title="工作区域和工作状态"></a>工作区域和工作状态</h1><h2 id="三个工作区域"><a href="#三个工作区域" class="headerlink" title="三个工作区域"></a>三个工作区域</h2><h3 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h3><p><code>.git</code>所在的目录</p>
<h3 id="暂存区"><a href="#暂存区" class="headerlink" title="暂存区"></a>暂存区</h3><p><code>.git/index</code></p>
<h3 id="本地仓库"><a href="#本地仓库" class="headerlink" title="本地仓库"></a>本地仓库</h3><p><code>.git/objext</code></p>
<h2 id="四种工作状态"><a href="#四种工作状态" class="headerlink" title="四种工作状态"></a>四种工作状态</h2><ul>
<li>未跟踪（Untrack）<br>指我们新建的还没有被git管理的文件</li>
<li>未修改（Unmodified）<br>指已经被git管理但是文件内容还没有发生变化</li>
<li>已修改（Modified）<br>指已经修改过但是还没有添加到暂存区里的文件</li>
<li>已暂存（Staged）<br>指修改后并且已经添加到了暂存区里的文件</li>
</ul>
<h1 id="添加和提交文件"><a href="#添加和提交文件" class="headerlink" title="添加和提交文件"></a>添加和提交文件</h1><p>涉及到的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git status //查看仓库的状态</span><br><span class="line">git add    //添加到暂存区</span><br><span class="line">git commit //提交</span><br></pre></td></tr></table></figure>
<p>可以先执行一下<code>git status</code>命令，会提示没有提交的文件，然后我们在仓库目录下创建一个txt文件，再执行<code>git status</code>，提示这个文件未被跟踪，我们使用<code>git add xxx.txt</code>，该文件已经被添加到了暂存区，接下来使用<code>git commit</code>命令提交文件到仓库中，使用这个命令时要用<code>-m</code>参数指定提交信息，如果不指定，那么提交时会进入一个交互式界面，默认用vim来编辑提交信息，然后提交完成。这里提交的文件是暂存区里的文件。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/22/android-UI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/22/android-UI/" class="post-title-link" itemprop="url">[android]UI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-22 00:16:52" itemprop="dateCreated datePublished" datetime="2024-04-22T00:16:52+08:00">2024-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-25 21:24:25" itemprop="dateModified" datetime="2024-04-25T21:24:25+08:00">2024-04-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="如何编写程序界面"><a href="#如何编写程序界面" class="headerlink" title="如何编写程序界面"></a>如何编写程序界面</h1><p>通过最基本的方式去实现界面，编写XML代码，当掌握了使用XML来编写界面的方法之后，不管是进行高复杂度界面实现还是分析和修改当前现有的界面，都将手到擒来。</p>
<h1 id="常见控件使用"><a href="#常见控件使用" class="headerlink" title="常见控件使用"></a>常见控件使用</h1><p>新建一个UIWidgetTest项目，允许Android Studio自动创建活动，活动名和布局都使用默认值。  </p>
<h2 id="TextView"><a href="#TextView" class="headerlink" title="TextView"></a>TextView</h2><p>&emsp;&emsp;TextView可以说是Android中最简单的空间了，它主要用于在界面上显示一段文本信息。<br>在res目录下创建一个layout目录，然后在其中创建一个activity_main.xml文件，往里面放置一个TextView。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/textView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;TextView&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;外层的LinearLayout（根元素）先忽略不看，在TextView中使用android:id给当前控件定义了一个唯一标识符。然后使用android:layout_width和android:layout_height指定控件的宽度和高度。Android中的所有控件的都有这两个属性，可选值有三种：match_parent、fill_parent和wrap_content，其中match_parent和fill_parent的功能相同。fill_parent是Android早期版本使用的属性，现在官方推荐使用match_parent,它的作用是让当前控件的大小和父布局的大小一样，也就是由父布局来决定当前控件的大小。wrap_content表示让当前控件的大小能够刚好包含里面的内容，也就是由控件内容决定当前控件的大小。<br>&emsp;&emsp;指定文字内容可以正常显示，但是TextView的宽度和屏幕是一样宽的。这是由于TextView中的文字默认是居左上角对其的，TextView的宽度充满了整个屏幕，由于文字内容不够长，所以效果不明显。我们可以修改文字对齐方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textView&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:gravity=&quot;center&quot;</span><br><span class="line">        android:text=&quot;TextView&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>我们还可以对TextVIew中文字的大小和颜色进行修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/textView&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:gravity=&quot;center&quot;</span><br><span class="line">        android:textSize=&quot;24sp&quot;  //指定大小</span><br><span class="line">        android:textColor=&quot;#00ff00&quot;  //指定颜色</span><br><span class="line">        android:text=&quot;TextView&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Button"><a href="#Button" class="headerlink" title="Button"></a>Button</h2><p>Button是程序用于和用户进行交互的一个重要控件，它的可配置的属性和TextView差不多，在activity_main.xml中加入Button:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Button&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;而这里，布局文件里的文字是“Button”，但是最终的显示结果确实“BUTTON”。这是由于系统对Button中的所有英文字母自动进行了大写转换，我们可以禁用这一默认特性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/button&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;Button&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:textAllCaps</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在MainActivity中为Button的点击事件注册一个监听器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button1</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line">        button1.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="comment">//添加逻辑</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当每次点击按钮时，就会执行监听器中的onClick()方法，我们只需要在方法中加入要处理的逻辑即可。如果不喜欢使用匿名类的方式来注册监听器，也可以使用实现接口的方式来注册：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title class_">View</span>.OnClickListener&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button1</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line">        button1.setOnClickListener(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.button:</span><br><span class="line">                <span class="comment">//添加逻辑</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码在IDE中提示由于<code>switch</code>语句标签太少，应该用<code>if</code>替换，而且在Android Gradle8.0版本中，资源ID默认非final,所有应该避免在<code>switch case</code>使用。修改后的  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener&#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Button button1 = (Button) findViewById(R.id.button);</span><br><span class="line">        button1.setOnClickListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        if (v.getId()==R.id.button)&#123;</span><br><span class="line">            // 添加逻辑</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            // 添加逻辑</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两种方式都可以实现对按钮点击事件的监听</p>
<h2 id="EditText"><a href="#EditText" class="headerlink" title="EditText"></a>EditText</h2><p>&emsp;&emsp;EditText是程序用于和用户进行交互的另一个重要控件，它允许用户在控件里输入和编辑内容，并可以在程序中对这些内容进行处理。<br>&emsp;&emsp;修改activity_main.xml中的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditText</span><br><span class="line">    android:id=&quot;@+id/edit_text&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;/    </span><br></pre></td></tr></table></figure>
<p>这就是使用XML来编写界面，完全不用借助可视化工具来实现。运行程序，即可看到EditText的显示，我们可以在里面输入内容。<br>输入框提示文字，修改activity_main.xml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditText</span><br><span class="line">    android:id=&quot;@+id/edit_text&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:hint=&quot;Type something here&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里android:hint属性指定了一段提示性文本，当我们输入任何内容时，这段文本就会自动消失。<br>&emsp;&emsp;随内容不断增多，EditText会不断拉长，由于EditText的高度指定的是wrap_content，所以它总能包含住里面的内容，但是当输入的内容过多时，界面就会变的难看，我们可以使用android:maxLines属性来解决这个问题，修改activity_main.xml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditText</span><br><span class="line">    android:id=&quot;@+id/edit_text&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:hint=&quot;Type something here&quot;</span><br><span class="line">    android:maxLines=&quot;2&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里指定了ExitText的最大行数为两行，当输入的内容超过两行时，文本就会向上滚动，而EditText不会继续拉伸。<br>还可以结合使用EditText与Button实现一些功能，如通过点击按钮来获取EditText中输入的内容。修改MainActivity中的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener&#123;</span><br><span class="line"></span><br><span class="line">    private EditText editText;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Button button1 = (Button) findViewById(R.id.button);</span><br><span class="line">        button1.setOnClickListener(this);</span><br><span class="line">        editText = (EditText) findViewById(R.id.edit_text);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        if (v.getId()==R.id.button)&#123;</span><br><span class="line">            String inputText = editText.getText().toString();</span><br><span class="line">            Toast.makeText(MainActivity.this,inputText,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            // 添加逻辑</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;通过findViewById()方法得到EditText的实例，然后在按钮的点击事件里调用EditText的getText()方法获取到输入的内容，再调用toString()方法转为字符串，最后用Toast将输入的内容显示出来。  </p>
<h2 id="ImageView"><a href="#ImageView" class="headerlink" title="ImageView"></a>ImageView</h2><p>&emsp;&emsp;ImageView是用于在界面上展示图片的一个控件，它可以让程序更加丰富多彩。我们需要提前准备一些图片，图片通常放在以”drawable”开头的目录下。我们项目中已经有一个drawable目录了，但是还没有指定具体的分辨率，所以一般不使用它来放置图片。我们在res目录下新建一个drawable-xhdpi目录，放置两张图片img_1.png和img_2.png。修改activity_xml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;ImageView</span><br><span class="line">    android:id=&quot;@+id/image_view&quot;</span><br><span class="line">    android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:src=&quot;@drawable/img_1&quot;/&gt;</span><br><span class="line">```  </span><br><span class="line">&amp;emsp;&amp;emsp;这里使用android:src属性给ImageView指定了一张图片。由于图片的宽和高都是未知，所以将ImageView的宽和高都设定为wrap_content。  </span><br><span class="line">&amp;emsp;&amp;emsp;我们还可以在程序中通过代码动态地更改ImageView中的图片，然后修改MainActivity的代码：</span><br></pre></td></tr></table></figure>
<p>public class MainActivity extends AppCompatActivity implements View.OnClickListener{</p>
<pre><code>private EditText editText;
private ImageView imageView;

@Override
protected void onCreate(@Nullable Bundle savedInstanceState) &#123;
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    Button button1 = (Button) findViewById(R.id.button);
    button1.setOnClickListener(this);
    editText = (EditText) findViewById(R.id.edit_text);
    imageView = (ImageView) findViewById(R.id.image_view);

&#125;

@Override
public void onClick(View v) &#123;
    if (v.getId()==R.id.button)&#123;
        imageView.setImageResource(R.drawable.img_2);
    &#125;else&#123;
        // 添加逻辑
    &#125;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;emsp;&amp;emsp;在按钮点击事件里，通过调用ImageView的setImageResource()方法将显示的图片改成了img_2，运行程序，点击按钮就可以看到ImageView中显示的图片改变了。  </span><br><span class="line">## ProgressBar</span><br><span class="line">&amp;emsp;&amp;emsp;ProgressBar用于在界面上显示一个进度条，表示我们的程序正在加载一些数据。用法很简单：</span><br></pre></td></tr></table></figure>
<p><ProgressBar android:id="@+id/progress_bar" android:layout_width="match_parent" android:layout_height="wrap_content"></ProgressBar></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;emsp;&amp;emsp;重新运行程序，屏幕中会有一个圆形进度条在旋转。为了能让进度条在数据加载完成后消失，我们要用到一个属性：Android控件的可见属性。所有的Android控件都具有这个属性，可以通过android:visibility进行指定，可选值有3种：visible、invisible和gone。visible表示控件是可见的，这个值是默认值，不指定android:visibility时，控件都是可见的。invisible表示控件不可见，但它还占据着原来位置的大小，可以理解为是控件变成透明状态了。gone表示控件不仅不可见，而且不再占据任何屏幕空间。我们可以通过代码来设置控件的可见性，使用的是setVisibility()方法，可以传入View.VISIBLE、View.INVISIBLE和View.GONE这三种值。  </span><br><span class="line">&amp;emsp;&amp;emsp;我们通过点击按钮让进度条消失：</span><br></pre></td></tr></table></figure>
<p>public class MainActivity extends AppCompatActivity implements View.OnClickListener{</p>
<pre><code>private EditText editText;
private ImageView imageView;

private ProgressBar progressBar;

@Override
protected void onCreate(@Nullable Bundle savedInstanceState) &#123;
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    Button button1 = (Button) findViewById(R.id.button);
    button1.setOnClickListener(this);
    editText = (EditText) findViewById(R.id.edit_text);
    imageView = (ImageView) findViewById(R.id.image_view);
    progressBar = (ProgressBar) findViewById(R.id.progress_bar);

&#125;

@Override
public void onClick(View v) &#123;
    if (v.getId()==R.id.button)&#123;
        if (progressBar.getVisibility()==View.GONE)&#123;
            progressBar.setVisibility(View.VISIBLE);
        &#125;else &#123;
            progressBar.setVisibility(View.GONE);
        &#125;
    &#125;else&#123;
        // 添加逻辑
    &#125;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;emsp;&amp;emsp;在按钮点击事件中，我们通过getVisibility()方法来判断ProgressBar是否可见，如果可见就隐藏掉，如果不可见就将ProgressBar显示出来。重新运行程序，不断点击按钮，就会看到进度条会在显示和隐藏之间来回切换。  </span><br><span class="line">&amp;emsp;&amp;emsp;还可以给ProgressBar指定不同的样式，刚刚看到的是圆形进度条，通过style属性可以将它设置成水平进度条，修改activity_main.xml中的代码：</span><br></pre></td></tr></table></figure>
<p><ProgressBar android:id="@+id/progress_bar" android:layout_width="match_parent" android:layout_height="wrap_content" style="?android:attr/progressBarStyleHorizontal" android:max="100"></ProgressBar></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&amp;emsp;&amp;emsp;指定为水平进度条之后，通过android:max属性给进度条设置一个最大值，然后在代码中动态地更改进度条的进度。修改MainActivity中的代码：</span><br><span class="line">```java</span><br><span class="line">@Override</span><br><span class="line">public void onClick(View v) &#123;</span><br><span class="line">    if (v.getId()==R.id.button)&#123;</span><br><span class="line">        int progress=progressBar.getProgress();</span><br><span class="line">        progress=progress+10;</span><br><span class="line">        progressBar.setProgress(progress);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        // 添加逻辑</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;每点击一次按钮，我们就获取当前进度，然后在现有的进度上加10作为更新后的进度。  </p>
<h2 id="AlertDialog"><a href="#AlertDialog" class="headerlink" title="AlertDialog"></a>AlertDialog</h2><p>&emsp;&emsp;AlertDialog可以在当前界面弹出一个对话框，这个对话框是置顶于所有界面元素之上的，能够屏蔽掉其他控件的交互功能，因此，AlertDialog一般用于提示一些非常重要的内容或者警告信息。<br>&emsp;&emsp;比如为例防止用户删除重要内容，在删除前弹出一个确认对话框。修改MainActivity中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (v.getId()==R.id.button)&#123;</span><br><span class="line">        AlertDialog.<span class="type">Builder</span> <span class="variable">dialog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(MainActivity.<span class="built_in">this</span>);</span><br><span class="line">        dialog.setTitle(<span class="string">&quot;This is Dialog&quot;</span>);</span><br><span class="line">        dialog.setMessage(<span class="string">&quot;Something important&quot;</span>);</span><br><span class="line">        dialog.setCancelable(<span class="literal">false</span>);</span><br><span class="line">        dialog.setPositiveButton(<span class="string">&quot;OK&quot;</span>, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> which)</span> &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        dialog.setNegativeButton(<span class="string">&quot;Cancel&quot;</span>, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> which)</span> &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        dialog.show();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 添加逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;首先通过AlertDialog.Builder创建一个AlertDialog的实例，然后可以为这个对话框设置标题、内容、可否取消等特性，接下来调用setPositiveButton()方法为对话框设置确定按钮的点击事件，调用setNegativeButton()方法设置取消按钮的点击事件，最后调用show()方法将对话框显示出来。  </p>
<h2 id="ProgressDialog"><a href="#ProgressDialog" class="headerlink" title="ProgressDialog"></a>ProgressDialog</h2><p>ProgressDialog和AlertDialog有点类似，都可以在界面上弹出一个对话框，都能够屏蔽掉其&emsp;&emsp;他控件的交互能力。不同的是，ProgressDialog会在对话框中显示一个进度条，一般用于表示当前操作比较耗时，让用户耐心等待。用法也和AlertDialog相似，修改MainActivity代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onClick(View v) &#123;</span><br><span class="line">    if (v.getId()==R.id.button)&#123;</span><br><span class="line">        ProgressDialog progressDialog = new ProgressDialog(MainActivity.this);</span><br><span class="line">        progressDialog.setTitle(&quot;This is ProgressDialog&quot;);</span><br><span class="line">        progressDialog.setMessage(&quot;Loading...&quot;);</span><br><span class="line">        progressDialog.setCancelable(true);</span><br><span class="line">        progressDialog.show();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        // 添加逻辑</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里也是先构建ProgressDialog对象，然后设置标题，内容，可否取消等属性，最后通过show()方法将ProgressDialog显示出来。<br>&emsp;&emsp;注意，如果在setCancelable()中传入了false，表示ProgressDialog是不能通过Back键取消掉的，这时就一定要在代码中做好控制，当数据加载完成后必须调用ProgressDialog的dismiss()方法来关闭对话框，否则ProgressDialog将会一直存在。</p>
<h1 id="四种布局"><a href="#四种布局" class="headerlink" title="四种布局"></a>四种布局</h1><p>新建一个UILayoutTest项目，让Android Studio自动帮我们创建活动，活动名和布局名都是用默认值。</p>
<h2 id="线性布局"><a href="#线性布局" class="headerlink" title="线性布局"></a>线性布局</h2><p>&emsp;&emsp;LinearLayout又称为线性布局，这个布局会将它所包含的控件在线性方向上依次排列。线性排列有两种方向，垂直方向排列和水平方向排列。而上面的案例中都是通过android:orientation属性指定了排列方向是vertical，如果指定的是horizontal，控件就会在水平方向上排列了。修改activity_main.xml中代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button1&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button2&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button3&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们修改LinearLayout的排列方向：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span>    //<span class="attr">排列方向</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果我们不指定android:orientation属性的值，默认排列方向就是horizontal。<br>&emsp;&emsp;注意:如果LinearLayout的排列方向是horizontal，内部的控件就绝不能将宽度指定为match_parent，因为这样的话，单独一个控件就会将整个水平方向占满，其他控件就没有可放置的位置了。同样，如果LinearLayout的排列方向是vetical，内部控件就不能将高度指定为match_parent。<br>&emsp;&emsp;首先看android:layout_gravity属性，它和android:gravity属性相似，android:gravity用于指定文字在控件中的对齐方式，而android:layout_gravity用于指定控件在布局中的对齐方式。需要注意的是，当LinearLayout的排列方式是horizontal时，只有垂直方向的对齐方式才会生效，因为水平方向的长度是不固定的，每添加一个控件，水平方向上的长度都会改变，因而无法指定该方向上的对齐方式。同样，当LinearLayout的排列方向是vertical时，只有水平方向的对齐方式才会生效。修改activity_main.xml中的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button1&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_gravity=&quot;top&quot;</span><br><span class="line">        android:text=&quot;Button1&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button2&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_vertical&quot;</span><br><span class="line">        android:text=&quot;Button2&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button3&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_gravity=&quot;bottom&quot;</span><br><span class="line">        android:text=&quot;Button3&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>由于目前LinearLayout的排列方向是horizontal，因此我们只能指定垂直方向上的排列方向。<br><img src="/2024/04/22/android-UI/1.png"><br>&emsp;&emsp;LineatLayout另一个重要属性——android:layout_weight这个属性允许我们使用比例的方式来指定控件的大小，它在手机屏幕的适配性方面可以起到非常重要的作用。比如我们编写一个消息发送界面，需要文本编辑框和一个发送按钮，修改activity_main.xml中的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditText</span><br><span class="line">    android:id=&quot;@+id/input_message&quot;</span><br><span class="line">    android:layout_width=&quot;0dp&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    tools:ignore=&quot;Suspicious0dp&quot;</span><br><span class="line">    android:layout_weight=&quot;3&quot;</span><br><span class="line">    android:hint=&quot;Type somethind&quot;/&gt;</span><br><span class="line">&lt;Button</span><br><span class="line">    android:id=&quot;@+id/send&quot;</span><br><span class="line">    android:layout_width=&quot;0dp&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_weight=&quot;2&quot;</span><br><span class="line">    android:text=&quot;Send&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里将EditText和Button的宽度都指定成了0dp，但是我们使用了android:layout_weight属性，此时控件的宽度就不由android:layout_width来决定，这里指定为0dp是一种规范写法。dp是Android中指定控件大小、间距等属性的单位。<br>&emsp;&emsp;在EditText和Button里都将android:layout_weight属性的值都指定为1，表示EditText和Button将在水平方向平分宽度。其原理就是系统会先把LinearLayout下所有的控件指定的Layout_weight值相加，得到一个总值，然后每个控件所占大小的比例就是用该控件的layout_weight值除以刚才算出的总值。因此如果想让EditText占据屏幕宽度的3&#x2F;5,Button占据屏幕宽度的2&#x2F;5，只需将EditText的layout_weight改成3，Button的layout_weight改成2就可以了。<br><img src="/2024/04/22/android-UI/2.png"><br>&emsp;&emsp;还可以通过指定部分控件的layout_weight值来实现更好的效果。修改activity_main.xml代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:id=&quot;@+id/input_message&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        tools:ignore=&quot;Suspicious0dp&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:hint=&quot;Type somethind&quot;/&gt;</span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/send&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Send&quot;/&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里仅指定了EditText的android:layout_weight属性，并将Button的宽度改回了wrap_content。表示Button的宽度仍然按照wrap_content来计算，而EditText则会沾满屏幕所有剩余空间。这种方式在屏幕适配方面效果比较好。<br><img src="/2024/04/22/android-UI/3.png">  </p>
<h2 id="相对布局"><a href="#相对布局" class="headerlink" title="相对布局"></a>相对布局</h2><p>RelativeLayout又称为相对布局，也是一种常用布局。和LinearLayout的排列规则不同，RelativeLayout显得更加随意，它可以通过相对定位的方式让控件出现在布局的任何位置。正是如此，RelativeLayout中的属性很多，但是这些属性都是有规律可循的，修改activity_main.xml中的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentLeft</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentTop</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentRight</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentTop</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 2&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 3&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button4&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentLeft</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 4&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button5&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentRight</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 5&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="/2024/04/22/android-UI/4.png"><br>&emsp;&emsp;上面例子中每个控件都是相对于父布局进行定位的，我们可以让控件相对于控件进行定位，修改activity_main.xml中的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 3&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_above</span>=<span class="string">&quot;@id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toLeftOf</span>=<span class="string">&quot;@id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_above</span>=<span class="string">&quot;@+id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toRightOf</span>=<span class="string">&quot;@id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 2&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button4&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">&quot;@id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toLeftOf</span>=<span class="string">&quot;@id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 4&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button5&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">&quot;@id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toRightOf</span>=<span class="string">&quot;@id/button3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Button 5&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;要注意的是，当一个控件去引用另一个控件的id时，该控件一定要定义在引用控件的后面，不然会出现找不到id的情况。<br><img src="/2024/04/22/android-UI/5.png"><br>&emsp;&emsp;RelativeLayout中还有另外一组相对于控件进行定位的属性，android:layout_alignLeft表示让一个控件的左边缘和另一个控件的左边缘对齐，android:layout_alignRight表示让一个控件的右边缘和另一个控件的右边缘对齐。还有android:layout_alignTop和android:layout_alignBotton道理相同。</p>
<h2 id="帧布局"><a href="#帧布局" class="headerlink" title="帧布局"></a>帧布局</h2><p>&emsp;&emsp;FrameLayout又称作帧布局，它相比前两种布局简单很多，应用场景也少很多。这种布局没有方便的定位方式，所有的控件都会默认在布局左上角。修改activity_main.xml中的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/text_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;This is TextView&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/image_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;FrameLayout中只是放置了一个TextView和一个ImageView，这里我们直接使用了@mipmap来访问ic_launcher这张图。<br><img src="/2024/04/22/android-UI/6.png"><br>&emsp;&emsp;可以看到文字和图片都是位于布局左上角。由于ImageView是在TextView之后添加的，因此图片压在了文字的上面。<br>&emsp;&emsp;除了这种默认效果，我们还可以使用layout_gravity属性来指定控件在布局中的对齐方式，这和LinearLayout中的用法是相似的。修改activity_main.xml中的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/text_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;left&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;This is TextView&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/image_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;right&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>指定TextView居左对齐，ImageView居右对齐。<br><img src="/2024/04/22/android-UI/7.png"><br>由于FrameLayout的定位方式欠缺，它的应用场景也比较少。</p>
<h2 id="百分比布局"><a href="#百分比布局" class="headerlink" title="百分比布局"></a>百分比布局</h2><p>&emsp;&emsp;前面的布局中只有LinearLayout支持使用layout_weight属性来实现按比例指定大小的功能，其他两种都不支持。如果想要用RelativeLayout来实现让两个按钮评分布局宽度的效果，则比较困难。<br>&emsp;&emsp;为此，Android引入了新的布局方式来解决这个问题——百分比布局。这种布局中，不再使用wrap_content、match_parent等方式指定控件的大小了，而是允许直接直指定控件所占的百分比，这样可以轻松实现平分布局甚至任意比例分割布局的效果。<br>&emsp;&emsp;百分比布局提供了PercentFrameLayout和PercentRelativeLayout这两个全新的布局。Android将百分比布局定义在了suport库中，我们只需要在项目的build.gradle中添加百分比布局库的依赖，就能保证百分比布局在Android所有系统版本上的兼容性了。<br>&emsp;&emsp;打开app&#x2F;build.gradle文件，在dependencies闭包中添加如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation (&quot;androidx.percentlayout:percentlayout:1.0.0&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每当修改了任何gradle文件时，Android Studio都会弹出提示，需要我们再次同步才能使项目正常工作，点击<code>Sync Now</code>即可。修改activity_main.xml中的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Button 1 --&gt;</span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button1&quot;</span><br><span class="line">        android:text=&quot;Button1&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;0dp&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintStart_toStartOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintEnd_toStartOf=&quot;@id/button2&quot;</span><br><span class="line">        app:layout_constraintBottom_toTopOf=&quot;@id/button3&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Button 2 --&gt;</span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button2&quot;</span><br><span class="line">        android:text=&quot;Button2&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;0dp&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintEnd_toEndOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintStart_toEndOf=&quot;@id/button1&quot;</span><br><span class="line">        app:layout_constraintBottom_toTopOf=&quot;@id/button4&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Button 3 --&gt;</span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button3&quot;</span><br><span class="line">        android:text=&quot;Button3&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;0dp&quot;</span><br><span class="line">        app:layout_constraintStart_toStartOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintEnd_toStartOf=&quot;@id/button4&quot;</span><br><span class="line">        app:layout_constraintTop_toBottomOf=&quot;@id/button1&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Button 4 --&gt;</span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/button4&quot;</span><br><span class="line">        android:text=&quot;Button4&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;0dp&quot;</span><br><span class="line">        app:layout_constraintEnd_toEndOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintStart_toEndOf=&quot;@id/button3&quot;</span><br><span class="line">        app:layout_constraintTop_toBottomOf=&quot;@id/button2&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br><span class="line"></span><br><span class="line">```  </span><br><span class="line">![](android-UI/8.png)   </span><br><span class="line"># 创建自定义控件</span><br><span class="line">控件和布局的继承结构  </span><br><span class="line">![](android-UI/9.png)   </span><br><span class="line">&amp;emsp;&amp;emsp;所用的控件都是直接或间接继承自View的，所用的布局都是直接或间接继承自ViewGroup的。View是Android中最基本的一种UI组件，它可以在屏幕上绘制一块矩形区域，并能影响这块区域的各种事件，我们使用的各种控件其实就是在View的基础之上添加了各自特有的功能。而ViewGroup则是一种特殊的View，它包含了很多子View和子ViewGroup，是一个放置控件和布局的容器。</span><br><span class="line">&amp;emsp;&amp;emsp;创建一个UICustomViews项目。</span><br><span class="line">## 引入布局</span><br><span class="line">&amp;emsp;&amp;emsp;在iPhone中，几乎每个应用的界面顶部都会有一个标题栏，标题栏上会有一到两个按钮可用于返回或其他操作。这里我们创建自定义标题栏。  </span><br><span class="line">&amp;emsp;&amp;emsp;只需要加入两个Button和一个TextView，然后在布局中摆放好就可以了。</span><br><span class="line">为了减少代码重复，可以使用引入布局的方式来解决这个问题，新建一个布局title.xml:</span><br></pre></td></tr></table></figure>
<?xml version="1.0" encoding="utf-8"?>
<p><LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent"></LinearLayout></p>
<pre><code>&lt;Button
    android:id=&quot;@+id/title_back&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_gravity=&quot;top&quot;
    android:layout_margin=&quot;5dp&quot;
    android:text=&quot;Back&quot;
    android:textColor=&quot;#fff&quot; /&gt;

&lt;TextView
    android:id=&quot;@+id/title_text&quot;
    android:layout_width=&quot;0dp&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_gravity=&quot;top&quot;
    android:layout_weight=&quot;1&quot;
    android:gravity=&quot;center&quot;
    android:text=&quot;Title Text&quot;
    android:textColor=&quot;#000&quot;
    android:textSize=&quot;24sp&quot;/&gt;

&lt;Button
    android:id=&quot;@+id/title_edit&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_gravity=&quot;top&quot;
    android:layout_margin=&quot;5dp&quot;
    android:text=&quot;Edit&quot;
    android:textColor=&quot;#fff&quot;
    /&gt;
</code></pre>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&amp;emsp;&amp;emsp;在这里使用了android:layout_margin属性，它可以指定控件在上下左右方向上偏移的距离，也可以用android:layout_marginLeft或android:layout_marginTop等属性单独指定控件在某个方向上偏移的距离。  </span><br><span class="line">&amp;emsp;&amp;emsp;标题栏布局编写完成，剩下就是在程序中使用标题栏，修改activity_main.xml中代码：</span><br><span class="line">```xml</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line">    &lt;include layout=&quot;@layout/title&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;隐藏系统自带标题
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    ActionBar actionbar= getSupportActionBar();</span><br><span class="line">    if (actionbar!= null)&#123;</span><br><span class="line">        actionbar.hide();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;通过调用getSupportActionBar()方法来获得ActionBar的实例，然后调用ActionBar的hide()方法将标题隐藏起来。  
## 创建自定义控件
&emsp;&emsp;新建TitleLayout继承自LinearLayout,让它成为我们自定义的标题栏控件：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class TitleLayout extends LinearLayout &#123;</span><br><span class="line">    public TitleLayout(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        LayoutInflater.from(context).inflate(R.layout.title,this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;我们重写了LinearLayout中带有两个参数的构造函数，在布局中引入TitleLayout控件就会调用这个构造函数。然后在构造函数中需要对标题栏布局进行动态加载，借助LayoutInflater来实现。通过LayoutInflater的from()方法可以构建出一个LayoutInflater对象，然后调用inflate()方法动态加载一个布局文件，inflate()方法接收两个参数，第一个参数是要加载布局文件的id这里我们传入R.id.title，第二个参数给加载好的布局再添加一个父布局，这里我们想要指定为TitleLayout，传入this。  
&emsp;&emsp;在布局文件中添加这个自定义控件，修改activity_main.xml中的代码：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line">    &lt;com.example.uicustomviews.TitleLayout </span><br><span class="line">        tools:ignore=&quot;MissingClass&quot;  </span><br><span class="line">        android:layout_height=&quot;match_parent&quot; </span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;/&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;添加自定义控件和添加普通控件的方式基本一样，只不过在添加自定义控件时，我们要指明控件的完整类名。  
&emsp;&emsp;为标题栏的按钮注册点击事件，修改TitleLayout中的代码：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TitleLayout</span> <span class="keyword">extends</span> <span class="title class_">LinearLayout</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TitleLayout</span><span class="params">(Context context, <span class="meta">@Nullable</span> AttributeSet attrs)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs);</span><br><span class="line">        LayoutInflater.from(context).inflate(R.layout.title,<span class="built_in">this</span>);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">titleedit</span> <span class="operator">=</span> (Button) findViewById(R.id.title_edit);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">titleback</span> <span class="operator">=</span> (Button) findViewById(R.id.title_back);</span><br><span class="line">        titleback.setOnClickListener(<span class="keyword">new</span> <span class="title class_">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                ((Activity)getContext()).finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        titleedit.setOnClickListener(<span class="keyword">new</span> <span class="title class_">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                Toast.makeText(getContext(),<span class="string">&quot;You cliclk Edit button&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;先通过findViewById()方法得到按钮实例然后调用setOnClickListener()方法给两个按钮注册点击事件，当点击返回按钮时，销毁当前的活动，当点击编辑按钮时弹出一段文本。  
&emsp;&emsp;这样每当在一个布局中引入TitleLayout时，返回按钮和编辑按钮的点击事件就已经自动实现好了。
# ListView
&emsp;&emsp;由于手机屏幕空间都比较有限，能够一次性在屏幕上显示的内容不多，当我们的程序中有大量的数据需要展示时，就可以借助ListView来实现。ListView允许用户通过手指上下滑动的方式将屏幕外的数据滚动到屏幕内，同时屏幕上原有的数据则会滚动出屏幕。  
## ListView的简单用法
&emsp;&emsp;先新建一个ListViewTest项目，让Android Studio自动帮我们创建好活动。修改activity_main.xml中的代码：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:id=&quot;@+id/list_view&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
修改MainActivity中的代码：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line">    private String[] data = &#123;&quot;Apple&quot;,&quot;Banana&quot;,&quot;Orange&quot;,&quot;Watermelon&quot;,</span><br><span class="line">            &quot;Pear&quot;,&quot;Grape&quot;,&quot;Pineapple&quot;,&quot;Strawberry&quot;,&quot;Cherry&quot;,&quot;Mango&quot;,</span><br><span class="line">            &quot;Apple&quot;,&quot;Banana&quot;,&quot;Orange&quot;,&quot;Watermelon&quot;,</span><br><span class="line">            &quot;Pear&quot;,&quot;Grape&quot;,&quot;Pineapple&quot;,&quot;Strawberry&quot;,&quot;Cherry&quot;,&quot;Mango&quot;&#125;;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(</span><br><span class="line">                MainActivity.this, android.R.layout.simple_list_item_1,data</span><br><span class="line">        );</span><br><span class="line">        ListView listView= (ListView) findViewById(R.id.list_view);</span><br><span class="line">        listView.setAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;我们用了data数组来测试，里面包含了很多水果的名称。不过数组中的数据是无法直接传递给ListView的，我们还需要借助适配器来完成。Android中提供了很多适配器的实现类，其中ArrayAdapter较好用。它可以通过泛型来指定要适配的数据类型，然后在构造函数中把要适配的数据传入。ArrayAdapter有多个构造函数的重载，根据实际情况选择最合适的一种。ArrayAdapter的构造函数中依次传入当前上下文、ListView子项布局的id，以及要适配的数据。我们使用了android.R.layout.simple_list_item_1作为ListView子项布局的id，这是一个Android内置的布局文件，里面只有一个TextView，用于简单地显示一段文本。  
&emsp;&emsp;最后调用ListView的setAdapter()方法，将构建好的适配器对象传递进去，ListView和数据之间的关联就建立完成了。  
## 定制ListView的界面
&emsp;&emsp;首先准备一组图片，分别对应上面提供的每一种水果，让这些水果名称的旁边都有一个图样。（资源文件名只能包含小写字母，不能包含大写字母）。  
&emsp;&emsp;定义实体类，作为ListView适配器的适配类型。新建类Fruit:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Fruit &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int imageId;</span><br><span class="line">    public Fruit(String name,int imageId)&#123;</span><br><span class="line">        this.name=name;</span><br><span class="line">        this.imageId=imageId;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getName()&#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line">    public int getImageId()&#123;</span><br><span class="line">        return imageId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;Fruit类中只有两个字段，name表示水果的名字，imageId表示水果对应图片的资源id。  
&emsp;&emsp;为ListView的子项指定我们自定义的布局，在layout目录下新建fruit_item.xml：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:id=&quot;@+id/fruit_image&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;/&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/fruit_name&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_gravity=&quot;center&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;10dp&quot;/&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;这个布局里，定义了一个ImageView用于显示水果的图片，又定义了一个TextView用于显示水果名称，让TextView在垂直方向上居中显示。   
&emsp;&emsp;然后创建自定义适配器，这个适配器继承自ArrayAdapter，并将泛型指定为Fruit类。新建类FruitAdapter:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class FruitAdapter extends ArrayAdapter&lt;Fruit&gt; &#123;</span><br><span class="line">    private int resourceId;</span><br><span class="line"></span><br><span class="line">    public FruitAdapter(@NonNull Context context, int textViewResourceId, @NonNull List&lt;Fruit&gt; objects) &#123;</span><br><span class="line">        super(context,textViewResourceId, objects);</span><br><span class="line">        resourceId=textViewResourceId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @NonNull</span><br><span class="line">    @Override</span><br><span class="line">    public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) &#123;</span><br><span class="line">        Fruit fruit = getItem(position);  //获取当前项的Fruit实例</span><br><span class="line">        View view = LayoutInflater.from(getContext()).inflate(resourceId,parent,false);</span><br><span class="line">        ImageView fruitImage = (ImageView) view.findViewById(R.id.fruit_image);</span><br><span class="line">        TextView fruitName = (TextView) view.findViewById(R.id.fruit_name);</span><br><span class="line">        fruitImage.setImageResource(fruit.getImageId());</span><br><span class="line">        fruitName.setText(fruit.getName());</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;FruitAdapter重写了父类的一组构造函数，用于将上下文、ListView子项布局的id和数据都传递过来。另外又重写了getView()方法，这个方法在每个子项被滚动到屏幕内的时候会被调用。在getView()方法中，首先通过getItem()方法得到当前项的Fruit实例，然后使用LayoutInflater来为这个子项加载我们传入的布局。   
&emsp;&emsp;这里LayoutInflater的inflate()方法，接收三个参数，前两个参数已经知道了，第三个参数指定成了false，表示只让我们在父布局中声明的layout属性生效，但不为这个View添加父布局，因为一旦View有了父布局之后，它就不能再添加到ListView中了。  
&emsp;&emsp;往下，接下来调用View的findVIewById()方法分别获取到ImageView和TextView的实例，并分别调用他们的setImageResource()和setText()方法来设置显示的图片和文字，最后将布局返回，这样自定义的适配器就完成了。修改MainActivity中的代码：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Fruit&gt; fruitList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        initFruits();</span><br><span class="line">        <span class="type">FruitAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitAdapter</span>(MainActivity.<span class="built_in">this</span>,R.layout.fruit_item,fruitList);</span><br><span class="line">        <span class="type">ListView</span> <span class="variable">listView</span> <span class="operator">=</span> (ListView) findViewById(R.id.list_view);</span><br><span class="line">        listView.setAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initFruits</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; <span class="number">2</span>;i++)&#123;</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">apple</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;Apple&quot;</span> , R.drawable.Apple);</span><br><span class="line">            fruitList.add(apple);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">banana</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;banana&quot;</span>,R.drawable.Banana);</span><br><span class="line">            fruitList.add(banana);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">orange</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;orange&quot;</span>,R.drawable.Orange);</span><br><span class="line">            fruitList.add(orange);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">cherry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;cherry&quot;</span>,R.drawable.Cherry);</span><br><span class="line">            fruitList.add(cherry);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">grape</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;grape&quot;</span>,R.drawable.Grape);</span><br><span class="line">            fruitList.add(grape);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">mongo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;mongo&quot;</span>,R.drawable.Mango);</span><br><span class="line">            fruitList.add(mongo);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">peach</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;peach&quot;</span>,R.drawable.Peach);</span><br><span class="line">            fruitList.add(peach);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">pear</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;pear&quot;</span>,R.drawable.Pear);</span><br><span class="line">            fruitList.add(pear);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">strawberry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;strawberry&quot;</span>,R.drawable.Strawberry);</span><br><span class="line">            fruitList.add(strawberry);</span><br><span class="line">            Fruit watermelon= <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;watermelon&quot;</span>,R.drawable.Watermelon);</span><br><span class="line">            fruitList.add(watermelon);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
这里添加了一个initFruits()方法，用于初始化所有的水果数据。在Fruit类的构造函数中将水果的名字和对应的id注入，然后把创建好的对象添加到水果列表中。然后用for循环将所有的水果数据添加了两遍，如果只添加一遍，数据还不足以充满整个屏幕。接着在onCreat()方法创建了FruitAdapter对象，将FruitAdapter作为适配器传递给ListView，定制ListView界面完成。  
## ListView的点击事件
&emsp;&emsp;修改MainActivity的点击事件：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    listView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123;</span><br><span class="line">            Fruit fruit = fruitList.get(position);</span><br><span class="line">            Toast.makeText(MainActivity.this,fruit.getName(),Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&emsp;&emsp;使用setOnItemClickListener()方法为ListView注册了一个监听器，当用户点击了ListView中任何一个子项时，就会回调onItemClick()方法。在这个方法中通过position参数来判断用户点击的是哪一个子项，然后获取到相应的水果，并通过Toast将水果名字显示出来。  
# 滚动控件RecyclerView
&emsp;&emsp;可以说是一个增强版的ListView,不仅可以轻松实现和ListView同样的效果，还优化了ListView中存在的各种不足之处。我们先新建一个RecycleView项目。
## RecycleView基本用法
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.recyclerview.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/recycle_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
&emsp;&emsp;在布局中加入RecycleView也很简单，先为RecycleView指定id，然后将宽度和高度都设置为match_parent，这样Recycle就占满了整个布局的空间。需注意，RecycleView并不是内置在系统SDK中的，所以需要把完整的包路径写出来。  
&emsp;&emsp;接下来想要使用RecycleView来实现和ListView相同的效果，就要准备一份同样的水果图片。我们直接把从ListViewTest项目中的图片复制过来就可以了，另外也把Fruit类和fruit_item.xml也复制过来。  
&emsp;&emsp;接下来为RecycleView准备一个适配器，新建FruitAdapter类，让这个适配器继承自RecycleView.Adapter，并将泛型指定为FruitAdapter.ViewHolder。ViewHolder是我们在FruitAdapter中定义的一个内部类：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public class FruitAdapter extends RecyclerView.Adapter&lt;FruitAdapter.ViewHolder&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private List&lt;Fruit&gt; mFruitList;</span><br><span class="line"></span><br><span class="line">    static class ViewHolder extends RecyclerView.ViewHolder&#123;</span><br><span class="line">        ImageView fruitImage;</span><br><span class="line">        TextView fruitName;</span><br><span class="line"></span><br><span class="line">        public ViewHolder(View view)&#123;</span><br><span class="line">            super(view);</span><br><span class="line">            fruitImage=(ImageView) view.findViewById(R.id.fruit_image);</span><br><span class="line">            fruitName=(TextView) view.findViewById(R.id.fruit_name);</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public FruitAdapter(List&lt;Fruit&gt; fruitList)&#123;</span><br><span class="line">        mFruitList = fruitList;</span><br><span class="line">    &#125;</span><br><span class="line">    @NonNull</span><br><span class="line">    @Override</span><br><span class="line">    public FruitAdapter.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) &#123;</span><br><span class="line">        View view = LayoutInflater.from(parent.getContext())</span><br><span class="line">                .inflate(R.layout.fruit_item,parent,false);</span><br><span class="line">        ViewHolder holder = new ViewHolder(view);</span><br><span class="line">        return holder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onBindViewHolder(@NonNull FruitAdapter.ViewHolder holder, int position) &#123;</span><br><span class="line">        Fruit fruit = mFruitList.get(position);</span><br><span class="line">        holder.fruitImage.setImageResource(fruit.getImageId());</span><br><span class="line">        holder.fruitName.setText(fruit.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getItemCount() &#123;</span><br><span class="line">        return mFruitList.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
&emsp;&emsp;这段代码看上去有点长，但是它要比ListView的适配器要容易理解。我们先定义内部类ViewHolder，ViewHolder要继承自RecycleView.ViewHolder。然后ViewHolder的构造函数中传入一个View参数，这个参数通常就是RecycleView子项的最外层布局，那么我们可以通过findViewById()方法来获取ImageView和TextView的实例。  
&emsp;&emsp;往下，FruitAdapter中也有一个构造函数，这个方法用于把要展示的数据源传进来，并赋值给一个全局变量mFruitList，后续操作都将在这个数据源的基础上进行。 
&emsp;&emsp;由于FruitAdapter是继承自RecycleView.Adapter的，就必须重写onCreaterHolder()、onBindViewHolder()和getItemCount()这3个方法。onCreateViewHolder()方法用于创建ViewHolder实例，我们在这个方法中将fruit_item布局加载进来，然后创建一个ViewHolder实例，并把加载出来的布局传入到构造函数中，最后将ViewHolder的实例返回。onBindViewHolder()方法是用于对RecycleView子项的数据进行赋值的，会在每个子项被滚动到屏幕内的时候执行，这里我们通过position参数得到当前项的Fruit实例，然后再将数据设置到ViewHolder的ImageView和TextView当中。getItemCount()就非常简单，它用于告诉RecycleView一共有多少子项，直接返回数据源的长度就可以了。  
&emsp;&emsp;适配器准备好，开始使用RecycleVIew了，修改MainActivity中的代码。
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Fruit&gt; fruitList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        initFruit();</span><br><span class="line">        <span class="type">RecyclerView</span> <span class="variable">recyclerView</span> <span class="operator">=</span> (RecyclerView) findViewById(R.id.recycle_view);</span><br><span class="line">        <span class="type">LinearLayoutManager</span> <span class="variable">layoutManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinearLayoutManager</span>(<span class="built_in">this</span>);</span><br><span class="line">        recyclerView.setLayoutManager(layoutManager);</span><br><span class="line">        <span class="type">FruitAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitAdapter</span>(fruitList);</span><br><span class="line">        recyclerView.setAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initFruit</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;<span class="number">2</span>;i++)&#123;</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">apple</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;Apple&quot;</span> , R.drawable.apple);</span><br><span class="line">            fruitList.add(apple);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">banana</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;banana&quot;</span>,R.drawable.banana);</span><br><span class="line">            fruitList.add(banana);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">orange</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;orange&quot;</span>,R.drawable.orange);</span><br><span class="line">            fruitList.add(orange);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">cherry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;cherry&quot;</span>,R.drawable.cherry);</span><br><span class="line">            fruitList.add(cherry);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">grape</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;grape&quot;</span>,R.drawable.grape);</span><br><span class="line">            fruitList.add(grape);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">mongo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;mongo&quot;</span>,R.drawable.mango);</span><br><span class="line">            fruitList.add(mongo);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">peach</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;peach&quot;</span>,R.drawable.peach);</span><br><span class="line">            fruitList.add(peach);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">pear</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;pear&quot;</span>,R.drawable.pear);</span><br><span class="line">            fruitList.add(pear);</span><br><span class="line">            Fruit watermelon= <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;watermelon&quot;</span>,R.drawable.watermelon);</span><br><span class="line">            fruitList.add(watermelon);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/21/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%B7%A5%E5%85%B7DataGrip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/21/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%B7%A5%E5%85%B7DataGrip/" class="post-title-link" itemprop="url">[数据库]图形化界面工具DataGrip</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-04-21 18:20:49 / 修改时间：18:51:37" itemprop="dateCreated datePublished" datetime="2024-04-21T18:20:49+08:00">2024-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p>官网搜索下载即可</p>
<h1 id="连接Mysql"><a href="#连接Mysql" class="headerlink" title="连接Mysql"></a>连接Mysql</h1><p>新建项目<br><img src="/2024/04/21/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%B7%A5%E5%85%B7DataGrip/1.png"><br>连接Mysql<br><img src="/2024/04/21/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%B7%A5%E5%85%B7DataGrip/2.png"><br>填写配置信息，这里只需填写user(root)和密码,然后下载驱动包，测试连接，成功后点击ok即可<br><img src="/2024/04/21/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%B7%A5%E5%85%B7DataGrip/3.png"><br>选择展示所有数据库<br><img src="/2024/04/21/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%B7%A5%E5%85%B7DataGrip/4.png">  </p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>创建数据库 右键项目-&gt;new-&gt;schema<br>创建表 右键数据库-&gt;new-&gt;table<br><img src="/2024/04/21/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%B7%A5%E5%85%B7DataGrip/5.png"><br>修改表 右键表-&gt;Modify Table  </p>
<h2 id="新建查询"><a href="#新建查询" class="headerlink" title="新建查询"></a>新建查询</h2><p>右键数据库-&gt;New-&gt;Query&#x2F;Console  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/20/smali/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/20/smali/" class="post-title-link" itemprop="url">smali基础语法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-20 16:54:00" itemprop="dateCreated datePublished" datetime="2024-04-20T16:54:00+08:00">2024-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-21 15:33:42" itemprop="dateModified" datetime="2024-04-21T15:33:42+08:00">2024-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/smali/" itemprop="url" rel="index"><span itemprop="name">smali</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><p>&emsp;&emsp;在Java字节码中，寄存器都是32位的，能够支持任何类型，64位类型（Long&#x2F;Double）用两个寄存器表示，寄存器的命名方式有p命名法和v命名法。p命名法通常用与表示函数参数，比如p0、p1等，v命名法用于表示函数内部的变量，比如v0、v1等。  </p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/04/20/smali/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/19/re-tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="白乐天">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
      <meta itemprop="description" content="在安卓逆向和爬虫的道路上渐行渐远!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 白乐天">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/19/re-tools/" class="post-title-link" itemprop="url">逆向工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-19 23:27:26" itemprop="dateCreated datePublished" datetime="2024-04-19T23:27:26+08:00">2024-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-27 16:15:00" itemprop="dateModified" datetime="2024-04-27T16:15:00+08:00">2024-04-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">逆向</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="010Editor"><a href="#010Editor" class="headerlink" title="010Editor"></a>010Editor</h1><p>下载地址<br><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1863194-1-1.html">吾爱破解010Editor</a><br><a target="_blank" rel="noopener" href="https://www.sweetscape.com/010editor/">官网010Editor</a><br>激活码  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用户名:www.budingwang.com 注册码:CR96-4B9C-6470-303F  </span><br><span class="line">用户名:www.budingwang.com 注册码:CR71-DD9C-C1D3-55D8</span><br><span class="line">用户名:www.budingwang.com 注册码:CRE7-D59C-98D4-EF4E</span><br><span class="line">用户名:www.budingwang.com 注册码:CR2C-A19C-E8F5-6185</span><br><span class="line">用户名:www.budingwang.com 注册码:CR5F-BA9C-6A95-9CF6</span><br></pre></td></tr></table></figure>
<p>已无效</p>
<h1 id="apktool"><a href="#apktool" class="headerlink" title="apktool"></a>apktool</h1><p>下载地址<br><a target="_blank" rel="noopener" href="https://apktool.org/docs/install">apktool</a><br><img src="/2024/04/19/re-tools/1.png"><br>首先，创建一个要放置apktool的文件夹<br>第一步，右键<code>1</code>，重命名为<code>apktool.bat</code>保存到创建的文件夹中<br>第二步，点击二，下载，下载好后移动到创建的文件夹中<br><img src="/2024/04/19/re-tools/2.png"><br>第三步，添加到环境变量<br><img src="/2024/04/19/re-tools/3.png"><br>最后，在终端输入cmd输入apktool验证是否成功安装<br><img src="/2024/04/19/re-tools/4.png"><br>安装成功！</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>反编译Android应用程序包  <code>apktool d apk_file.apk</code><br><img src="/2024/04/19/re-tools/5.png"><br>反编译结果<br><img src="/2024/04/19/re-tools/6.png">  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">白乐天</span>
  </div>

<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/01/2024 00:00:00"); //修改为你的网站开始运行的时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>
    </div>
  </footer>

  

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
